Процесс загрузки системы, работа приложений и служб, различные действия пользователей, сообщения ядра ОС и многое другое — все эти события регистрируются в специальных журналах операционной системы, так называемых **log-файлах** (или **_«логах»_**). Если в работе системы что-то пойдет не так, то эти файлы станут для вас полезным источником информации, с помощью которого вы сможете разобраться в причинах возникших проблем и самостоятельно их устранить.

Если в работе сервера, компьютера или программного обеспечения возникла неизвестная ошибка, в первую очередь смотрят логи. Лог — текстовый файл с информацией о действиях программного обеспечения или пользователей, который хранится на компьютере или сервере. Это хронология событий и их источников, ошибок и причин, по которым они произошли. Читать и анализировать логи можно с помощью специального ПО.

Логи (лог-файлы) — это файлы, содержащие системную информацию работы сервера или компьютера, в которые заносятся определенные действия пользователя или программы. Иногда также употребляется русскоязычный аналог понятия — журнал.

Их предназначение — протоколирование операций, выполняемых на машине, для дальнейшего анализа администратором. Регулярный просмотр журналов позволит определить ошибки в работе системы в целом, конкретного сервиса или сайта (особенно скрытые ошибки, которые не выводятся при просмотре в браузере), диагностировать злонамеренную активность, собрать статистику посещений сайта.

Некоторыен программы записывают результаты своих действий (работы) для дальнейших операции (анализа и т.п.).

Системные администраторы, да и обычные пользователи Linux, часто должны смотреть лог файлы для устранения неполадок. На самом деле, это первое, что должен сделать любой сисадмин при возникновении любой ошибки в системе.

Сама операционная система Linux и работающие приложения генерируют различные типы сообщений, которые регистрируются в различных файлах журналов. В Linux используются специальное программное обеспечение, файлы и директории для хранения лог файлов. Знание в каких файлах находятся логи каких программ поможет вам сэкономить время и быстрее решить проблему. В этой статье мы рассмотрим основные части системы логирования в Linux, файлы логов, а также утилиты, с помощью которых можно посмотреть логи Linux.



## Как посмотреть логи в Linux?

Большинство логов в [**Linux**](https://ravesli.com/chto-takoe-linux-ego-struktura-i-preimushhestva/ "Что такое Linux? История создания Linux") генерируются системными демонами **syslogd** или **rsyslogd** и хранятся в обычном текстовом файле ASCII в [**каталоге**](https://ravesli.com/struktura-katalogov-v-linux/) **_/var/log._** Этот каталог содержит лог-файлы самой ОС, служб и различных приложений, запущенных в системе.

Если вы попробуете просмотреть какой-нибудь лог-файл от имени обычного пользователя, то в 99% случаев система ответит вам сообщением о нехватке [**прав доступа**](https://ravesli.com/tipy-polzovatelej-i-prava-dostupa-k-fajlam-katalogam-v-linux/). Поэтому я заранее переключился на пользователя _root_ (команда **[su –](https://ravesli.com/v-chem-raznitsa-mezhdu-su-i-sudo-v-linux/ "В чем разница между su и sudo в Linux?")**) и все дальнейшие действия будут выполняться от его имени.

Теперь можно перейти к непосредственному изучению содержимого лог-файлов. И для начала, мы заглянем внутрь _boot.log_. Данный лог-файл содержит информацию обо всех этапах загрузки операционной системы:

>`root@debian:/var/log# tail boot.log`

![[Pasted image 20221019070313.png]]

Как вы можете заметить, команда `tail` вывела последние 10 строк лог-файла, которые дают нам информацию о последовательном запуске различных сервисов, а также отображает их статус.

Как уже было сказано выше, многие лог-файлы хранятся в виде обычных текстовых файлов, поэтому их можно просматривать с помощью следующих стандартных команд:

   - **tail** — вывод последних 10 строк;

   - **head** — вывод первых 10 строк;

   - **cat** — вывод содержимого всего лог-файла;

   - **grep** — поиск в лог-файле всех вхождений заданного выражения или фильтрация лог-файла по заданному выражению;

   - **zcat** — отображает всё содержимое сжатых лог-файлов (с расширением _*.gz_);

   - **zmore** — постраничный просмотр сжатых лог-файлов, без их распаковки;

   - **zgrep** — поиск внутри сжатого лог-файла.

## Основные логи

  

В основных логах, необходимых для работы Linux, содержится наиболее значительный объем информации о текущем состоянии системы. Их можно условно разделить на четыре категории:

   - системные лог-файлы - системные логи, то есть те, которые связаны с системными событиями;

   -  лог загрузки системы (помогает выполнить отладку системы в случае, если она не загружается, сохраняет основные системные события (например, сбои оборудования));
  
   - логи веб-сервера - данные об обращениях к серверу, информация об ошибках веб-сервера. Другими словами, серверные логи, регистрирующие обращения к серверу и возникшие при этом ошибки;
  
   - логи баз данных, фиксирующие запросы к базам данных;
  
   - логи авторизации;
  
   - логи аутентификации;

   - лог-файлы событий;

   - лог-файлы служб;

   - лог-файлы приложений - логи приложений, установленных на этих операционных системах.

Многие из этих лог-файлов располагаются в каталоге **_var/log_**. Наиболее распространенными логами являются:

   - **_/var/log/boot.log_** — журнал загрузки системы (в нем хранится вся информация, связанная с этапами загрузки ОС);

   - **_/var/log/kern.log_** — журнал ядра (в нем хранятся сообщения и предупреждения, поступающие непосредственно из [**ядра Linux**](https://ravesli.com/chto-takoe-linux-ego-struktura-i-preimushhestva/#toc-6));

   - **_/var/log/syslog_** или **_/var/log/messages_** — журналы, в которых хранится информация об общей активности в системе (включая сообщения этапа загрузки);

   - **_/var/log/auth.log_** или _**/var/log/secure**_ — журналы аутентификации и безопасности (в них хранятся записи обо всех попытках входа в систему, включая как успешные, так и неудачные);

   - **_/var/log/debug_** — журнал отладки (в нем хранится подробная отладочная информация системы и приложений);

   - **_/var/log/daemon.log_** — журнал демонов (содержит информацию о событиях, связанных с различными запущенными в системе демонами/службами);

   - **_/var/log/maillog_** или **_/var/log/mail.log_** — журналы почтовых серверов (в них хранится информация, относящаяся к почтовым серверам и архивированию электронных писем);

   - **_/var/log/cron_** — журнал, в котором хранится информация о запланированных задачах (заданиях _cron_);

   - **_/var/log/faillog_** — информация о неудачных входах в систему. Журнал полезен для изучения потенциальных нарушений безопасности, таких как: взломы учетных записей, попытки перебора паролей и пр.;

   - **_/var/log/dmesg_** — журнал сообщений драйверов устройств. Просмотреть содержимое данного журнала можно с помощью команды `dmesg`. Стоит заметить, что при достижении своего предела, старые сообщения перезаписываются более новыми.

   - **_/var/log/Xorg.x.log_** — журнал сообщений X-сервера.

Ниже мы рассмотрим 20 различных файлов логов Linux, размещенных в каталоге **/var/log/**. Некоторые из этих логов встречаются только в определенных дистрибутивах, например, **dpkg.log** встречается только в системах, основанных на Debian.

-   **/var/log/messages** - содержит глобальные системные логи Linux, в том числе те, которые регистрируются при запуске системы. В этот лог записываются несколько типов сообщений: это почта, cron, различные сервисы, ядро, аутентификация и другие.
-   **/var/log/dmesg** - содержит сообщения, полученные от ядра. Регистрирует много сообщений еще на этапе загрузки, в них отображается информация об аппаратных устройствах, которые инициализируются в процессе загрузки. Можно сказать это еще один лог системы Linux. Количество сообщений в логе ограничено, и когда файл будет переполнен, с каждым новым сообщением старые будут перезаписаны. Вы также можете посмотреть сообщения из этого лога с помощью команды dmseg.
-   **/var/log/auth.log** - содержит информацию об авторизации пользователей в системе, включая пользовательские логины и механизмы аутентификации, которые были использованы.
-   **/var/log/boot.log** - Содержит информацию, которая регистрируется при загрузке системы.
-   **/var/log/daemon.log** - Включает сообщения от различных фоновых демонов
-   **/var/log/kern.log** - Тоже содержит сообщения от ядра, полезны при устранении ошибок пользовательских модулей, встроенных в ядро.
-   **/var/log/lastlog** - Отображает информацию о последней сессии всех пользователей. Это нетекстовый файл, для его просмотра необходимо использовать команду lastlog.
-   **/var/log/maillog /var/log/mail.log** - журналы сервера электронной почты, запущенного в системе.
-   **/var/log/user.log** - Информация из всех журналов на уровне пользователей.
-   **/var/log/Xorg.x.log** - Лог сообщений Х сервера.
-   **/var/log/alternatives.log** - Информация о работе программы update-alternatives. Это символические ссылки на команды или библиотеки по умолчанию.
-   **/var/log/btmp** - лог файл Linux содержит информацию о неудачных попытках входа. Для просмотра файла удобно использовать команду last -f /var/log/btmp
-   **/var/log/cups** - Все сообщения, связанные с печатью и принтерами.
-   **/var/log/anaconda.log** - все сообщения, зарегистрированные при установке сохраняются в этом файле
-   **/var/log/yum.log** - регистрирует всю информацию об установке пакетов с помощью Yum.
-   **/var/log/cron** - Всякий раз когда демон Cron запускает выполнения программы, он записывает отчет и сообщения самой программы в этом файле.
-   **/var/log/secure** - содержит информацию, относящуюся к аутентификации и авторизации. Например, SSHd регистрирует здесь все, в том числе неудачные попытки входа в систему.
-   **/var/log/wtmp или /var/log/utmp -** системные логи Linux**,** содержат журнал входов пользователей в систему. С помощью команды wtmp вы можете узнать кто и когда вошел в систему.
-   **/var/log/faillog** - лог системы linux, содержит неудачные попытки входа в систему. Используйте команду faillog, чтобы отобразить содержимое этого файла.
-   **/var/log/mysqld.log** - файлы логов Linux от сервера баз данных MySQL.
-   **/var/log/httpd/ или /var/log/apache2** - лог файлы linux11 веб-сервера Apache. Логи доступа находятся в файле access_log, а ошибок в error_log
-   **/var/log/lighttpd/** - логи linux веб-сервера lighttpd
-   **/var/log/conman/** - файлы логов клиента ConMan,
-   **/var/log/mail/** - в этом каталоге содержатся дополнительные логи почтового сервера
-   **/var/log/prelink/** - Программа Prelink связывает библиотеки и исполняемые файлы, чтобы ускорить процесс их загрузки. /var/log/prelink/prelink.log содержит информацию о .so файлах, которые были изменены программой.
-   **/var/log/audit/**- Содержит информацию, созданную демоном аудита auditd.
-   **/var/log/setroubleshoot/ -** SE Linux использует демон setroubleshootd (SE Trouble Shoot Daemon) для уведомления о проблемах с безопасностью. В этом журнале находятся сообщения этой программы.
-   **/var/log/samba/** - содержит информацию и журналы файлового сервера Samba, который используется для подключения к общим папкам Windows.
-   **/var/log/sa/** - Содержит .cap файлы, собранные пакетом Sysstat.
-   **/var/log/sssd/** - Используется системным демоном безопасности, который управляет удаленным доступом к каталогам и механизмами аутентификации.

В зависимости от выбранного дистрибутива, вы можете встретить следующие **лог-файлы менеджеров пакетов**:

   - _**/var/log/dpkg.log**_ — журнал пакетов, установленных через утилиту _dpkg_ в системах на основе [**Debian Linux**](https://ravesli.com/obzor-distributivov-linux-kakoj-vybrat/#toc-8).

   - _**/var/log/yum.log**_ — журнал пакетов, установленных через утилиту _y__um_ в системах на основе [**Red Hat Linux**](https://ravesli.com/obzor-distributivov-linux-kakoj-vybrat/#toc-11).

   - _**/var/log/emerge.log**_ — журнал пакетов (ebuild), установленных через утилиту _emerge_ в Gentoo Linux.

Не все журналы разработаны в удобочитаемом виде. Некоторые из них предназначены только для чтения системными приложениями и представлены в бинарном формате данных:

   - _**/var/log/utmp**_ и _**/var/log/utmp**_ — журналы учета входов пользователей в систему. Для просмотра сообщений применяется команда `utmpdump`, например:

`# utmpdump /var/log/wtmp`

![[Pasted image 20221019071007.png]]

 _**/var/log/lastlog**_ — журнал с информацией о последних входах пользователей. Для просмотра сообщений применяется команда `lastlog`:

![[Pasted image 20221019071037.png]]

## Ротация лог-файлов

Если учесть, что информация в лог-файлы поступает регулярно и по любому поводу, то в скором времени они должны были бы стать просто гигантскими, занимая при этом огромную кучу места на диске. А работать с ними было бы просто невозможно. Но этого не происходит благодаря **ротации** **лог-файлов**_._

Цель ротации заключается в сжатии устаревших лог-файлов, которые занимают много места. Лог-файлы, в конце имен которых добавлены нули, являются _ротируемыми_ (их имена были автоматически изменены системой). Ротацию лог-файлов можно выполнить с помощью **команды logrotate**, например:

`# logrotate /var/log/daemon.log`

Настройки ротации лог-файлов хранятся в соответствующем файле конфигурации _/etc/logrotate.conf_:

```
var/log/имя_журнала.log {   
Missingok  
Notifempty  
Compress
Size 20k 
Daily
Create 0600 root root   }

```

Разберем детально каждую строку вышеприведенного фрагмента:

   - `Missingok` — указывает команде `logrotate` не выводить ошибку, если лог-файл отсутствует.

   - `Notifempty` — если лог-файл пуст, то ротации не будет.

   - `Compress` — лог-файл необходимо сжать.

   - `Size 20k` — гарантирует, что лог-файл не превышает заданного размера, в противном случае производится его ротация.

   - `Daily` — ротация лог-файлов по ежедневному расписанию. Также можно задавать ежечасный (`Hourly`), еженедельный (`Weekly`), ежемесячный (`Monthly`) или ежегодный (`Yearly`) график.

   `Create 0600 root root` — создает экземпляр лог-файла, владельцем и группой которого является _root_.

Теперь, разобравшись с тем, что означает каждый параметр, можно каждому лог-файлу задавать соответствующий индивидуальный параметр ротации.  

## systemd и journald

  

**systemd** — это подсистема инициализации и управления службами в Linux, фактически вытеснившая в 2010-е годы традиционную подсистему _init_. В связке с ней работает и **journald** — [[DD. Демоны | демоны]] сбора логов, являющийся частью _systemd_. Он собирает логи со всей системы и хранит их в бинарном виде в каталоге _/__var/__log/__journal_. Для того чтобы их просмотреть, создана специальная **утилита journalctl**. Рассмотрим несколько примеров её применения.

Чтобы просмотреть последние 10 строк логов всех запусков системы, достаточно выполнить следующую команду:

`# journalctl --list-boots | tail`

![[Pasted image 20221019071707.png]]


Видите столбец, который я обвел красным? Цифрой `0` в нем обозначена текущая загрузка системы, цифрой `-1` — предыдущая и т.д. Если вы хотите просмотреть логи какой-то конкретной загрузки, например, позапрошлой, то достаточно ввести:

`# journalctl -b -2`

![[Pasted image 20221019071735.png]]

Также можно просмотреть информацию по выбранной службе, например, по _NetworkManager_:

`# journalctl -u NetworkManager`

![[Pasted image 20221019071750.png]]

Или же вывести сообщения ядра ОС:

`# journalctl -k`

![[Pasted image 20221019071803.png]]

Для получения своих, каких-то более конкретных результатов, допускается комбинировать опции и параметры команды `journalctl`:

`# journalctl -b -1 -u NetworkManager`

![[Pasted image 20221019071817.png]]

Для вывода информации только по нескольким последним записям, применяется опция `-n`, задающая их количество:

`# journalctl -u NetworkManager -n 5`

![[Pasted image 20221019071912.png]]

Если говорить про _systemd_, то, наверное, стоит упомянуть и про **команду systemd-analyze**, которая отвечает за сбор статистики загрузки системы. Применение данной команды без параметров отобразит общее время загрузки системы:

`# systemd-analyze`

![[Pasted image 20221019072630.png]]

С помощью параметра `blame` можно увидеть, сколько времени понадобилось для загрузки каждой конкретной службы (при этом сверху отобразятся самые медленные):

`# systemd-analyze blame`

![[Pasted image 20221019072645.png]]

## Приоритет сообщений в лог-файлах или же степени их важности

Сообщения в лог-файлах создаются в зависимости от типа событий. В свою очередь, событие имеет определенную степень важности. В зависимости от этой важности **событию присваивается определенный приоритет**:

   - **emerg** — наивысший приоритет, что-то сломалось, повод паниковать;

   - **alert** — тревога, стоит волноваться;

   - **crit** — критическое событие, стоит насторожиться;

   - **err** — ошибка;

   - **warning** — предупреждение;

   - **notice** — уведомление, можно не заморачиваться;

   - **info** — информационное сообщение, принять к сведению и забыть;

   - **debug** — отладочная информация.

Применяя вышеописанные значения приоритетов, можно просматривать сообщения лог-файлов, фильтруя их по заданному приоритету:

`# grep 'err' /var/log/syslog`

![[Pasted image 20221019072738.png]]

Или же для _journalctl_:

`# journalctl -p warning -b 0`

![[Pasted image 20221019072753.png]]

## Выводы

В каталоге **/var/log** вы можете найти всю необходимую информацию о работе Linux. Из сегодняшней статьи вы достаточно узнали, чтобы знать где искать, и что искать. Теперь просмотр логов в Linux не вызовет у вас проблем. Если остались вопросы, задавайте в комментариях!