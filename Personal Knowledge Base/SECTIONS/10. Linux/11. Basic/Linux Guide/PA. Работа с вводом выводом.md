Стандартные потоки ввода и вывода в Linux являются одним из наиболее распространенных средств для обмена информацией процессов, а перенаправление **>**, **>>** и **|** является одной из самых популярных конструкций командного интерпретатора.

# Потоки

Стандартный ввод при работе пользователя в терминале передается через клавиатуру.

Стандартный вывод и стандартная ошибка отображаются на дисплее терминала пользователя в виде текста.

Ввод и вывод распределяется между тремя стандартными потоками:

-   stdin — стандартный ввод (клавиатура),
-   stdout — стандартный вывод (экран),
-   stderr — стандартная ошибка (вывод ошибок на экран).

Потоки также пронумерованы:

-   stdin — 0,
-   stdout — 1,
-   stderr — 2.


Из стандартного ввода команда может только считывать данные, а два других потока могут использоваться только для записи. Данные выводятся на экран и считываются с клавиатуры, так как стандартные потоки по умолчанию ассоциированы с терминалом пользователя. Потоки можно подключать к чему угодно: к файлам, программам и даже устройствам. В командном интерпретаторе bash такая операция называется перенаправлением:

-   **< file** — использовать файл как источник данных для стандартного потока ввода.

-   **> file** — направить стандартный поток вывода в файл. Если файл не существует, он будет создан, если существует — перезаписан сверху.

-   **2> file** — направить стандартный поток ошибок в файл. Если файл не существует, он будет создан, если существует — перезаписан сверху.

-   **>>file** — направить стандартный поток вывода в файл. Если файл не существует, он будет создан, если существует — данные будут дописаны к нему в конец.

-   **2>>file** — направить стандартный поток ошибок в файл. Если файл не существует, он будет создан, если существует — данные будут дописаны к нему в конец.

-   **&>file** или **>&file** — направить стандартный поток вывода и стандартный поток ошибок в файл. Другая форма записи: **>file 2>&1**.

- **|** - это pipe, то есть вывод одного процесса становится вводом другого процесса.
## Стандартный ввод

Стандартный входной поток обычно переносит данные от пользователя к программе. Программы, которые предполагают стандартный ввод, обычно получают входные данные от устройства типа клавиатура. Стандартный ввод прекращается по достижении EOF (конец файла), который указывает на то, что данных для чтения больше нет.

EOF вводится нажатием сочетания клавиш Ctrl+D.

Рассмотрим работу со стандартным выводом на примере команды **cat** (от CONCATENATE, в переводе «связать» или «объединить что-то»).

**Cat** обычно используется для объединения содержимого двух файлов.

**Cat** отправляет полученные входные данные на дисплей терминала в качестве стандартного вывода и останавливается после того как получает EOF.

### Пример

```
cat
```

В открывшейся строке введите, например, **1** и нажмите клавишу Enter. На дисплей выводится **1**. Введите **a** и нажмите клавишу Enter. На дисплей выводится **a**.

Дисплей терминала выглядит следующим образом:

```
test@111:~/stream$ cat
1
1
a
a
```

Для завершения ввода данных следует нажать сочетание клавиш Ctrl + D.

## Стандартный вывод

Стандартный вывод записывает данные, сгенерированные программой. Когда стандартный выходной поток не перенаправляется в какой-либо файл, он выводит текст на дисплей терминала.

При использовании без каких-либо дополнительных опций, команда **echo** выводит на экран любой аргумент, который передается ему в командной строке:

```
echo Пример
```

Аргументом является то, что получено программой, в результате на дисплей терминала будет выведено:

```
Пример
```

При выполнении **echo** без каких-либо аргументов, возвращается пустая строка.

### Пример

Команда объединяет три файла: file1, file2 и file3 в один файл bigfile:

```
cat file1 file1 file1 > bigfile
```

Команда cat по очереди выводит содержимое файлов, перечисленных в качестве параметров на стандартный поток вывода. Стандартный поток вывода перенаправлен в файл bigfile.

## Стандартная ошибка

Стандартная ошибка записывает ошибки, возникающие в ходе исполнения программы. Как и в случае стандартного вывода, по умолчанию этот поток выводится на терминал дисплея.

### Пример

Рассмотрим пример стандартной ошибки с помощью команды **ls**, которая выводит список содержимого каталогов.

При запуске без аргументов **ls** выводит содержимое в пределах текущего каталога.

Введем команду **ls** с каталогом % в качестве аргумента:

```
ls %
```

В результате должно выводиться содержимое соответствующей папки. Но так как каталога % не существует, на дисплей терминала будет выведен следующий текст стандартной ошибки:

```
ls: cannot access %: No such file or directory
```

### Перенаправление потока

Linux включает в себя команды перенаправления для каждого потока.

Команды со знаками **>** или **<** означают перезапись существующего содержимого файла:

-   **>** — стандартный вывод,
-   **<** — стандартный ввод,
-   **2>** — стандартная ошибка.

Команды со знаками **>>** или **<<** не перезаписывают существующее содержимое файла, а присоединяют данные к нему:

-   **>>** — стандартный вывод,
-   **<<** — стандартный ввод,
-   2 **>>** — стандартная ошибка.

### Пример

В приведенном примере команда **cat** используется для записи в файл file1, который создается в результате цикла:

```
cat > file1
a
b
c
```

Для завершения цикла нажмите сочетание клавиш Ctrl + D.

Если файла file1 не существует, то в текущем каталоге создается новый файл с таким именем.

Для просмотра содержимого файла file1 введите команду:

```
cat file1
```

В результате на дисплей терминала должно быть выведено следующее:

```
a
b
c
```

Для перезаписи содержимого файла введите следующее:

```
cat > file1
1
2
3
```

Для завершения цикла нажмите сочетание клавиш Ctrl + D.

В результате на дисплей терминала должно быть выведено следующее:

```
1
2
3
```

Предыдущего текста в текущем файле больше не существует, так как содержимое файла было переписано командой **>**.

Для добавления нового текста к уже существующему в файле с помощью двойных скобок **>>** выполните команду:

```
cat >> file1
a
b
c
```

Для завершения цикла нажмите сочетание клавиш Ctrl + D.

Откройте file1 снова и в результате на дисплее монитора должно быть отражено следующее:

```
1
2
3
a
b
c
```

В Bash знак больше ">" обозначает перенаправление стандартного потока вывода. В данном случае в файл. То есть cat по-умолчанию выводит данные на экран, но поскольку они были перенаправлены, то данные на экран выводиться не будут. На экране видны только вводимые строки, выводимые оказываются в файле.

Пусть далее мы хотим добавить к заметке сегодняшнюю дату. Перенаправим вывод команды date в тот же файл.

![[Pasted image 20221027031710.png]]

Два знака больше ">>" – это тоже перенаправление вывода, но такое, когда данные добавляются в конец объекта (в данном случае файла), если он существует. Используй мы только один знак больше, файл был бы перезаписан.

На скрине выше командой `cat note.txt` файл читается. Так устроена команда cat, что если ей передается аргумент, то она не будет работать в интерактивном режиме, а возьмет данные из указанного файла и выведет их на экран. Поэтому это равносильно `cat < note.txt`, где знак меньше "<" обозначает перенаправление ввода.

Однако равносильно по результату – не значит равносильно по механизму реализации. При использовании знака именно командная оболочка, в данном случае Bash, занимается перенаправлением данных из файла. В то время как программа cat (или любая другая) работает в обычном режиме, "думая" что данные она получает со стандартного ввода.

Можно было бы ожидать, что если команде ls, которая выводит содержимое каталога, передать файл, содержащий адрес каталога, то она выведет объекты этого каталога. Однако это не так.

![[Pasted image 20221027031723.png]]

Такое перенаправление не работает. А там где "работает" можно обойтись и без него, то есть команда сама "знает", что если передается имя файла, или она употребима только с именем файла, то данные надо брать из него.

![[Pasted image 20221027031745.png]]

Здесь команда grep ищет первый аргумент во втором. Если находит, возвращает строку с ним. Программа wc считает количество строк, слов и символов в файле. С помощью sort строки сортируются.

Когда все же требуется выполнить список заранее подготовленных команд, то их записывают в файл и делают его исполняемым.

С другой стороны, выводы в файл команд ls и других работают.

![[Pasted image 20221027031801.png]]

В Unix-подобных операционных системах перенаправлять получение/передачу данных можно не только со стандартных ввода-вывода на файл. Данные могут поступать из, так называемого, программного канала. Равно и выводиться в него.