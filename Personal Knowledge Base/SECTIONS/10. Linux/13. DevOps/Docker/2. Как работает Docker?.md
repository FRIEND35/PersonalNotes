
Docker — это платформа, которая позволяет разрабатывать, тестировать и развертывать приложения в контейнерах. Контейнеры предоставляют стандартизированное окружение для выполнения приложений, изолируя их от основной операционной системы и других приложений. Это упрощает переносимость приложений между различными средами, такими как разработка, тестирование и производство.

# Как устроены докер-образы и контейнеры

Докер-образ состоит из слоев. Каждая команда в докер-файле добавляет новый слой, который накладывается на предыдущий. Финальный докер-образ — это объединение всех слоев в один.

Такая структура позволяет использовать уже существующие образы для создания новых. Например, мы разрабатываем приложения на Python. Чтобы наши приложения запускались на других серверах, мы должны в каждый образ устанавливать среду выполнения Python. Чтобы не реализовывать это самостоятельно, мы просто используем готовый официальный образ Python. В свою очередь, этот образ основан на базе образа Debian — дистрибутива Linux. Без него Python не сможет работать.

В результате наш докер-образ упрощенно выглядит вот так:

![[Pasted image 20231213010947.png]]

Также этот подход позволяет один раз скачать образ Python и использовать его для всех наших приложений. Так мы экономим место на диске и не дублируем одни и те же файлы.

Образ — это неизменяемые слои, которые доступны только для чтения. А контейнер — это тот же самый образ, у которого «сверху» есть еще один слой для записи. Контейнер использует его, когда ему нужно сохранить информацию в процессе своей работы: логи, временные файлы и так далее. Если контейнер уничтожится, то этот слой и вся информация на нем тоже пропадут. А когда из этого же образа создастся новый контейнер, слой для записи у него будет новый и пустой.

![[Pasted image 20231213011014.png]]
# Примущество docker

**Вот несколько преимуществ использования Docker:**

- Переносимость: контейнеры можно запускать на любом сервере с установленным Docker.
- Масштабируемость: контейнеры можно легко масштабировать, добавляя или удаляя их по мере необходимости.
- Безопасность: контейнеры изолированы друг от друга, что снижает риск возникновения проблем безопасности и снижает риск заражения одного контейнера другим.
- Уменьшение времени развертывания приложений. Контейнеры можно развернуть быстро и легко.

Docker является популярной технологией, которая используется разработчиками и администраторами серверов по всему миру.


Платформа Docker представлена в двух вариантах: бесплатная Community Edition под лицензией Apache и платная Enterprise Edition. Платная версия предназначена для коммерческого использования и распространяется по проприетарной лицензии. Изначально системой можно было пользоваться в Linux и UNIX-системах, но начиная с 2015 года в ПО добавили поддержку Windows.

Контейнеризация — это способ упаковки приложения и всех его зависимостей в один образ, который запускается в изолированной среде, не влияющей на основную операционную систему. С помощью контейнера можно отделить приложение от инфраструктуры: не важно, в каком окружении оно будет работать, есть ли там нужные зависимости и настройки, — разработчикам достаточно создать программу и упаковать все зависимости и настройки в единый образ. Затем ее можно разворачивать и запускать на других системах. Это ускоряет процесс разработки, сокращает промежуток между написанием кода и его выкладкой.

Контейнеризация напоминает виртуализацию, но технологии отличаются друг от друга. Виртуализация работает как отдельный компьютер со своей операционной системой и виртуальным оборудованием. Внутри одной операционной системы можно запустить другую. При контейнеризации виртуальная среда может запускаться прямо из ядра основной ОС и не виртуализирует оборудование. Поэтому контейнер может работать только в той же операционной системе, что и основная. Так как контейнеры не виртуализируют оборудование, они потребляют меньше ресурсов.




![[Pasted image 20231213011530.png]]

На изображении представлена примерная структура платформы. Docker — клиент-серверное приложение. Это означает, что оно состоит из двух частей: [сервера](https://blog.skillfactory.ru/glossary/server/) и клиента.

Сервер еще называют Docker-движком или демоном (daemon). Это фоновый процесс, который непосредственно управляет контейнерами. Именно демон создает, разворачивает и запускает контейнеры. Его можно сравнить с двигателем машины.

Клиент — это программа-интерфейс для командной строки, с которой взаимодействует пользователь. Он отдает команды через терминал. Клиент сообщает нужные сведения демону и отдает ему указания. Если продолжать аналогию с машиной, клиент — это руль и педали.

Клиент и сервер могут находиться на одном устройстве, а могут — на разных. Во втором случае клиент подключают к удаленному серверу через сокеты или API.
# Docker Compose 

Считается, что один контейнер должен выполнять одну функцию. Поэтому для настройки сложной среды понадобится несколько образов.

Можно скачать их вручную и настроить либо воспользоваться [Docker Compose](https://docs.docker.com/desktop/) — инструментом для работы с множественными образами и многоконтейнерными приложениями.

![[Pasted image 20231213010150.png]]

ПО позволяет управлять несколькими образами и контейнерами как одним. С помощью Docker Compose можно создать файл YAML для определения служб и с одной командой запускать и останавливать все что нужно. Инструмент способен ускорить разработку: в многоконтейнерных приложениях количество контейнеров может доходить до нескольких десятков.

Docker Compose - это инструмент командной строки, который используется для управления набором связанных контейнеров Docker. Он позволяет вам определять и запускать многоконтейнерное приложение в виде единого набора связанных служб. 

Сервисы Docker Compose - это блоки, которые составляют ваше приложение. Они могут представлять собой веб-серверы, базы данных, хранилища данных или любые другие компоненты, необходимые для вашего приложения. Чтобы использовать Docker Compose, вы создаете файл конфигурации, который описывает ваши сервисы. Файл конфигурации написан на языке YAML и содержит информацию о том, как создавать, запускать и настраивать ваши сервисы.

После создания файла конфигурации вы можете использовать команду docker-compose up для запуска вашего приложения. Команда docker-compose up создаст все ваши сервисы, установит связи между ними и запустит их. Docker Compose упрощает разработку и развертывание многоконтейнерных приложений. Он позволяет вам сосредоточиться на разработке вашего приложения, а не на управлении контейнерами.

Простыми словами, Docker Compose - это инструмент, который позволяет вам определить и запустить несколько контейнеров Docker как единое приложение. Он позволяет вам описать настройки вашего приложения в файле YAML и запустить все контейнеры одной командой. Docker Compose упрощает управление множеством контейнеров Docker, связанных друг с другом, их настройками и запуском.

Вот некоторые из преимуществ использования Docker Compose:

- Упрощает разработку и развертывание многоконтейнерных приложений.
- Обеспечивает согласованность между вашими средами разработки и производства.
- Помогает вам избежать ошибок, связанных с управлением контейнерами.

Вот несколько примеров того, как можно использовать Docker Compose:

- Вы можете использовать Docker Compose для запуска веб-приложения, состоящего из веб-сервера, базы данных и хранилища данных.
- Вы можете использовать Docker Compose для запуска микросервисного приложения, состоящего из нескольких связанных сервисов.
- Вы можете использовать Docker Compose для запуска приложения, которое требует нескольких экземпляров одного и того же сервиса.

Docker Compose - это мощный инструмент, который может помочь вам повысить эффективность разработки и развертывания многоконтейнерных приложений.

# Как хранятся данные в Docker

При остановке и перезапуске контейнера можно потерять часть рабочей информации, которая в нем записана. Чтобы этого избежать, программисты стремятся разрабатывать приложения с минимальным использованием хранилищ внутри контейнеров. Но обойтись без хранения данных получается не всегда, а от основной системы контейнер изолирован. Существует несколько способов решить проблему.

**Docker Volumes.** Это тома — способ хранения информации, который рекомендуют использовать разработчики платформы. Внутри лежат файлы и другие данные. Тома можно подключать к разным контейнерам, выбирать специальные драйверы и хранить информацию не на хосте, а в облаке или на удаленном сервере.

В Linux тома по умолчанию находятся в /var/lib/docker/volumes/. Другие программы могут получить к ним доступ только через контейнер, а не напрямую. Для создания и управления томами используются средства Docker: команда docker volume create, указание тома при создании контейнера в Dockerfile или docker-compose.yml.

**Bind Mount.** Более простой способ реализовать удаленное хранение памяти — папки, которые монтируются в контейнер прямо с хоста. Этот вариант используют для передачи конфигурационных файлов или в процессе разработки. Программист может писать код в среде хоста, а потом передавать его в контейнер.

**Tmpfs и Named Pipes.** Так называется особое файловое хранилище, которое есть только в системах Linux. Как правило, оно используется не для хранения файлов, а для обеспечения безопасности. Tmpfs — временное хранилище. Стоит остановить контейнер — данные будут потеряны. Доступ к Tmpfs очень быстрый, поэтому хранилище используют, чтобы оптимизировать работу контейнера.

Named Pipes — это [именованные каналы](https://docs.microsoft.com/ru-ru/windows/win32/ipc/named-pipes). Через них с Docker могут работать только пользователи Windows.
# Основные компоненты Docker

**Докер состоит из следующих основных компонентов:**

- Docker Engine - это основная программа, которая позволяет создавать, запускать и управлять контейнерами.
- Dockerfile - это текстовый файл, который описывает, как создать образ контейнера.
- Docker Registry - это сервер, на котором хранятся образы контейнеров.

## Docker Engine

Docker Engine - это программа, которая позволяет создавать, запускать и управлять контейнерами. Контейнер - это небольшой кусок программного обеспечения, который содержит все необходимое для запуска приложения, включая код, библиотеки, инструменты и системные зависимости.

1. **Docker Engine**:
    
    - Docker Engine — это основное программное обеспечение, которое обеспечивает работу Docker, управляет контейнерами и взаимодействует с ядром операционной системы.
    - Он включает в себя три основных компонента: Docker Daemon, Docker CLI и Docker API.


Docker Engine - это основная программа, которая позволяет создавать, запускать и управлять контейнерами. Docker Engine состоит из следующих подкомпонентов:

Docker Engine состоит из двух основных компонентов:

- Docker daemon - это фоновый процесс, который управляет контейнерами. 
- Docker client - это программа, с помощью которой вы взаимодействуете с Docker Engine.

Docker daemon отвечает за следующие задачи:

- Создание и запуск контейнеров.
- Управление контейнерами, такими как остановка, перезапуск и удаление.
- Доступ к контейнерам, таким как передача файлов и выполнение команд в контейнере.

Docker client позволяет вам выполнять следующие задачи:

- Создание образов контейнеров.
- Запуск контейнеров.
- Управление контейнерами.
- Доступ к контейнерам.

Вот как работает Docker Engine:

1. Разработчик создает образ контейнера, который содержит код, библиотеки и системные зависимости приложения.
2. Образ контейнера можно загрузить в реестр Docker, где его можно использовать другие разработчики.
3. Администратор сервера использует Docker для создания контейнера из образа контейнера.
4. Контейнер можно запустить, остановить, перезапустить или удалить с помощью команд Docker.

Docker Engine - это мощная технология, которая может помочь вам развертывать приложения более эффективно и безопасно.

## Dockerfile

Это файл-инструкция для сборки образа.

Рассмотрим несколько примеров команд и посмотрим, как на них реагирует докер и что при этом происходит. Обратите внимание, что все команды от клиента поступают в демон, который выполняет нужное действие.

- **docker pull**. Эта команда скачивает образ из docker registry и помещает его в локальное хранилище на хосте.
- **docker build**. Эта команда читает докер-файл и собирает образ.
- **docker run**. Эта команда создает из образа контейнер и запускает его.

Dockerfile - это текстовый файл, который описывает, как создать образ контейнера. Образ контейнера - это описание того, что содержится в контейнере.

**Dockerfile.** Это файл для предварительной работы, набор инструкций, который нужен для записи образа. В нем описывается, что должно находиться в образе, какие команды, зависимости и процессы он будет содержать.

Для сборки образа из Dockerfile используют команду:

```
docker build <докерфайл>
```

Dockerfile состоит из следующих шагов:

- **FROM** - указывает базовое изображение, на котором будет основано создаваемое изображение.
- **RUN** - запускает команду в контейнере.
- **COPY** - копирует файлы из локальной системы в контейнер.
- **ADD** - копирует файлы из локальной системы в контейнер, распаковывая их по пути назначения.
- **ENV** - устанавливает переменную среды в контейнере.
- **EXPOSE** - открывает порт в контейнере.
- **CMD** - запускает команду в контейнере при его запуске.

Вот пример Dockerfile:

```
FROM ubuntu:latest
RUN apt-get update && apt-get install -y nginx
COPY nginx.conf /etc/nginx/nginx.conf
EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
```

Этот Dockerfile создает образ контейнера, который основан на базовом образе Ubuntu. Затем он устанавливает nginx и копирует файл nginx.conf в контейнер. Наконец, он открывает порт 80 в контейнере и запускает nginx при запуске контейнера.

Вот что означает каждый шаг в приведенном выше примере Dockerfile:

- **FROM ubuntu:latest** - указывает базовое изображение, на котором будет основано создаваемое изображение. В этом случае базовым изображением является образ Ubuntu, последняя версия.
    
- **RUN apt-get update && apt-get install -y nginx** - запускает команду в контейнере. В этом случае команда обновляет индекс пакетов и устанавливает nginx.
    
- **COPY nginx.conf /etc/nginx/nginx.conf** - копирует файлы из локальной системы в контейнер. В этом случае файл nginx.conf копируется в каталог /etc/nginx в контейнере.
    
- **EXPOSE 80** - открывает порт в контейнере. В этом случае порт 80 открывается в контейнере.
    
- **CMD ["nginx", "-g", "daemon off;"]** - запускает команду в контейнере при его запуске. В этом случае nginx запускается в контейнере с параметром -g, который отключает демон nginx.
    

В целом, этот Dockerfile создает образ контейнера, который основан на базовом образе Ubuntu, устанавливает nginx, копирует файл nginx.conf в контейнер и открывает порт 80. Затем он запускает nginx при запуске контейнера.

Вы можете использовать Dockerfile для создания образа контейнера для любого приложения или сервиса. Dockerfile делает процесс создания образов контейнеров простым и повторяемым.

Вот несколько преимуществ использования Dockerfile:

- **Простота:** Dockerfile делает процесс создания образов контейнеров простым и понятным.
- **Повторяемость:** Dockerfile позволяет вам создавать образы контейнеров, которые можно легко повторно использовать.
- **Воспроизводимость:** Dockerfile гарантирует, что образы контейнеров всегда будут создаваться одинаково.

Dockerfile - это мощный инструмент, который может помочь вам создавать и управлять образами контейнеров.


2. **Контейнеры (Containers)**:
    
    - Контейнер — это экземпляр образа, который запускается как изолированный процесс на хостовой системе.
    - Контейнеры используют ядро хостовой операционной системы и разделяют его ресурсы, но работают в своих собственных пространствах имен, обеспечивая изоляцию.
3. **Репозитории (Repositories)**:
    
    - Репозитории — это места хранения образов, которые могут быть как публичными (например, Docker Hub), так и приватными.
    - Репозитории позволяют загружать и скачивать образы, делая их доступными для использования в различных средах.

## Docker Image 

Это неизменяемый образ, из которого разворачивается контейнер. Его можно рассматривать как набор файлов, необходимых для запуска и работы приложения на другом хосте. Можно привести аналогию из мира установки ПО: образ — это компакт-диск, с которого устанавливается программа.

Docker image - это файл, используемый для выполнения кода в Docker-контейнере. Docker-образы действуют как набор инструкций для создания Docker-контейнера, как шаблон.

Приложение/программное обеспечение упаковано в виде образа, который используется docker контейнерами. В основном, docker контейнеры основаны на на этих образах, поскольку docker образы состоят из кода приложения, необходимых библиотек, компонентов и т. д.

1. **Образы (Images)**:
    
    - Образ — это неизменяемый файл, содержащий все, что нужно для выполнения приложения, включая код, библиотеки, зависимости, инструменты и настройки.
    - Образы создаются на основе других образов, что позволяет использовать иерархию и повторно использовать общие слои.

**Docker** **Image**. Это образ — неизменяемый файл, из которого разворачивается контейнер. Для этого нужно запустить образ в клиенте с помощью специальной команды:

```
docker run <образ>
```

Docker-образ состоит из множества слоев, и каждый образ включает в себя все необходимое для настройки среды контейнера - системные библиотеки, инструменты, зависимости и другие файлы.

Docker-образы можно использовать для создания контейнеров, которые можно запускать на различных платформах. Это делает их очень удобными для разработки и развертывания приложений.

Вот некоторые преимущества использования Docker-образов:

- **Удобство:** Docker-образы можно создавать и использовать очень просто.
- **Портативность:** Docker-образы можно запускать на различных платформах.
- **Безопасность:** Docker-образы могут быть изолированы друг от друга, что повышает безопасность.

Вот некоторые примеры использования Docker-образов:

- **Разработка приложений:** Docker-образы можно использовать для создания изолированной среды для разработки приложений. Это позволяет разработчикам сосредоточиться на разработке приложения, не беспокоясь о конфигурации среды.
- **Развертывание приложений:** Docker-образы можно использовать для быстрого и простого развертывания приложений в production-среде.
- **Операционная инфраструктура:** Docker-образы можно использовать для создания и управления инфраструктурой, такой как веб-серверы, базы данных и системы хранения.

Docker-образы - это мощный инструмент, который может использоваться для различных целей. Они упрощают разработку, развертывание и управление приложениями.


## Контейнеры 

Это уже развернутое и запущенное приложение. Продолжая аналогию с установкой ПО, контейнер можно сравнить с уже установленной и работающей программой на ПК.

**Docker Container***. Это уже готовый и развернутый контейнер, который находится на каком-либо устройстве. Так пользователь запускает нужный образ через клиент Docker и ждет, пока платформа развернет его в полноценную среду или приложение-контейнер.

Docker контейнер — это стандартизированный, изолированный и портативный пакет программного обеспечения, который включает в себя все необходимое для запуска приложения, включая код, среду выполнения, системные инструменты, библиотеки и настройки. Контейнеры позволяют упаковать приложение и все его зависимости в единый объект, который может быть запущен на любой системе, поддерживающей Docker, без изменения среды выполнения.

==Контейнеризация — это способ упаковки приложения и всех его зависимостей в один образ, который запускается в изолированной среде, не влияющей на основную операционную систему.== С помощью контейнера можно отделить приложение от инфраструктуры: не важно, в каком окружении оно будет работать, есть ли там нужные зависимости и настройки, — разработчикам достаточно создать программу и упаковать все зависимости и настройки в единый образ. Затем ее можно разворачивать и запускать на других системах. Это ускоряет процесс разработки, сокращает промежуток между написанием кода и его выкладкой.

[Контейнеризация](https://blog.skillfactory.ru/glossary/kontejnerizacziya/) напоминает виртуализацию, но технологии отличаются друг от друга. Виртуализация работает как отдельный компьютер со своей операционной системой и виртуальным оборудованием. Внутри одной операционной системы можно запустить другую. При контейнеризации виртуальная среда может запускаться прямо из ядра основной [ОС](https://blog.skillfactory.ru/glossary/operaczionnaya-sistema/) и не виртуализирует оборудование. Поэтому контейнер может работать только в той же операционной системе, что и основная. Так как контейнеры не виртуализируют оборудование, они потребляют меньше ресурсов.

Контейнеры Docker - это небольшие изолированные исполняемые среды, которые содержат все необходимое для запуска приложения, включая код, библиотеки, системные инструменты и среду выполнения. 

Контейнеры похожи на виртуальные машины (VM), но они более легкие и эффективные. Контейнеры не создают полную операционную систему, как VM, а используют существующую операционную систему хоста. Это делает их более эффективными с точки зрения использования ресурсов.

Каждый контейнер Docker имеет свою собственную файловую систему. Эта файловая система изолирована от файловой системы хоста, на котором запущен контейнер. Это означает, что контейнер не может напрямую взаимодействовать с файлами на хосте, и наоборот.  Это позволяет контейнеру работать независимо от других контейнеров и иметь свои собственные версии файлов и директорий.

Файловая система контейнера состоит из двух частей:

- **Корневой образ** - это базовый образ, на котором основан контейнер. Корневой образ содержит ядро операционной системы, системные библиотеки и базовые приложения.

- **Образ приложения** - это образ, который содержит приложение, которое будет запущено в контейнере. Образ приложения может содержать файлы приложения, библиотеки и данные.

Когда контейнер запускается, Docker объединяет корневой образ и образ приложения в единую файловую систему. Эта файловая система монтируется в контейнере и становится доступной для приложения, запущенного в контейнере.

Файловая система контейнера изолирована от файловой системы хоста по нескольким причинам:

- **Безопасность:** Изоляция файловой системы помогает защитить контейнер от вредоносного ПО или других угроз, которые могут присутствовать на хосте.
- **Согласованность:** Изоляция файловой системы помогает обеспечить согласованность состояния контейнера, независимо от состояния хоста.
- **Мобильность:** Изоляция файловой системы делает контейнеры более мобильными, поскольку их можно легко переносить с одного хоста на другой.

Файловая система контейнера обычно строится на основе образа контейнера, который содержит все необходимые файлы и зависимости для работы приложения или сервиса внутри контейнера. При запуске контейнера Docker использует этот образ для создания файловой системы контейнера.

Изменения, внесенные в файловую систему контейнера во время его работы, могут быть сохранены в виде слоев (layers) и использоваться для создания нового образа контейнера. Это позволяет создавать новые образы на основе изменений, внесенных в файловую систему контейнера, и повторно использовать их для запуска других контейнеров.

Изоляция файловой системы является одной из основных характеристик контейнеризации. Она позволяет контейнерам быть более безопасными, согласованными и мобильными.

Контейнеры Docker имеют ряд преимуществ, в том числе:

- **Портативность:** Контейнеры можно запускать на различных платформах, что упрощает их развертывание.
- **Изоляция:** Контейнеры изолированы друг от друга, что повышает безопасность.
- **Удобство:** Контейнеры можно создавать и управлять с помощью простых команд.

Вот некоторые примеры того, как контейнеры Docker могут использоваться:

- **Разработка приложений:** Контейнеры Docker можно использовать для создания изолированной среды для разработки приложений. Это позволяет разработчикам сосредоточиться на разработке приложения, не беспокоясь о конфигурации среды.
- **Развертывание приложений:** Контейнеры Docker можно использовать для быстрого и простого развертывания приложений в production-среде.
- **Операционная инфраструктура:** Контейнеры Docker можно использовать для создания и управления инфраструктурой, такой как веб-серверы, базы данных и системы хранения.

Контейнеры Docker - это мощный инструмент, который может использоваться для различных целей. Они упрощают разработку, развертывание и управление приложениями.

### Как контейнер и образ связан между собой?

1. Образ Docker - это как рецепт для приготовления торта. Он содержит все необходимые ингредиенты, включая муку, сахар, яйца и масло. Вы можете использовать один и тот же рецепт, чтобы испечь несколько тортов, но каждый торт будет отдельным экземпляром.

2. Контейнер Docker - это как сам торт. Он является живым, изолированным средой, в которой есть все процессы и ресурсы, необходимые для запуска приложения. Каждый контейнер является отдельным и изолированным объектом, независимо от того, сколько других контейнеров создано из одного и того же образа.

1. Docker image - это шаблон, который содержит все необходимые файлы и настройки для запуска контейнера. Он включает в себя операционную систему, приложения, зависимости, библиотеки и другие компоненты, необходимые для работы контейнера. Docker image можно рассматривать как статичный снимок состояния контейнера.

2. Контейнер - это запущенный экземпляр Docker image. Контейнер использует файлы и настройки из Docker image для создания изолированной среды, в которой выполняются приложения. Контейнеры могут быть запущены, остановлены, удалены и управляться с помощью Docker Engine.

1. Docker image - это как заготовка для контейнера, содержащая все необходимое для его запуска, включая операционную систему, приложения и другие компоненты. Контейнер же - это уже запущенный экземпляр этой заготовки, в котором работают приложения. Таким образом, image это "шаблон", а контейнер - это "экземпляр" этого шаблона.

Таким образом, основное отличие между Docker image и контейнером заключается в их состоянии - Docker image является статичным шаблоном, а контейнер представляет собой запущенный экземпляр этого шаблона.


Вот несколько ключевых различий между образами Docker и контейнерами:

- **Образы Docker являются неизменяемыми, а контейнеры - изменяемыми.** Это означает, что вы можете изменить образ Docker, но не можете изменить контейнер, который уже запущен.
- **Образы Docker представляют собой инструкции по созданию контейнеров, а контейнеры представляют собой сами приложения.** Это означает, что вы можете использовать один и тот же образ Docker для создания нескольких контейнеров, каждый из которых будет запускать свое собственное приложение.

Вот аналогия, которая может помочь вам понять разницу:

- **Образ Docker:** Представьте себе рецепт для приготовления торта. Рецепт включает в себя все детали о торте, такие как количество комнат, планировка и используемые материалы.
- **Контейнер Docker:** Представьте себе фактический дом, построенный по этому рецепту. Дом является физическим воплощением рецепта, и в нем есть все комнаты, мебель и вещи.

Как и в случае с тортом, вы можете построить несколько домов по одному и тому же рецепту. Каждый дом будет независимым и изолированным, со своими собственными работающими процессами и ресурсами.

В Docker контейнеры создаются на основе образов и предоставляют возможность вносить изменения в их состояние во время выполнения. В отличие от контейнеров, образы являются статическими и неизменяемыми. Давайте разберем это подробнее.

### Отличия контейнера от образа

#### Образы (Images)

1. **Статичность**:
    
    - Образ — это неизменяемая "снимок" файловой системы и метаданных, необходимых для запуска приложения. Он создается на основе файлов `Dockerfile`, команд сборки и других образов. То есть это неизменяемая, статическая версия приложения. Он содержит все необходимые компоненты для запуска приложения, такие как исходный код, библиотеки, зависимости и системные настройки.
    
	- Образ представляет собой шаблон, на основе которого создаются контейнеры. После создания образа вы не можете изменять его напрямую.
2. **Создание**:
    
    - Образы создаются с помощью команды `docker build`, и каждая команда в `Dockerfile` добавляет новый слой к образу, создавая конечный продукт.
    
	- Образы создаются с помощью `Dockerfile`, который содержит последовательность команд для установки и настройки окружения.
	
	- Каждый образ состоит из слоев, причем каждый слой добавляется в результате выполнения команды в `Dockerfile`.
3. **Изменения**:
    
    - Образ сам по себе не может быть изменен напрямую. Чтобы изменить образ, нужно изменить `Dockerfile` или создать новый слой поверх существующего образа и заново его собрать.
4. **Хранение**:
    
    - Образы могут храниться и передаваться в репозиториях, таких как Docker Hub, и использоваться для создания контейнеров в разных средах.

- **Образ** — это неизменяемый шаблон, который включает все зависимости и инструкции для создания контейнера. Он содержит все необходимое для запуска приложения: операционную систему, библиотеки, исполняемые файлы и конфигурации.
- **Статичность**: Образы не меняются после создания. Это обеспечивает консистентность и воспроизводимость, так как каждый раз при запуске контейнера из одного и того же образа вы получаете одно и то же окружение.
- **Создание образов**: Образы создаются с помощью `Dockerfile` или на основе существующего контейнера. Сами образы могут быть загружены из репозиториев, таких как Docker Hub.
#### Контейнеры (Containers)

1. **Динамичность**:
    
    - Контейнер — это запущенный экземпляр образа, который может выполнять приложения и изменять свое состояние (например, установку новых программ, создание файлов и т.д.).
    
	- Контейнер — это экземпляр образа, который можно запускать, изменять и останавливать. Контейнеры предоставляют изолированное окружение для выполнения приложений.
	
	- В отличие от образов, контейнеры могут изменяться во время их работы. Вы можете устанавливать новое программное обеспечение, изменять файлы, сохранять данные и так далее.
2. **Изменения**:
    
    - Любые изменения, внесенные в контейнер, такие как установка нового программного обеспечения или изменение файлов, сохраняются только в этом экземпляре контейнера. Эти изменения не будут отражены в исходном образе.
3. **Временность**:
    
    - Контейнеры могут быть временными и часто удаляются после использования. Изменения в контейнере будут потеряны, если его удалить, если они не сохранены в новом образе или не сохранены на хосте.

4. **Создание**:

    - Контейнеры создаются и запускаются на основе образов с помощью команды `docker run`. При этом можно настроить различные параметры, такие как сетевые настройки, переменные окружения и монтирование томов.

5. **Изменения**:
    
    - Любые изменения, сделанные в контейнере (например, установка нового ПО или изменение конфигурационных файлов), влияют только на этот экземпляр контейнера.
    
	- Изменения можно сохранить, создав новый образ на основе измененного контейнера с помощью команды `docker commit`.

1. **Сохранение изменений**:
    
    - Вы можете сохранить изменения, сделанные в контейнере, создав новый образ на его основе с помощью команды `docker commit`.


- **Контейнер** — это запущенный экземпляр образа. Контейнеры предоставляют изолированное окружение для выполнения приложений, но в отличие от образов, они могут изменяться во время работы.
- **Динамичность**: В контейнер можно вносить изменения, такие как установка новых программ, изменение конфигурационных файлов и создание новых данных.
- **Изоляция**: Контейнеры изолированы друг от друга и от хостовой системы, что позволяет избежать конфликтов между приложениями.

## Docker Registry

Docker Registry - это сервер, на котором хранятся образы контейнеров. Образ контейнера - это описание того, что содержится в контейнере. Docker Registry позволяет вам хранить и обмениваться образами контейнеров с другими пользователями.

Docker Registry - это хранилище для Docker Images. Это место, где вы можете сохранять, обмениваться и управлять Docker Images. Когда вы создаете Docker Image, вы можете отправить его в Docker Registry, чтобы другие люди могли загрузить и использовать этот образ. Docker Registry также может использоваться для централизованного хранения образов внутри вашей организации.

**Docker Registry.** Это реестр, или репозиторий — открытая или закрытая база образов. К ней можно подключиться через клиент Docker и загрузить нужный с помощью команды:

```
docker pull <образ>
```

При запуске команды `docker run` программа сначала проверяет, есть ли нужный образ в локальном хранилище. Если его нет, она сама находит файл в репозитории и скачивает на компьютер.

Существует несколько общеизвестных реализаций Docker Registry:

1. **Docker Hub:** Это общедоступный Docker Registry, предоставляющий общедоступное хранилище для Docker Images. Вы можете загружать образы в Docker Hub и делиться ими с другими пользователями.
    
2. **Docker Trusted Registry (DTR):** Это коммерческое решение от Docker, предоставляющее безопасное и управляемое хранилище для Docker Images в предприятии. DTR также предоставляет дополнительные функции, такие как управление доступом и политики безопасности.
    
3. **AWS Elastic Container Registry (ECR):** Это управляемый сервис хранения Docker Images в облаке AWS (Amazon Web Services). ECR интегрируется с другими сервисами AWS, обеспечивая легкость интеграции в облачных средах.
    
4. **Google Container Registry (GCR):** Это хранилище Docker Images, предоставляемое Google Cloud Platform. Он интегрируется с другими сервисами GCP и обеспечивает удобное хранение образов для приложений, развертываемых в облаке Google.
    
Вы также можете развертывать собственный Docker Registry в своей среде с использованием официального образа Docker Registry. Это может быть полезно для предприятий, которые хотят полный контроль над своим хранилищем Docker Images.

Docker Registry состоит из следующих подкомпонентов:

- **Docker Hub** - это общедоступный Docker Registry, который поддерживается компанией Docker.
- **Частный Docker Registry** - это Docker Registry, который вы можете настроить и использовать для хранения и обмена образами контейнеров с вашей командой или организацией.

Вы также можете создать частный Docker Registry, чтобы хранить и обмениваться образами контейнеров с вашей командой или организацией. Частный Docker Registry может быть установлен на вашем собственном сервере или в облаке.

Чтобы создать частный Docker Registry, вы должны установить сервер Docker Registry. После установки сервера Docker Registry вы можете настроить его для хранения и обмена образами контейнеров.

Вот некоторые преимущества использования Docker Registry:

- **Централизованное хранение:** Docker Registry позволяет вам хранить все ваши образы контейнеров в одном месте.
- **Управление версиями:** Docker Registry позволяет вам управлять версиями образов контейнеров.
- **Безопасность:** Docker Registry поддерживает различные функции безопасности, такие как аутентификация и авторизация.

Docker Registry - это мощный инструмент, который может помочь вам управлять образами контейнеров.

### Docker hub?

Образ можно создать самостоятельно с помощью Dockerfile или уже готового контейнера, в котором произошли какие-либо изменения, а также скачать из открытого репозитория [Docker Hub](https://hub.docker.com/).

Разработчики со всего мира могут выкладывать Docker-образы. Другие пользователи имеют возможность скачать их, развернуть в контейнеры и использовать на своих машинах. 

Сейчас в Docker Hub более 100 тысяч образов. Некоторые из них загрузили в базу официальные разработчики. Это, например, Docker Images для [mySQL](https://blog.skillfactory.ru/glossary/mysql/) или GitLab.

Docker Hub - это общедоступный реестр образов Docker, предоставляемый компанией Docker. Он содержит миллионы образов Docker для различных приложений и сервисов.

Docker Hub позволяет вам:

- Искать и загружать образы Docker из различных источников.
- Общаться с другими пользователями Docker Hub.
- Публиковать свои собственные образы Docker для других пользователей.

Чтобы использовать Docker Hub, вы должны создать учетную запись. После создания учетной записи вы можете просматривать и загружать образы Docker из Docker Hub.

Чтобы опубликовать свой собственный образ Docker в Docker Hub, вы должны создать репозиторий Docker. После создания репозитория Docker вы можете загрузить свой образ Docker в репозиторий.

Вот некоторые преимущества использования Docker Hub:

Централизованное хранение: Docker Hub позволяет вам хранить все ваши образы Docker в одном месте.
Управление версиями: Docker Hub позволяет вам управлять версиями образов Docker.
Безопасность: Docker Hub поддерживает различные функции безопасности, такие как аутентификация и авторизация.
Docker Hub - это мощный инструмент, который может помочь вам управлять образами Docker.

Вот некоторые примеры того, как можно использовать Docker Hub:

- Разработчики могут использовать Docker Hub для поиска и загрузки образов Docker для своих приложений.
- Администраторы систем могут использовать Docker Hub для публикации образов Docker для своих приложений.
- Компании могут использовать Docker Hub для совместной работы над образами Docker.

1. Docker Hub - это полезный ресурс для всех, кто использует Docker.

2. Docker Hub - это крупнейший Docker Registry в мире. Он содержит миллионы образов контейнеров для различных приложений и сервисов.
# Как работают образы и контейнеры

1. **Создание образов**:
    
    - Образы создаются с помощью файла `Dockerfile`, который описывает, как настроить образ. Файл может содержать команды для установки программного обеспечения, копирования файлов и настройки окружения.
     
    Пример `Dockerfile`:
    
```
    FROM ubuntu:latest 
    RUN apt-get update && apt-get install -y nginx 
    COPY index.html /var/www/html/index.html
    CMD ["nginx", "-g", "daemon off;"]`
```

Этот файл создает образ на основе Ubuntu, устанавливает Nginx и копирует файл `index.html` в директорию веб-сервера.

2. **Сборка образа**:
    
    - Используйте команду `docker build`, чтобы создать образ на основе `Dockerfile`:
        
```
docker build -t my-nginx .
```
   
3. **Запуск контейнеров**:
    
    - Контейнеры запускаются на основе образов с помощью команды `docker run`:
        

```        
docker run -d -p 80:80 my-nginx
```

- Опция `-d` указывает на фоновый режим, а `-p 80:80` маппирует порт 80 контейнера на порт 80 хоста.

1. **Изоляция и взаимодействие контейнеров**:
    
    - Контейнеры изолированы друг от друга и от хостовой системы с помощью технологий контейнеризации, таких как пространства имен и контрольные группы (cgroups).
    - Контейнеры могут взаимодействовать друг с другом через сети Docker.
5. **Управление контейнерами**:
    
    - Docker предоставляет команды для управления контейнерами, такими как остановка (`docker stop`), удаление (`docker rm`), просмотр логов (`docker logs`) и другие.

**Другой пример**

1. **Создание и использование образов**:
    
    - Вы создаете образ с помощью `Dockerfile` и команды `docker build`. Пример:
        
  ```
   FROM ubuntu:latest 
   RUN apt-get update && apt-get install -y nginx 
   COPY index.html /var/www/html/index.html 
   CMD ["nginx", "-g", "daemon off;"]`
   ```     

  2. **Сборка образа:**
        
```
   docker build -t my-nginx-image .
```

        
2. **Запуск контейнеров**:
    
    - Контейнеры создаются и запускаются на основе образов:
        
```        
   docker run -d -p 80:80 --name my-nginx-container my-nginx-image
```

		
3. **Изменение состояния контейнера**:
    
    - Вы можете войти в контейнер и внести изменения:
        
```
   docker exec -it my-nginx-container /bin/bash
```     

2. **Установить новое ПО или изменить файлы в контейнере:**
        
        
```
   apt-get install vim
```     

4. **Сохранение изменений**:
    
    - Чтобы сохранить текущие изменения в контейнере в новом образе:
            
```
docker commit my-nginx-container my-nginx-image:v2`
```

Это создаст новый образ `my-nginx-image` с тегом `v2`, который будет включать все изменения, сделанные в контейнере.

#### Создание и изменение контейнера

1. **Создание и запуск контейнера**:

```
docker run -it --name my-ubuntu-container ubuntu:latest /bin/bash
```
### Преимущества Docker

1. **Портативность**:
    
    - Образы Docker работают на любой системе, поддерживающей Docker, что делает приложения переносимыми между различными средами (например, разработка, тестирование, производство).
2. **Изоляция**:
    
    - Контейнеры изолируют приложения и их зависимости, что предотвращает конфликты между ними и обеспечивает более безопасное исполнение.
3. **Легкость и скорость**:
    
    - Контейнеры более легковесны по сравнению с виртуальными машинами, так как они разделяют ядро хостовой системы и используют меньше ресурсов.
4. **Упрощенная разработка и развертывание**:
    
    - Docker позволяет легко создавать и тестировать приложения в одном и том же окружении, что ускоряет цикл разработки и развертывания.

### Работа с Docker

#### Основные команды Docker

1. **Запуск контейнера**:
    
    
```
docker run -it ubuntu /bin/bash
```
    
2. **Остановка контейнера**:
    

```    
docker stop <container_id>
```
    
3. **Удаление контейнера**:
    
``` 
docker rm <container_id>
```
    
4. **Просмотр запущенных контейнеров**:
    
```
docker ps
```
    
5. **Построение образа**:
    
```
docker build -t my-image .
```
    
6. **Просмотр образов**:
	
    
```
docker images
```


#### Создание и изменение контейнера

1. **Создание и запуск контейнера**:
    
```    
    docker run -it --name my-ubuntu-container ubuntu:latest /bin/bash
```
    
2. **Установка нового ПО**:
    
    Внутри контейнера установите, например, `curl`:

```    
    apt-get update apt-get install -y curl
```
    
3. **Создание нового образа из контейнера**:
    
    Выйдите из контейнера и создайте новый образ:
    

``` 
    exit docker commit my-ubuntu-container my-ubuntu-image:with-curl
```
    
4. **Запуск нового контейнера из созданного образа**:
    
```
    docker run -it my-ubuntu-image:with-curl /bin/bash
```

В этом контейнере уже будет установлен `curl`.

Docker хранит свои данные в определенных каталогах на файловой системе Linux. Знание этих мест расположения может быть полезно для резервного копирования, управления ресурсами и устранения неполадок. Вот основные пути, где находятся конфигурационные файлы, образы, контейнеры и другие данные Docker в системе Linux:

# Основные Каталоги Docker в Linux

##21## 1. **Каталог для данных Docker по умолчанию**

- **Путь**: `/var/lib/docker`
- **Описание**: Это основной каталог, где Docker хранит свои данные по умолчанию, включая образы, контейнеры, тома и сетевые конфигурации.
- **Содержимое**:
    - `/var/lib/docker/containers` — каталоги для каждого контейнера.
    - `/var/lib/docker/image` — образы Docker.
    - `/var/lib/docker/volumes` — данные томов Docker.
    - `/var/lib/docker/network` — сетевые настройки Docker.

#### 2. **Конфигурационные файлы Docker**

- **Путь**: `/etc/docker`
    
- **Описание**: Здесь хранятся конфигурационные файлы Docker.
    
- **Файлы**:
    
    - `/etc/docker/daemon.json` — основная конфигурация демона Docker. В этом файле можно задавать параметры, такие как использование прокси, логирование, и настройки сети.
    
    Пример конфигурации `daemon.json`:
    
```    
{   "log-level": "warn",   "storage-driver": "overlay2",   "insecure-registries": ["my-insecure-registry.local"] }
```
 

#### 3. **Журналы (логи) Docker**

- **Путь**: `/var/log/docker.log` (или в системных логах `/var/log/syslog`)
- **Описание**: Журналы Docker по умолчанию записываются в файл `/var/log/docker.log` или интегрируются в системные логи.

#### 4. **Файлы конфигурации сервисов Docker**

- **Путь**: `/etc/systemd/system/docker.service`
    
- **Описание**: Конфигурационный файл для управления службой Docker через `systemd`.
    
    Пример содержания:
    
```
[Service] ExecStart=/usr/bin/dockerd
```

#### 5. **Пользовательские конфигурации (для Docker Compose)**

- **Путь**: `~/.docker`
    
- **Описание**: В домашнем каталоге пользователя могут находиться конфигурационные файлы и настройки для Docker Compose и других пользовательских инструментов Docker.
    
    - `~/.docker/config.json` — пользовательские настройки Docker CLI и аутентификационные данные.

### Основные Компоненты и их Каталоги

1. **Контейнеры**
    
    - **Путь**: `/var/lib/docker/containers`
    - **Описание**: Здесь находятся каталоги для каждого контейнера, содержащие такие данные, как конфигурационные файлы контейнера и логи.
2. **Образы**
    
    - **Путь**: `/var/lib/docker/image`
    - **Описание**: Здесь хранятся данные всех загруженных образов Docker. В зависимости от используемого драйвера хранения, путь может варьироваться.
    - Подкаталоги:
        - `aufs` — для драйвера `aufs`.
        - `overlay2` — для драйвера `overlay2`.
3. **Тома**
    
    - **Путь**: `/var/lib/docker/volumes`
    - **Описание**: В этом каталоге Docker хранит данные для томов. Каждый том имеет свой подкаталог с данными.
4. **Сети**
    
    - **Путь**: `/var/lib/docker/network`
    - **Описание**: Здесь хранятся данные о сетевых конфигурациях, таких как настройки и состояние сетевых мостов и виртуальных сетей.

### Изменение Каталога для Данных Docker

Для изменения местоположения, где Docker хранит свои данные, можно изменить опции в конфигурационном файле `daemon.json`. Например:

1. Создайте или отредактируйте файл `/etc/docker/daemon.json`:
    

```
{   "data-root": "/new/path/to/docker-data" }
```
    
2. Перезапустите сервис Docker, чтобы применить изменения:
    
```
sudo systemctl restart docker
```

### Пример Использования и Управления

1. **Проверка текущих контейнеров и их данных**:
    
```
sudo ls /var/lib/docker/containers
```

    
2. **Копирование данных из контейнера**:
    
```    
docker cp <container-id>:/path/inside/container /path/on/host
```
    
3. **Изменение конфигурации и перезапуск Docker**:
    
    - Редактируйте `/etc/docker/daemon.json` для изменения настроек, таких как логирование и сети.
    - Перезапустите Docker:

```
sudo systemctl restart docker
```

Эти пути и команды помогут вам более эффективно управлять Docker в вашей системе Linux.
### Заключение

Docker предоставляет удобный и эффективный способ развертывания и управления приложениями в изолированных контейнерах. Это упрощает процесс разработки, тестирования и развертывания, обеспечивая большую гибкость и согласованность окружений. Благодаря легковесности и высокой портативности Docker стал популярным инструментом в индустрии разработки и развертывания программного обеспечения.

