
В процессе тестирования на проникновение или оценки уязвимости повышение привилегий является очень важным шагом. **На этом этапе хакеры и исследователи безопасности часто используют эксплойты, ошибки и неправильные конфигурации для повышения привилегий**.  
  
Во всех UNIX-системах всегда существует пользователь с расширенными привилегиями, **как правило это пользователь root**, имеющий право на выполнение любых операций. Его свобода действий ничем не ограничена, в отличии от обычных пользователей имеющих ограничения в правах.  
  
**Давайте рассмотрим стандартные команды для сбора информации внутри системы.**  
  
```
hostname - имя хоста  
uname - a - сведения о ядре  
uname - r - версия kernel  
cat /proc/version - информация о версии ядра и о компиляторе gcc  
cat /etc/issue - информация о системе  
ps -A - все запущенные процессы  
ps axjf - дерево процессов  
env - переменная среда  
cat /etc/passwd - все пользователи в системе  
history - история команд  
netstat -a - все прослушиваемые порты  
sudo -l - Привелегии root  
```
  
# Prefase

Как ты помнишь (и как должен помнить каждый адекватный администратор), работать в линуксе под рутом категорически не рекомендуется. В идеальном мире ты должен использовать его только для конфигурирования сервера, установки и обновления ПО и прочих чисто административных задач. Вся беда в том, что мы живем в обычном мире, который очень далек от идеального. Поэтому такая ситуация все же иногда бывает. Правда, в большинстве случаев чисто из-за халатности, ибо так уж исторически сложилось, что пользователям линукса приходилось разбираться в том, как работает их операционная система. А хоть немного разбираясь в системе и ее механизмах безопасности, под рутом уже сидеть не будешь. Поэтому сегодня, в отличие от Windows, где мы говорили о получении системных привилегий из-под админа, будем рассматривать только варианты повышения привилегий от непривилегированного пользователя до рута. Итак, приступим.  
  
**Мы выполнили команду sudo -l и увидели где нам доступны sudo права.**  
Дальнейшем нашим шагом будет, собственно повышение привилегий через бинарники.  
  
**После получения SHELL с низким уровнем привилегий мы обычно делаем следующее:**  

1. Определите версию выпуска операционной системы.  
2. Проверить версию ядра  
3. Определите разрешения текущего пользователя  
4. Список файлов Suid.  
5. Просмотрите установленные пакеты, программы, запущенные службы, устаревшие версии могут иметь уязвимости  
  
# Эксплойты

Все способы получения прав суперпользователя в Linux можно условно разделить на две категории. Первая — это как раз таки использование эксплойтов. В отличие от Windows, c ее механизмом автоматической установки обновлений, приверженцам пингвина приходится по большей части самостоятельно следить за выходом заплаток и их установкой. В связи с этим шанс встретить среди Linux-машин не пропатченную до конца систему гораздо выше. Какие преимущества данного метода можно выделить? Для начала — большинство эксплойтов используют уязвимости в ядре ОС, что позволяет получить максимальные привилегии. Найти код подходящего эксплойта не так сложно, и ты наверняка знаешь пару ресурсов. Плюс ко всему, чтобы воспользоваться сплоитом, подчас не требуется разбираться во всех тонкостях используемой уязвимости — достаточно просто правильно скомпилировать его и запустить (иногда, правда, приходится его немного кастомизировать, но довольно часто все будет работать и без подгонки напильником).  
  
# Введение в find

Команда «find» – это средство командной строки, позволяющее обойти структуру файловой пирамиды и найти точное местоположение файла и каталога в соответствии с желанием пользователя.  
Эта команда может использоваться различными службами, такими как поиск любого файла по «размеру, разрешениям, дате изменения / доступа, пользователям, группам» и многим другим в соответствии с пользовательскими реквизитами.  
Подобно каждой команде Find также можно кратко понять используя help / man, как показано на рисунке ниже. find –help  
  
# Идентификация

Судя по плану, сначала надо узнать, куда мы вообще попали, что за дистр используем и какова версия ядра. Версию ядра можно вытянуть с помощью всем известной команды uname -a или ее аналогов. Для того же, чтобы получить информацию об используемом дистрибутиве, надо глянуть в файлик *-release, лежащий в каталоге etc (в зависимости от дистра он может называться по-разному: lsb-release в Ubuntu, redhat-release в Red Hat / CentOS и так далее):  

```
cat /etc/*-release  
```

Зная дистрибутив и версию ядра, можно заняться вторым этапом — поиском подходящей «отмычки».  
  
# Ограничение доступа для root

После настройки sudo и назначения пользователям нужных прав, можно ограничить доступ к учетной записи root. Существует несколько способов защиты от входа под root и ограничения доступа к его учетной записи.  
  
# Прятки

Хорошо, как доставить, разобрались. Но как при этом не спалиться? Если твой сплоит обнаружат, будь уверен, что лазейку быстро прикроют. Так что размещать его, компилировать и запускать надо из какого-то неприметного места. В линуксе директории, начинающиеся с точки (например, .secret_folder), являются скрытыми. Поэтому логично было бы их использовать для сокрытия своей активности. Например, поместить в них код эксплойта: /tmp/.nothingthere/exploit.c. Правда, в таком случае надо сначала убедиться, что tmp смонтирована без опции noexec и из нее можно будет запустить собранный сплоит (для этого воспользуйся командой mount).  
  
# Сборка и запуск сплоита 

Как только мы доставили и разместили сплоит, его надо будет собрать/настроить. Как правило, сплоиты пишутся на С либо на одном из скриптовых языков Python/Perl/PHP. Постоянные читатели знают, что оставлять на своем сервере компилятор — не самое лучшее решение, поэтому обычно его выпиливают. Если на твой вопрос о версии компилятора gcc -v bash ругнется gcc: command not found, значит, тебе «повезло» и придется идти в обход. То есть либо искать сплоит на питоне, перле или чем-то еще, либо компилить его на виртуальной машине с аналогичной ОС и версией ядра. После чего переместить полученный исполняемый файл на целевой хост (правда, стопроцентной работы этот способ не гарантирует, сплоит может упасть и обрушить систему, так что поаккуратнее тут). Однако, как показывает практика, интерпретатор для одного из упомянутых языков все же должен присутствовать в системе.  
  
# Права, файлы, пути и конфиги

Вторая категория, которую можно выделить в поднятии привилегий, — это способы, не связанные с использованием эксплойтов, а основанные на поиске файлов с некорректно выставленными правами. Здесь, как и в случае с Windows, есть свои хитрости, но в основном это все та же работа по сбору и анализу данных. Обычно первым делом ищутся файлы, которые доступны всем на чтение и запись:  

```
find / -perm 2 ! -type l -ls
```
