# Введение 

Когда злоумышленники или исследователи безопасности получают доступ к системе, чаще всего они начинают с ограниченными правами пользователя. Однако для выполнения определенных задач или атак могут потребоваться более высокие привилегии, например, доступ к защищенным файлам, изменение конфигурации системы или запуск привилегированных процессов. Повышение привилегий может быть выполнено различными способами, включая использование уязвимостей в программном обеспечении, службах или настройках системы, а также через социальную инженерию или атаки на слабые пароли. Этот процесс чрезвычайно важен для злоумышленников, поскольку он позволяет им расширить свои возможности и провести более широкий спектр атак на целевую систему.

Под повышением привилегий [понимается сетевая атака,](https://www.cynet.com/network-attacks/network-attacks-and-network-security-threats/) направленная на получение несанкционированного доступа более высокого уровня в системе безопасности. Обычно все начинается с того, что злоумышленники используют уязвимости для доступа к системе с ограниченными привилегиями. Затем злоумышленники повышают свои права доступа, чтобы получить контроль над более конфиденциальными системами или данными. Распространенными причинами успешного повышения привилегий являются недостаточные меры безопасности, несоблюдение принципа наименьших привилегий и уязвимости программного обеспечения, которые можно использовать. Это может привести к тому, что внешние субъекты угроз или инсайдеры получат неправомерный доступ.

Допустим, вы получили доступ к системе жертвы, что вы делаете дальше? Одним из ключевых шагов в такой ситуации является исследование возможностей для повышения привилегий. После того как вы получили ограниченные права доступа к системе, ваша цель заключается в расширении этих прав для выполнения более широкого спектра операций, включая доступ к защищенным файлам, запуск привилегированных процессов или изменение конфигурации системы. Повышение привилегий (Privilege Escalation) представляет собой критически важный аспект в области кибербезопасности, когда речь идет о тестировании на проникновение, анализе уязвимостей и защите информационных систем. Этот процесс заключается в получении или расширении доступа к системе, превышающего уровень привилегий, предоставленных исходно.

Для этого вы можете провести анализ системы на наличие уязвимостей, которые позволят вам получить дополнительные привилегии. Это может включать в себя поиск уязвимостей в используемых приложениях или операционной системе, использование слабых паролей или перебор паролей более привилегированных учетных записей, а также изучение настроек безопасности системы для выявления возможных ошибок или уязвимостей. Используя найденные уязвимости или методы атаки, вы можете попытаться выполнить код с повышенными привилегиями или получить доступ к учетным записям с более высокими правами.

Повышение привилегий – это эксплуатация уязвимостей в операционной системе или программном приложении, которая позволяет получить доступ к ресурсам, которые обычно защищены от определенного пользователя. В результате пользователь получает большие привилегии, чем предполагалось разработчиком или системным администратором, и может выполнять несанкционированные действия на системе.  Большинство компьютеров предназначено для использования несколькими пользователями. Привилегии дают пользователю возможность осуществлять определенные действия. Общие привилегии – это просмотр и редактирование файлов, и изменение системных файлов.

**Wiki:**
**Повышение привилегий** — это использование компьютерного [бага](https://ru.wikipedia.org/wiki/%D0%9F%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%BD%D0%B0%D1%8F_%D0%BE%D1%88%D0%B8%D0%B1%D0%BA%D0%B0 "Программная ошибка"), уязвимостей, ошибки в конфигурации [операционной системы](https://ru.wikipedia.org/wiki/%D0%9E%D0%BF%D0%B5%D1%80%D0%B0%D1%86%D0%B8%D0%BE%D0%BD%D0%BD%D0%B0%D1%8F_%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D0%B0 "Операционная система") или [программного обеспечения](https://ru.wikipedia.org/wiki/%D0%9F%D1%80%D0%B8%D0%BA%D0%BB%D0%B0%D0%B4%D0%BD%D0%BE%D0%B5_%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%BD%D0%BE%D0%B5_%D0%BE%D0%B1%D0%B5%D1%81%D0%BF%D0%B5%D1%87%D0%B5%D0%BD%D0%B8%D0%B5 "Прикладное программное обеспечение") с целью повышения уровня доступа к [вычислительным ресурсам](https://ru.wikipedia.org/w/index.php?title=%D0%92%D1%8B%D1%87%D0%B8%D1%81%D0%BB%D0%B8%D1%82%D0%B5%D0%BB%D1%8C%D0%BD%D1%8B%D0%B5_%D1%80%D0%B5%D1%81%D1%83%D1%80%D1%81%D1%8B&action=edit&redlink=1 "Вычислительные ресурсы (страница отсутствует)"), которые обычно защищены от [пользователя](https://ru.wikipedia.org/wiki/%D0%9F%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D1%8C "Пользователь"). В итоге, приложение, обладающее бо́льшими [полномочиями](https://ru.wikipedia.org/wiki/%D0%9F%D0%BE%D0%BB%D0%BD%D0%BE%D0%BC%D0%BE%D1%87%D0%B8%D0%B5_(%D0%B8%D0%BD%D1%84%D0%BE%D1%80%D0%BC%D0%B0%D1%82%D0%B8%D0%BA%D0%B0) "Полномочие (информатика)"), чем предполагалось [системным администратором](https://ru.wikipedia.org/wiki/%D0%A1%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D0%BD%D1%8B%D0%B9_%D0%B0%D0%B4%D0%BC%D0%B8%D0%BD%D0%B8%D1%81%D1%82%D1%80%D0%B0%D1%82%D0%BE%D1%80 "Системный администратор"), может совершать [неавторизированные](https://ru.wikipedia.org/wiki/%D0%90%D0%B2%D1%82%D0%BE%D1%80%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F "Авторизация") действия. «Повышением привилегий» называют ситуацию, когда пользователь компьютерной системы каким-либо образом повышает свои полномочия в этой системе (другими словами: получил возможность делать то, чего прежде делать не мог).

Такая [ошибка](https://ru.wikipedia.org/wiki/%D0%9F%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%BD%D0%B0%D1%8F_%D0%BE%D1%88%D0%B8%D0%B1%D0%BA%D0%B0 "Программная ошибка") в программе, как внедрение [кода](https://ru.wikipedia.org/wiki/%D0%9A%D0%BE%D0%B4 "Код") через [переполнение буфера](https://ru.wikipedia.org/wiki/%D0%9F%D0%B5%D1%80%D0%B5%D0%BF%D0%BE%D0%BB%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5_%D0%B1%D1%83%D1%84%D0%B5%D1%80%D0%B0 "Переполнение буфера"), всегда нежелательна. Но, серьёзной эту ошибку можно считать лишь в том случае, если она повышает привилегии пользователя. В частности, если внедрение кода происходит на локальной машине, это привилегий не повышает: пользователь и без этого может выполнять исполняемые файлы. Если же удаётся внедрить код через сеть, это уже повышение привилегий: у пользователя появилась возможность выполнять [машинный код](https://ru.wikipedia.org/wiki/%D0%9C%D0%B0%D1%88%D0%B8%D0%BD%D0%BD%D1%8B%D0%B9_%D0%BA%D0%BE%D0%B4 "Машинный код").


Существует два типа повышения привилегий:

- Горизонтальное повышение привилегий — злоумышленник расширяет свои привилегии, захватывая другую учетную запись и злоупотребляя законными привилегиями, предоставленными другому пользователю. Чтобы узнать больше о горизонтальном повышении привилегий, ознакомьтесь с нашим руководством по [горизонтальному перемещению](https://www.cynet.com/network-attacks/lateral-movement-challenges-apt-and-automation/) .

- Вертикальное повышение привилегий — злоумышленник пытается получить больше разрешений или доступа с помощью существующей учетной записи, которую он скомпрометировал. Например, злоумышленник захватывает учетную запись обычного пользователя в сети и пытается получить права администратора или root-доступ. Это требует большей сложности и может принять форму [продвинутой постоянной угрозы](https://www.cynet.com/advanced-persistent-threat-apt-attacks/) .

# Возникновение

**Атаки с целью повышения привилегий** начинаются с того, что злоумышленники получают доступ в среду. Злоумышленник может закрепиться, используя отсутствующие исправления безопасности, [социальную инженерию](https://www.beyondtrust.com/blog/entry/top-social-engineering-attacks) или другие методы. Если позволяет время, они скрывают свою деятельность, чтобы остаться незамеченными. Независимо от того, включает ли это маскирование исходного IP-адреса или удаление журналов на основе используемых ими учетных данных, любое свидетельство их присутствия отражает индикатор компрометации (IoC). Как только организация обнаруживает вторжение, она может отслеживать намерения злоумышленника и потенциально приостановить или завершить сеанс доступа.

Как правило, второй шаг в цепочке кибератак включает в себя повышение привилегий учетным записям с правами администратора, root или более высокими привилегиями, чем учетная запись, изначально скомпрометированная. Конечно, возможно, что при первоначальном взломе была задействована учетная запись администратора или root. В этом случае злоумышленник продвинулся дальше в своих злонамеренных планах и, возможно, уже владеет средой.

Каждый локальный интерактивный сеанс или сеанс удаленного доступа представляет собой некоторую форму [привилегированного доступа](https://www.beyondtrust.com/resources/glossary/privileged-access-management-pam) , независимо от того, выполняется ли он человеком или машиной. Это включает в себя все: от гостевых привилегий, позволяющих только локальный вход в систему, до привилегий администратора или root для удаленного сеанса и потенциально полного контроля над системой. Таким образом, каждой учетной записи, которая взаимодействует с системой, назначены определенные привилегии.

Стандартная учетная запись пользователя редко имеет права на базу данных, конфиденциальные файлы или что-либо ценное. Итак, как [злоумышленник](https://www.beyondtrust.com/blog/entry/difference-between-a-threat-actor-hacker-attacker) перемещается по среде и получает права администратора или root, чтобы использовать их в качестве вектора атаки? Существует пять основных методов:

1. Использование учетных данных
2. Уязвимости и эксплойты
3. Неправильные конфигурации
4. Вредоносное ПО
5. Социальная инженерия

[Атаки](https://clickfraud.ru/zashhita-wordpress-s-pomoshhyu-x-frame-options-i-httponly-cookie/) с повышением привилегий возникают, когда [злоумышленники](https://clickfraud.ru/5-primerov-sklikivaniya-reklamy-zloumyshlennikami/) используют неправильную конфигурацию, [ошибки](https://clickfraud.ru/11-luchshih-instrumentov-otslezhivaniya-oshibok-dlya-sovremennyh-komand-razrabotchikov/), слабые [пароли](https://clickfraud.ru/kak-nastroit-paroli-v-akkaunte-google-poshagovoe-rukovodstvo/) и другие [уязвимости](https://clickfraud.ru/25-luchshih-seo-plaginov-dlya-wordpress-o-kotoryh-nuzhno-znat-pryamo-sejchas/), позволяющие получить доступ к защищенным ресурсам. Типичная [атака](https://clickfraud.ru/8-luchshih-sistem-predotvrashheniya-vtorzhenij/) начинается с получения злоумышленником доступа к [учетной записи](https://clickfraud.ru/kak-sdelat-sajt-za-3-prostyh-shaga/) с низким уровнем привилегий. Войдя в систему, злоумышленники изучают ее с целью выявления других [уязвимостей](https://clickfraud.ru/luchshie-instrumenty-eticheskogo-vzloma/), которые они могут использовать в дальнейшем. Затем они используют полученные привилегии для того, чтобы выдать себя за реальных пользователей, получить доступ к целевым ресурсам и выполнить различные задачи незамеченными.

Такие права позволяют злоумышленникам выполнять административные задачи, внедрять [вредоносное ПО](https://clickfraud.ru/luchshe-programmnoe-obespechenie-dlya-borby-so-sklikivaniem/) или совершать другие нежелательные действия. Например, они могут нарушить работу системы, изменить настройки [безопасности](https://clickfraud.ru/5-samyh-populyarnyh-instrumentov-dlya-vzloma-parolej/), похитить данные или скомпрометировать систему таким образом, что в ней останутся открытые «черные ходы», которые можно будет использовать в будущем.

В целом, как и при [кибератаках](https://clickfraud.ru/mozhet-li-kiberataka-privesti-k-travme/), повышение привилегий использует уязвимости систем и процессов в сетях, сервисах и приложениях. Предотвратить их можно, используя комбинацию эффективных методов и средств обеспечения безопасности. В идеале организация должна внедрять решения, способные [сканировать](https://clickfraud.ru/9-skanerov-wordpress-dlya-poiska-uyazvimostej-v-sisteme-bezopasnosti/), обнаруживать и предотвращать широкий спектр потенциальных и существующих уязвимостей и [угроз](https://clickfraud.ru/13-besplatnyh-onlajn-instrumentov-dlya-skanirovaniya-uyazvimostej-i-vredonosnogo-po-dlya-bezopasnosti-veb-sajtov/) безопасности.

Атаки с целью повышения привилегий обычно включают использование таких уязвимостей, как ошибки программного обеспечения, неправильные настройки и неправильный контроль доступа. Каждая учетная запись, которая взаимодействует с системой, имеет определенные привилегии. 

Взяв под свой контроль учетную запись пользователя низкого уровня и либо злоупотребляя чрезмерными привилегиями, либо увеличивая привилегии, злоумышленник получает точку входа в чувствительную систему. Злоумышленники могут находиться в системе в течение некоторого времени, проводя разведку и ожидая возможности расширить свой доступ. В конце концов, они найдут способ повысить привилегии до более высокого уровня, чем у учетной записи, которая изначально была скомпрометирована.

В зависимости от своей цели злоумышленники могут продолжать горизонтально получать контроль над дополнительными системами или повышать привилегии вертикально, чтобы получить административный и корневой контроль, пока не получат доступ ко всей среде.

# Как обнаружить атаки повышения привилегий

Предотвращение несанкционированного доступа и поддержание безопасности системы зависит от эффективных возможностей обнаружения. Существует несколько способов, с помощью которых организации могут обнаружить атаки с целью повышения привилегий, в том числе:

- **Аудит системных журналов.** Регулярно просматривайте системные журналы, чтобы выявить необычные закономерности или подозрительную активность, например, неоднократно неудачные попытки входа в систему или ненормальное использование команд.
- **Инструменты обнаружения аномалий.** Выявляйте отклонения от нормального поведения в вашей сети с помощью инструментов обнаружения аномалий. Например, внезапные изменения в ролях пользователей могут указывать на продолжающийся инцидент с повышением привилегий.
- **Аналитика поведения пользователей и объектов (UEBA).** [UEBA](https://www.proofpoint.com/us/threat-reference/user-entity-behavior-analytics-ueba "УЭБА") может выявлять потенциальные попытки повышения привилегий, используя алгоритмы машинного обучения, чтобы понять типичные модели поведения пользователей. Затем он может отправить предупреждение при отклонении от нормы.

- **Мониторинг паролей.** Внедрите мониторинг паролей, чтобы предупреждать вас, когда пароли изменяются без авторизации, что может указывать на то, что злоумышленник пытается сохранить свои повышенные привилегии с течением времени.
- **Системы обнаружения вторжений (IDS).** IDC может сканировать известные сигнатуры распространенных методов повышения привилегий, таких как эксплойты переполнения буфера или атаки SQL-инъекций. В результате они могут обнаружить инциденты на ранней стадии до того, как будет нанесен значительный ущерб.

Помните, что ни один метод не сможет отловить все возможные векторы атаки. Организациям необходимо иметь надежную защиту и меры превентивного обнаружения, использующие комбинацию стратегий.


# Векторы атак с целью повышения привилегий

Вектор атаки — это метод, с помощью которого субъект угрозы, хакер или злоумышленник получает доступ к системе, приложению или ресурсу для выполнения вредоносной деятельности. Это может включать в себя все: от установки вредоносного ПО, изменения файлов или данных до какой-либо формы постоянной разведки.

Векторы атак с привилегированной эскалацией, возможно, представляют собой наихудшие киберугрозы, поскольку злоумышленник может стать администратором и владельцем всех ресурсов информационных технологий в вашей компании. И благодаря этой власти ваши данные, активы, приложения и ресурсы потенциально могут попасть под ту или иную форму иностранного контроля. 

Теперь, когда мы понимаем методы привилегированных атак, давайте рассмотрим наиболее распространенные методы, с помощью которых привилегии и учетные данные скомпрометированы и, следовательно, украдены и использованы для эскалации. Вот наиболее важные векторы атак, используемые злоумышленниками для повышения привилегий:

## Использование учетных данных

Действительные однофакторные учетные данные (1FA — имя пользователя и пароль) позволят обычному пользователю пройти [аутентификацию на ресурсе](https://www.beyondtrust.com/blog/entry/understanding-authentication-vs-authorization) . Однако если злоумышленник знает имя пользователя, получение пароля учетной записи становится задачей взлома. Часто злоумышленник сначала нацеливается на системного администратора, поскольку его учетные данные часто имеют привилегии для прямого доступа к конфиденциальным данным и системам. Имея учетные данные и доступ системного администратора, [киберпреступник может действовать в горизонтальном направлении](https://www.beyondtrust.com/blog/entry/cybersecurity-strategies-to-stop-lateral-movement-attacks-leave-your-adversaries-marooned) , практически не вызывая подозрений, поскольку это доверенная привилегированная учетная запись.

Однофакторная аутентификация оставляет дверь широко открытой для злоумышленников, планирующих повысить привилегии. Если злоумышленники получат имя учетной записи привилегированного пользователя – даже без пароля – получение пароля станет вопросом времени. Как только они получат рабочий пароль, они смогут незаметно перемещаться по окружающей среде.

Даже если злоумышленник обнаружен и организация сбросит пароль или переустановит образ пораженной системы, у злоумышленника может быть способ сохранить постоянное присутствие — например, с помощью взломанного мобильного телефона или вредоносного ПО-руткита на устройстве. Поэтому важно тщательно искоренить угрозу и постоянно отслеживать аномалии.

Вот распространенные способы, которыми злоумышленники могут получить доступ к учетным данным:

### Взлом паролей

**Взлом пароля** предполагает попытку злоумышленников[](https://www.beyondtrust.com/blog/entry/password-cracking-101-attacks-defenses-explained)использовать различные программные методы и автоматизацию с помощью специализированных инструментов. Эти атаки могут привести к получению прав администратора, если учетной записи предоставлены эти права. Это еще одна причина ограничить количество учетных записей администратора в среде и обеспечить минимальные привилегии. Если учетная запись является администратором, злоумышленник может легко обойти другие меры безопасности, [добиться горизонтального перемещения](https://www.beyondtrust.com/blog/entry/cybersecurity-strategies-to-stop-lateral-movement-attacks-leave-your-adversaries-marooned) и случайно попытаться взломать пароли других привилегированных учетных записей. Раскрытие паролей – во многих случаях пароли доступны на открытом сайте, поскольку сотрудники делятся ими с другими, повторно используют их или хранят на своих компьютерах в виде открытого текста.

### Подбор пароля

Одним из самых популярных методов взлома паролей является простой **подбор пароля** . Случайное предположение редко бывает успешным, если только это не общий пароль или не основанное на словарном слове. Четкое угадывание — это своего рода искусство, но знание информации о личности цели повышает вероятность успешного угадывания. Соответствующая информация может быть собрана через социальные сети, прямое взаимодействие, вводящий в заблуждение разговор или даже данные, собранные и объединенные или агрегированные в результате предыдущих нарушений. Атаки с подбором пароля также, как правило, оставляют доказательства в журналах событий и приводят к автоматической блокировке учетной записи после «n» попыток.

Кроме того, если владелец учетной записи повторно использует пароли между ресурсами, то резко возрастают риски подбора пароля и горизонтального перемещения. Представьте себе человека, который везде использует только один или два базовых пароля — для всего своего цифрового присутствия и привилегированных учетных записей. К сожалению, это происходит постоянно!

Злоумышленники могут использовать общедоступную информацию о владельце учетной записи, чтобы угадать его пароль. Если злоумышленники угадают один пароль, они часто могут получить доступ к нескольким ресурсам за счет повторного использования пароля.

### Сёрфинг через плечо

**Сёрфинг через плечо** позволяет злоумышленнику получить информацию об учетных данных посредством наблюдения. Это включает в себя наблюдение за паролями, PIN-кодами и шаблонами пролистывания по мере их ввода, а также за паролями, записанными на стикере. Концепция серфинга на плечах проста, но древняя. Злоумышленник физически или с помощью электронного устройства, такого как камера, наблюдает за паролями, а затем повторно использует их для атаки. Поэтому мы все должны помнить о необходимости скрыть ввод PIN-кода нашего банкомата.

Злоумышленники могут наблюдать за действиями привилегированных лиц либо лично, через несанкционированный доступ к камерам, либо через кейлоггеры на своих устройствах, и таким образом получить доступ к паролям.

### Атаки по словарю 

**Атаки по словарю** — это автоматизированный метод (в отличие от взлома или угадывания паролей), использующий список паролей для действительной учетной записи для раскрытия пароля. Сам список представляет собой словарь слов. Обычные программы для взлома паролей используют эти списки общих слов, таких как «бейсбол», чтобы взломать пароль, взломать учетную запись и раскрыть полные учетные данные, используемые для аутентификации.

Если злоумышленник знает ресурс, который он пытается скомпрометировать, например, требования к длине и сложности пароля, он может настроить словарь для более эффективного нацеливания на ресурс. Поэтому более продвинутые программы часто используют словарь помимо смешивания чисел или общих символов в начале или конце попытки имитировать реальный пароль с требованиями к сложности.

Использование списков общих слов для автоматического объединения возможных паролей и попытки доступа к учетной записи. Злоумышленники могут настроить словарь в соответствии с известной длиной пароля и требованиями. Политики сложности паролей и ограничение количества повторов пароля эффективны против этих атак.

**Эффективный инструмент атаки по словарю позволяет злоумышленнику делать следующее:**

- Установите требования к сложности для длины, требований к символам и набора символов.
- Разрешить добавление слов вручную, например имен или других комбинаций слов, позволяющих идентифицировать личность.
- Включите типичные ошибки в написании часто используемых слов.
- Работа со словарями на нескольких языках слов

Наиболее распространенными методами снижения угрозы атаки по словарю являются попытки блокировки учетной записи и политики сложности паролей. Защита от блокировки означает, что после «n» раз неправильных попыток учетная запись пользователя автоматически блокируется на определенный период времени, а затем вручную разблокируется уполномоченным органом (т. е. службой поддержки) или с помощью решения для автоматического сброса пароля.

Во многих средах, особенно для нечеловеческих учетных записей, попытки блокировки учетной записи могут затруднить работу бизнеса. Поэтому многие отключают эту настройку безопасности. Следовательно, если ошибки входа в систему не отслеживаются в журналах событий, атака по словарю является эффективным вектором атаки для злоумышленника. Это особенно актуально, если для привилегированных учетных записей этот параметр не включен в качестве стратегии предотвращения.

### Атаки по радужным таблицам

Атака на пароли методом радужной таблицы (rainbow table) – это техника взлома, основанная на заранее вычисленных хэш-значениях для большого количества возможных паролей. Злоумышленники создают радужные таблицы, содержащие предварительно рассчитанные хэши паролей, а затем сравнивают полученные хэши с данными из таблицы для поиска соответствия и нахождения исходного пароля.

Для защиты от атаки методом радужной таблицы рекомендуется использовать безопасные хэш-функции и уникальные, сложные пароли, которые не могут быть легко подобраны или найдены в радужных таблицах. Также важно регулярно менять пароли и следить за их безопасностью, чтобы предотвратить возможные атаки. При использовании радужной таблицы предполагается, что злоумышленник знает алгоритм, используемый для хеширования паролей, и преобразует эти хэши в исходные пароли. Для успеха этих атак необходима некоторая начальная информация.

### Атаки методом перебора паролей 

**[Атаки методом перебора пароля](https://www.beyondtrust.com/blog/entry/brute-force-attack-threat-protection)** — наименее эффективный метод взлома пароля, поэтому их обычно используют в крайнем случае. В атаках методом перебора пароля используется программный метод, позволяющий перепробовать все возможные комбинации пароля. Этот метод эффективен для паролей с короткой длиной строки (символов) и сложностью, но может оказаться невозможным даже для самых быстрых современных систем с паролем из восьми и более символов.

Если пароль состоит только из букв алфавита, все заглавные или строчные (не смешанные), потребуется 8 031 810 176 попыток. У вас больше шансов выиграть в лотерею! Эта оценка также предполагает, что злоумышленник знает длину пароля и требования к его сложности. Другие факторы включают цифры, чувствительность к регистру и специальные символы на локализованном языке.

Злоумышленники обычно используют их в качестве крайней меры. Они эффективны только против более коротких паролей с ограниченной сложностью и без ограничений на количество повторов пароля.

Хотя атака методом перебора с правильными параметрами в конечном итоге позволит найти пароль, требуемое время и вычислительная мощность могут сделать проверку методом перебора бесполезной. А время, необходимое для выполнения атак, зависит не только от скорости, необходимой для генерации всех возможных перестановок паролей, но также от времени запроса и ответа в случае сбоя в целевой системе. Время задержки ответа — это то, что действительно важно при попытке подбора пароля.

### Распыление паролей 

**Распыление паролей** — это атака на основе учетных данных, которая пытается получить доступ к множеству учетных записей, используя несколько общих паролей. Концептуально это противоположно атаке методом перебора пароля. Это противоположность атаке методом перебора: автоматизированная попытка получить доступ к большому количеству учетных записей с использованием нескольких очень распространенных паролей.

Во время атаки с распылением пароля злоумышленник пытается использовать один часто используемый пароль (например, «12345678» или «Passw0rd») для многих учетных записей, прежде чем перейти к попытке ввести второй пароль. По сути, злоумышленник пробует использовать один и тот же пароль для каждой учетной записи пользователя в своем списке, прежде чем сбросить список и попробовать следующий пароль. Этот метод сводит к минимуму риск быть пойманным злоумышленником, позволяет избежать блокировки учетной записи и избежать обнаружения взлома одной учетной записи из-за времени между попытками.

### Pass-the-Hash (PtH) 

Предполагает использование хэша пароля NT Lan Manager вместо исходного открытого пароля. Хэш можно извлечь из активной памяти или получить другими методами, использующими уязвимости протокола аутентификации.

[**Pass-the-Hash**](https://www.beyondtrust.com/resources/glossary/pass-the-hash-pth-attack) — это метод взлома, позволяющий злоумышленнику аутентифицироваться на ресурсе с использованием базового хэша пароля пользователя NT LAN Manager (NTLM) вместо использования фактического удобочитаемого пароля учетной записи. После того как злоумышленник получит действительное имя пользователя и хэш пароля с помощью различных методов, таких как очистка активной памяти системы, он может использовать учетные данные для аутентификации на удаленном сервере или в службе с использованием аутентификации LM или NTLM.

Атаки PtH используют уязвимость реализации протокола аутентификации, при которой хэш пароля остается статическим для каждого сеанса, пока сам пароль не будет изменен. Вы можете выполнить PtH практически для любого сервера или службы, принимающей аутентификацию LM или NTLM, независимо от того, использует ли ресурс Windows, Unix, Linux или другую операционную систему. К сожалению, современные вредоносные программы могут содержать методы очистки памяти для получения хэшей, что делает потенциальной целью любого активно работающего пользователя, приложение, службу или процесс. Как только вы получите хэш, управление и контроль или другие средства автоматизации позволяют выполнить дополнительное горизонтальное перемещение или утечку данных.

Современные системы могут защититься от атак Pass-the-Hash различными способами. Однако частая смена пароля (после каждого интерактивного сеанса) является хорошей защитой от различия хеша между сеансами. [Решения по управлению паролями](https://www.beyondtrust.com/password-management) , которые часто меняют пароли или настраивают маркер безопасности, являются хорошей защитой от этого метода.

- Контрольные вопросы. Многие механизмы паролей полагаются на контрольные вопросы на случай, если пользователь забудет свой пароль. Это вопросы о жизни пользователя, многие из которых легко получить из социальных сетей или от людей, знающих пользователя, или из даркнета (многие базы данных секретных вопросов были раскрыты в результате предыдущих взломов).

- Подмена учетных данных — злоумышленники используют список имен пользователей или адресов электронной почты и паролей, которые они получили в результате предыдущих взломов или из даркнета, и пробуют его против учетных записей в целевой системе. Поскольку люди часто используют пароли повторно, этот метод имеет высокие показатели успеха.

### Перечисление идентификаторов

**Атаки с использованием перебора идентификаторов** , в том числе с использованием sudo, происходят, когда злоумышленник может применить такие методы, как грубая сила, чтобы либо угадать, либо подтвердить, что действительные пользователи доступны для аутентификации на ресурсе. Перечисление пользователей часто связано с веб-приложениями, хотя его также можно найти в любом приложении, требующем традиционного пользователя и аутентификацию на основе учетных данных. Двумя наиболее распространенными областями, в которых происходит перечисление пользователей, являются:

- На странице входа в приложение на основе неудачного ответа аутентификации.
- Функция «Забыли пароль», которая может вызвать рабочий процесс или ответ «учетная запись не найдена»

По сути, злоумышленник ищет ответ сервера на основе действительности предоставленных учетных данных, чтобы определить, действительна ли выбранная им учетная запись. Это общий механизм ответа для многих приложений.

Когда пользователь вводит действительное имя пользователя и неверный пароль, сервер возвращает ответ о том, что пароль неверен. Если злоумышленник вводит неверное имя пользователя, независимо от пароля, типичные приложения отвечают, что учетная запись не найдена. Следовательно, злоумышленник может определить, использует ли его попытка взлома действительную учетную запись и неправильный пароль, или же учетная запись, которую он пытается использовать, никогда не пройдет аутентификацию. Основываясь на автоматизации и проверке методом перебора, они могут перебирать действительные учетные записи для ресурса и предпринимать будущие привилегированные атаки на основе общих паролей, повторно используемых паролей или других паролей, полученных в результате предыдущих атак.

Наконец, если злоумышленник сможет определить шаблон именования компании (т. е. первую начальную фамилию), то построение списка для перебора и будущих атак станет намного проще.

### Изменение и сброс пароля

Как часто вы меняете пароли? Каждые 30 или 90 дней, когда вас об этом просят на работе? А как насчет дома? Как часто вы меняете пароли для своих банковских учетных записей, учетных записей электронной коммерции, потокового вещания или социальных сетей? Вероятно, не часто, если вообще когда-либо, и, что удивительно, это может быть нормально!

Без менеджера паролей сохранение уникальности и сложности всех паролей является непростой задачей даже для самого опытного специалиста по безопасности.

К сожалению, существует общий риск сброса (не путать с изменением) паролей, который делает их мишенью для злоумышленников. Сброс пароля — это принудительное изменение пароля кем-то другим, а не изменение, инициированное пользователем пароля. Риски, связанные со сбросом пароля, включают:

- Легко угадываемые пароли на основе шаблонов (как описано ранее) при сбросе
- Пароли сбрасываются по электронной почте или в текстовом сообщении и сохраняются конечным пользователем.
- Пароли, сбрасываемые службой поддержки, которые используются повторно каждый раз, когда запрашивается сброс пароля.
- Автоматический сброс пароля вслепую из-за блокировки учетной записи
- Пароли, которые передаются устно и могут быть услышаны вслух
- Сложный сброс пароля, записанный конечным пользователем

Каждый раз при сбросе пароля происходит неявное подтверждение того, что старый пароль находится под угрозой и его необходимо изменить. Возможно, он был забыт, срок его действия истек или вызвал блокировку из-за многочисленных неудачных попыток. Сброс, передача и хранение нового пароля представляют собой риск до тех пор, пока конечный пользователь не изменит пароль снова.

Злоумышленники могут легко скомпрометировать механизмы сброса пароля. Всякий раз при сбросе пароля существует неявный риск в процессе передачи и хранения нового пароля. Злоумышленники могут получить доступ к паролю, законно сброшенному пользователем, или запросить сброс пароля самостоятельно после взлома устройства.

## Привилегированные уязвимости и эксплойты

Уязвимости — это ошибки в коде, дизайне, реализации или конфигурации, которые могут привести к осуществлению вредоносной активности посредством эксплойта. Уязвимости могут касаться операционной системы, приложений, веб-приложений, инфраструктуры, облака и т. д. Они также могут включать протоколы, транспорт и связь между ресурсами из проводных сетей, Wi-Fi и тональных радиочастот (старая школа – т. е. клуб 2600).

Сама по себе уязвимость не позволяет добиться успеха привилегированному вектору атаки; это просто означает, что риск существует. В отсутствие эксплойта уязвимость — это просто потенциальная проблема. Сочетание уязвимости, доступного эксплойта, раскрытия ресурса, средств контроля и вероятности атаки — все это способствует тому, насколько эффективно уязвимость может быть использована против организации. Это помогает сформулировать оценку риска. Распространенным методом оценки является CVSS.

Когда дело доходит до реальных эксплойтов, некоторые из них являются лишь доказательством концепции, некоторые ненадежны, а другие легко превратить в оружие. Некоторые эксплойты включены в коммерческие инструменты тестирования на проникновение или в бесплатные хакерские инструменты с открытым исходным кодом. Кроме того, некоторые уязвимости продаются в темной сети для совершения киберпреступлений. Другие уязвимости используются исключительно национальными государствами до тех пор, пока они не будут исправлены или обнародованы (намеренно или нет).

Злоумышленники могут повысить привилегии, используя уязвимости в конструкции, реализации или конфигурации нескольких систем, включая протоколы связи, транспортные средства связи, операционные системы, браузеры, веб-приложения, облачные системы и сетевую инфраструктуру.

Уровень риска зависит от характера уязвимости и того, насколько критичной является система, в которой обнаружена уязвимость. Лишь небольшая часть уязвимостей допускает вертикальное повышение привилегий. Однако к любой уязвимости, которая может позволить злоумышленнику изменить привилегии, следует относиться с высокой степенью серьезности.

**Если программа в вашей системе имеет права root и содержит уязвимость, возникает риск повышения привилегий через эксплуатацию этой уязвимости.**

Когда программа на вашем компьютере или сервере имеет административные права (root или администратор), это означает, что она может выполнять определенные действия и изменять системные настройки. Если в этой программе обнаружена уязвимость, злоумышленники могут использовать ее для получения несанкционированного доступа к системе и повышения своих привилегий до уровня администратора. Это может привести к потенциально серьезным последствиям, таким как удаление или изменение важных файлов, установка вредоносного ПО или даже полный контроль над системой. Поэтому важно регулярно проверять и обновлять программное обеспечение, чтобы минимизировать риски уязвимостей и защитить систему от атак.

В следующих разделах приведены примеры уязвимостей, которые могут привести к повышению привилегий в Windows и Linux.

## Неправильные конфигурации

Ошибки конфигурации — это еще одна форма уязвимостей, которые можно использовать. Это недостатки, требующие смягчения, а не исправления.

Повышение привилегий очень часто происходит из-за неправильной настройки, например, из-за невозможности настроить аутентификацию для конфиденциальной системы, ошибок в конфигурации брандмауэра или открытых портов.

В чем разница между исправлением и смягчением последствий? Исправление подразумевает установку исправления программного обеспечения или прошивки для устранения уязвимости. Этот процесс обычно называют управлением исправлениями. С другой стороны, смягчение относится к изменению существующего развертывания, которое отклоняет (смягчает) риск от эксплуатации. Как правило, эти меры по снижению риска представляют собой просто изменение настроек или среды выполнения с использованием поддерживаемых функций.

Наиболее распространенные проблемы конфигурации, используемые для получения привилегий, связаны с учетными записями с плохими настройками безопасности по умолчанию. Примеры плохих настроек безопасности включают в себя:

- Пустые пароли или пароли по умолчанию для учетных записей администратора или root, установленные при первоначальной настройке.
- Небезопасный доступ, который не блокируется после первоначальной установки (часто из-за отсутствия опыта).
- Недокументированные бэкдоры в окружающую среду.
- Учетные записи защищены только с помощью однофакторной аутентификации и угадываемых или [взломанных паролей](https://www.beyondtrust.com/blog/entry/password-cracking-101-attacks-defenses-explained) или секретов.

Если уязвимость достаточно серьезна, злоумышленник может получить права root или администратора с минимальными усилиями.

Ошибки конфигурации облачных ресурсов представляют собой быстро растущий источник привилегированных атак на облака и XaaS-предложения.

Вот еще несколько примеров неправильных настроек безопасности, которые могут привести к повышению привилегий:

- Облачные хранилища доступны в Интернете без аутентификации.
- Пароли по умолчанию, используемые для учетных записей администратора или root (это обычное явление для устройств IoT).
- Небезопасные настройки по умолчанию для вновь установленной системы, которые не изменяются по небрежности или недостатку знаний.
- Бэкдор в среду, который был известен администраторам, но не задокументирован и обнаружен злоумышленником.

## Вредоносное ПО

**Вредоносное ПО** — это любая часть компьютерного программного обеспечения (включая встроенное ПО, микрокод и т. д.), написанная с целью повредить устройства, украсть данные и, как правило, заставить ресурс вести себя не так, как предполагалось. Злоумышленники могут использовать многие типы вредоносных программ, включая трояны, шпионские программы, черви и программы-вымогатели, чтобы получить контроль над средой и повысить привилегии. Вредоносное ПО может быть развернуто путем использования уязвимости, может быть упаковано с законными приложениями, через вредоносные ссылки или загрузки в сочетании с социальной инженерией или через слабые места в цепочке поставок.

Вредоносное ПО, к которому относятся вирусы, шпионское ПО, черви, рекламное ПО, программы-вымогатели и т. д., относится к любому классу нежелательного или неавторизованного программного обеспечения, предназначенного для злонамеренного воздействия на ресурс. Намерения могут варьироваться от наблюдения, кражи данных, нарушения порядка, командования и контроля, отказа в обслуживании до вымогательства. Вредоносное ПО предоставляет злоумышленникам возможность контролировать киберпреступную деятельность.

Независимо от механизма доставки вредоносного ПО, целью является выполнение кода на ресурсе. После запуска он превращается в гонку между обнаружением [поставщиками средств безопасности конечных точек](https://www.beyondtrust.com/resources/glossary/endpoint-security) и злоумышленниками за продолжение выполнения, уклонение от обнаружения и сохранение устойчивости. Современное вредоносное ПО продолжает развиваться, чтобы лучше ускользать от обнаружения и отключать киберзащиту, чтобы продолжить свое распространение.  Вредоносное ПО может выполнять такие функции, как очистка памяти для получения хэшей паролей и регистрация нажатий клавиш. Это позволяет красть пароли для выполнения атак на основе привилегий самого вредоносного ПО или других векторов атак, развернутых злоумышленником.

Вредоносное ПО — это всего лишь транспортное средство для продолжения распространения устойчивой атаки. Таким образом, вредоносному ПО в конечном итоге необходимы разрешения для получения целевой информации, которую ищет злоумышленник. Подмножество вредоносного ПО, которое очищает память, устанавливает дополнительное вредоносное программное обеспечение или обеспечивает наблюдение, является наиболее подходящим для эскалации привилегий. Его цель — наблюдение для выполнения вертикальной привилегированной атаки в будущем.

Вредоносное ПО, как и любая другая программа, потенциально может выполняться с любым разрешением от обычного пользователя до администратора (root) в зависимости от контекста, в котором оно было первоначально запущено. Вредоносное ПО обычно запускается как процесс операционной системы и имеет разрешения учетной записи пользователя, из которого оно было запущено. Итак, есть два направления эксплуатации:

- Злоумышленники, получившие доступ к учетной записи пользователя, могут развернуть вредоносное ПО на уровне пользователя, а затем найти способ повысить свои привилегии.

- Злоумышленники, уже получившие повышенные привилегии, могут развернуть вредоносное ПО на уровне администратора или root и использовать его для получения постоянного доступа ко всей среде.

Вот распространенные примеры вредоносных программ, которые можно использовать для повышения привилегий:

- Черви – вредоносное ПО, использующее ошибки и уязвимости для доставки вредоносной полезной нагрузки и распространения на другие системы. Черви — распространенный механизм горизонтального повышения привилегий.

- Руткиты – вредоносный процесс, запущенный на целевом устройстве, который предоставляет злоумышленнику полный контроль над его операционной системой, обеспечивая вертикальное повышение привилегий.

- Плохие боты — автоматизированные механизмы, совершающие вредоносные действия против целевых ресурсов. Ботов можно использовать на этапе разведки атаки с целью повышения привилегий, а также они часто используются для распространения червей.

- Троян – вредоносная программа, замаскированная под обычный файл или приложение, которая сохраняется на устройстве пользователя и может внедрять другие вредоносные программы или изменять работу системы. Многие атаки на основе аутентификации основаны на троянах.

- Программы-вымогатели – программы-вымогатели могут быстро распространяться по сетям и служить механизмом горизонтального повышения привилегий.

- Рекламное ПО – вредоносное ПО, которое загружает пользователю нежелательную рекламу. Взаимодействие с этими объявлениями может привести к установке на устройстве дополнительных вредоносных программ, которые будут служить механизмом вертикального повышения привилегий.

- Шпионское ПО – шпионское ПО осуществляет наблюдение за устройством, например, отслеживая действия пользователя на клавиатуре или предоставляя доступ к экрану, микрофону или камере. Злоумышленники могут использовать эти входные данные для кражи учетных данных и компрометации учетных записей пользователей.

## Социальная инженерия

Атаки социальной инженерии основаны на доверии людей к сообщениям (голос, электронная почта, текстовые сообщения и т. д.), адресованным им. Если сообщение хорошо составлено и потенциально даже подделывает того, кому доверяют, то злоумышленник уже преуспел на первом этапе атаки.

Социальная инженерия используется практически во всех кибератаках. Он основан на манипулировании людьми с целью нарушения процедур безопасности и разглашения конфиденциальной или личной информации. Это очень распространенный метод, используемый злоумышленниками для получения несанкционированного доступа и повышения привилегий.

Социальная инженерия очень эффективна, поскольку она обходит меры безопасности, охотясь на человеческие слабости и эмоции. Злоумышленники понимают, что гораздо проще обмануть или манипулировать привилегированным пользователем, чем взломать хорошо защищенную систему безопасности.

Вот распространенные типы атак социальной инженерии и то, как они используются для повышения привилегий:

- Фишинг – злоумышленник отправляет сообщение, которое выглядит легитимным, с вредоносной ссылкой или вложением. Если жертва щелкает ссылку или выполняет вложение, злоумышленник обычно устанавливает вредоносное ПО и подвергает риску свое устройство. В зависимости от типа вредоносного ПО это может позволить злоумышленнику завладеть учетными данными пользователя.

- Целевой фишинг – сложная форма фишинга, предназначенная для конкретного привилегированного пользователя или группы пользователей. Целенаправленный фишинг может позволить злоумышленникам получить доступ к учетным записям с высоким уровнем привилегий, например, принадлежащим системным администраторам, финансовым сотрудникам или старшим руководителям.

- Вишинг (голосовой фишинг) – злоумышленники звонят сотрудникам компании, выдавая себя за авторитетную фигуру, например, ИТ-персонала компании, банка или правоохранительных органов. Сотрудников можно обманом заставить предоставить конфиденциальную информацию, такую ​​как пароли или данные доступа, или даже заставить установить вредоносное ПО на свое устройство.

- Scareware – вредоносная программа, которая заставляет жертв думать, что их устройства заражены, и просит их загрузить дополнительное программное обеспечение или выполнить действие, которое на самом деле устанавливает вредоносное ПО на их компьютере. Как и другие методы, этот метод можно использовать для компрометации устройства жертвы и захвата ее учетной записи.

- Водопой – злоумышленник взломал веб-сайт, который посещает группа привилегированных лиц. Например, это может быть определенная страница в корпоративной интрасети. У любого сотрудника, посещающего страницу, в браузере может быть запущен вредоносный сценарий, или его можно обманом заставить щелкнуть вредоносную ссылку.

- Фарминг – схема мошенничества, при которой программное обеспечение, установленное на устройстве жертвы, отправляет ее на поддельный веб-сайт, выдавая себя за доверенное учреждение, такое как банк или правительственный веб-сайт. Затем жертву обманом заставляют предоставить личные данные, которые злоумышленник может использовать для захвата ее учетной записи.

Некоторые операционные системы более склонны к социальной инженерии, основанной просто на взаимодействии с пользователем. Например, социальная инженерия является более распространенным фактором атак с целью повышения привилегий Windows. С другой стороны, [атаки с целью повышения привилегий в Unix и Linux](https://www.beyondtrust.com/blog/entry/strategies-getting-control-unix-linux-privileged-accounts) редко являются результатом социальной инженерии, а скорее являются результатом неправильных конфигураций, уязвимостей и эксплойтов, а также целевых инсайдерских атак. Это верно просто потому, что Windows гораздо более распространена на настольных компьютерах конечных пользователей, чем другие операционные системы.

Однако эксплуатация учетных данных может произойти в любой операционной системе и на любом устройстве. Если учетные данные раскрываются с помощью любого из рассмотренных нами методов, то привилегированная эскалация может произойти с использованием любого из дополнительных методов, доступных злоумышленникам. Ни один актив, приложение или ресурс не застрахован от атаки на основе учетных данных. И никто из них не застрахован от эскалации привилегий. Применяя такие технологии, как единый вход (SSO) и многофакторную аутентификацию (MFA), организации могут снизить риски. Когда это сочетается с хорошей гигиеной кибербезопасности, такой как сегментация, управление привилегированным доступом (PAM), управление исправлениями, управление уязвимостями и контроль изменений, возникает мощная эшелонированная защита. Но помните: ни один из этих методов обеспечения безопасности не является эффективным на 100%.

# Повышение привилегий Windows

 В операционных системах Windows существует множество методов повышения привилегий. Вот краткий обзор пяти распространенных методов и способов их предотвращения. Windows сталкивается со своей долей инцидентов, связанных с повышением привилегий, прежде всего потому, что многие предприятия полагаются на нее в своих бизнес-операциях. 
## Управление токенами доступа

**Описание атаки**

**Манипулирование токенами доступа** предоставляет злоумышленникам возможность изменять токены доступа для работы в контексте безопасности другого пользователя или системы, а также для выполнения действий и обхода контроля доступа. Операционная система Microsoft Windows использует токены доступа для определения принадлежности запущенного процесса во время выполнения. Пользователь может манипулировать токенами доступа, чтобы запущенный процесс выглядел так, как будто он является дочерним элементом другого процесса или принадлежит другому пользователю, а не тому, кто запустил процесс. В этом случае процесс также принимает атрибуты безопасности, связанные с новым токеном.

API Windows позволяет злоумышленнику копировать токены доступа из существующих процессов. Это называется кражей токенов. Применение украденных токенов к существующему процессу или использование их для создания нового процесса аналогично краже или выдаче себя за другое лицо в реальном мире. К счастью, чтобы украсть токен, злоумышленнику необходимо быть администратором.

Однако злоумышленники обычно используют кражу токенов, чтобы повысить уровень процессов своего профиля от администратора до работы в качестве СИСТЕМЫ. Кроме того, украденный токен можно использовать для [горизонтального перемещения](https://www.beyondtrust.com/blog/entry/cybersecurity-strategies-to-stop-lateral-movement-attacks-leave-your-adversaries-marooned) для аутентификации в удаленной системе, если учетная запись для этого токена может аутентифицироваться как действительный пользователь в удаленной системе. Например, любой обычный пользователь может использовать команду «Запуск от имени» через пользовательский интерфейс или командную строку, а также функции Windows API для создания токена олицетворения. Фактический доступ администратора к учетной записи не является обязательным. Таким образом, это обеспечивает метод привилегированной атаки, если злоумышленник имеет локальный доступ к хосту.

**Манипулирование токенами доступа.** Этот метод включает манипулирование токенами, связанными с привилегированными учетными записями, чтобы обманом заставить систему предоставить доступ более высокого уровня, чем предполагалось.

Windows использует токены доступа для определения владельцев запущенных процессов. Когда процесс пытается выполнить задачу, требующую привилегий, система проверяет, кто является владельцем процесса, и проверяет, есть ли у него достаточные разрешения. Манипулирование токенами доступа включает в себя обман системы, заставляя ее поверить в то, что запущенный процесс принадлежит кому-то другому, а не пользователю, который запустил процесс, предоставляя этому процессу разрешения другого пользователя.

**Техники**

Существует три способа манипулирования токенами доступа:

- Дублирование токена доступа с помощью Windows DuplicationToken(Ex) и последующее использование функции ImpersonateLoggedOnUser или SetThreadToken для назначения олицетворенного токена потоку.
- Создание нового процесса с олицетворенным токеном с использованием функции DuplicateToken(Ex) вместе с функцией CreateProcessWithTokenW.
- Использование имени пользователя и пароля для создания токена с помощью функции LogonUser. У злоумышленника есть имя пользователя и пароль, и, не входя в систему, он создает сеанс входа в систему, получает новый токен и использует SetThreadToken, чтобы назначить его потоку.

В этом методе у злоумышленника есть имя пользователя и пароль, но пользователь не авторизован.

**смягчение последствий**

В Windows невозможно отключить токены доступа. Однако для реализации этого метода злоумышленник уже должен иметь доступ на административном уровне. Лучший способ предотвратить атаку — назначить административные права в соответствии с принципом наименьших привилегий, регулярно проверять административные учетные записи и отзывать их, если доступ больше не нужен. Кроме того, отслеживайте привилегированные учетные записи на предмет любых признаков аномального поведения.

## Обход контроля учетных записей пользователей

**Описание атаки**

**Методы обхода UAC (контроля учетных записей пользователей)** предоставляют злоумышленникам возможность [обойти средства контроля безопасности UAC](https://www.beyondtrust.com/blog/entry/user-account-control-best-practices) и повысить привилегии запущенных процессов в системе. [Функциональность Windows UAC](https://www.beyondtrust.com/blog/entry/user-account-control-best-practices) позволяет программе повысить свои привилегии для выполнения задачи после запроса пользователя принять изменения в ее разрешениях во время выполнения. Пользователь может выбрать эти параметры на основе запроса UAC:

- Запретить операцию, чтобы продолжить, и немедленно завершить процесс.
- Разрешить пользователю выполнять действие, если он входит в группу локальных администраторов.
- Попросите пользователя предоставить учетные данные, у которых есть права для продолжения операции.

В зависимости от уровня защиты UAC, установленного на компьютере (защищен только высокий), некоторые приложения Windows могут повышать привилегии или выполнять некоторые функции операционной системы, например COM, без запроса пользователя. Злоумышленник может обойти контроль UAC, если уровень защиты установлен ниже «высокого» для совместимости приложений или удобства использования. Вредоносное программное обеспечение также может быть внедрено в доверенный процесс для получения повышенных привилегий без запроса пользователя, что делает этот привилегированный вектор атаки лучшим выбором для эксплуатации.

**Обход контроля учетных записей пользователей (UAC).** Злоумышленник может попытаться обойти предупреждения UAC, предназначенные для предотвращения несанкционированных изменений, используя скрытые процессы, которые не вызывают эти предупреждения.

Механизм контроля учетных записей пользователей Windows (UAC) проводит различие между обычными пользователями и администраторами. Он ограничивает все приложения стандартными разрешениями пользователя, если только это специально не разрешено администратором, чтобы предотвратить угрозу компрометации операционной системы вредоносным ПО. Однако если защита UAC не находится на самом высоком уровне, некоторые программы Windows могут повышать привилегии или выполнять COM-объекты с административными привилегиями.

**смягчение последствий**

Проверьте ИТ-системы и убедитесь, что защита UAC установлена ​​на самом высоком уровне, или, если это невозможно, примените другие меры безопасности. Регулярно проверяйте, какие учетные записи входят в группу локальных администраторов в конфиденциальных системах, и удаляйте обычных пользователей, у которых не должно быть прав администратора.

## Перехват порядка поиска DLL

**Описание атаки**

Злоумышленники могут выполнить «предварительную загрузку DLL». Это включает в себя установку вредоносной DLL с тем же именем, что и у легитимной DLL, в место, которое система ищет перед легитимной DLL. Зачастую это текущий рабочий каталог, а в некоторых случаях злоумышленники могут удаленно установить в качестве рабочего каталога внешний файловый том. Система находит DLL в рабочей папке, думая, что это настоящая DLL, и запускает ее.

**Техники**

Существует несколько других способов перехвата порядка поиска DLL:

- Замена существующей DLL или изменение файла, каталога или соединения перенаправления .manifest или .local.
- Выполнение перехвата DLL порядка поиска в уязвимой программе с более высоким уровнем привилегий, в результате чего DLL злоумышленника запускается с тем же уровнем привилегий. Это можно использовать для повышения привилегий от пользователя до администратора или от администратора до СИСТЕМЫ.
- Сокрытие атаки путем загрузки легитимных библиотек DLL вместе с вредоносными библиотеками DLL, чтобы системы выглядели как обычно.

**смягчение последствий**

Вот несколько способов предотвратить перехват порядка поиска DLL:

- Запретить загрузку удаленных DLL
- Включите безопасный режим поиска DLL, чтобы принудительно искать системные DLL в каталогах с более строгими ограничениями.
- Используйте инструменты аудита, такие как PowerSploit, для обнаружения уязвимостей, связанных с перехватом порядка поиска DLL, и их исправления.
- Выявляйте и блокируйте программное обеспечение, запущенное посредством перехвата порядка поиска, с помощью инструментов белого списка, таких как AppLocker.

## Залипающие клавиши

При попытке повышения привилегий в Windows я предпочитаю начинать с атаки с использованием «липкого ключа». Эту атаку довольно легко выполнить, и для ее проведения не требуется какой-либо продвинутый набор навыков. Для выполнения этой атаки вам понадобится физический доступ к машине и возможность загрузиться с восстановительного диска.

## Липкие клавиши

Липкие клавиши. Эта атака заменяет sethc(.exe) (приложение, отвечающее за липкие клавиши) на cmd(.exe) (командная строка). Это позволяет любому, кто пять раз нажмет клавишу «Shift» на экране входа в систему, получить права администратора без необходимости ввода учетных данных.

Атака на замену приложения sethc.exe (отвечающего за липкие клавиши) на cmd.exe (командную строку) – это техника, которая позволяет незаметно получить доступ к системе с правами администратора без необходимости ввода учетных данных. Этот метод заключается в подмене исполняемого файла sethc.exe на cmd.exe, что позволяет запустить командную строку с повышенными привилегиями при определенном действии со стороны пользователя.

При использовании липких клавиш (sticky keys), обычно при нажатии клавиши Shift пять раз подряд, вместо стандартной функции вызова диалогового окна для включения этой функции, запускается cmd.exe, предоставляя пользователю доступ к командной строке с правами администратора. Это позволяет атакующему выполнять различные команды и действия на зараженной системе.

Эта атака является серьезной угрозой для безопасности системы, поскольку позволяет обойти механизм аутентификации и получить привилегированный доступ к системе с минимальными усилиями. Для предотвращения подобных атак рекомендуется регулярно обновлять систему, использовать сильные пароли, а также контролировать доступ к исполняемым файлам и отслеживать изменения в системных файлах.

---

Атака "залипающие клавиши" и "липкие клавиши" являются различными видами атак, но оба они могут использоваться для повышения привилегий на компьютере.

Атака "залипающие клавиши" (sticky keys attack) заключается в изменении настроек операционной системы таким образом, что нажатие определенных клавиш (например, Shift, Control, Alt) вызывает открытие командной строки или запуск других уязвимых приложений с повышенными привилегиями.

Атака "липкие клавиши" (filter keys attack) происходит, когда злоумышленник изменяет настройки "липких клавиш" в Windows, что позволяет запускать команды с повышенными привилегиями при вводе определенных символов или комбинаций клавиш.

Хотя обе атаки направлены на получение повышенных привилегий на компьютере, они имеют различные методы и техники проведения. Тем не менее, в обоих случаях важно обеспечить безопасность компьютера и следить за настройками клавиатуры и операционной системы.

# Повышение привилегий Linux

Открытый исходный код Linux делает его уязвимым для определенных типов атак с целью повышения привилегий, в том числе:
## Что такое перечисление?

**Перечисление.** Злоумышленники собирают информацию о системе, например учетные записи пользователей или сетевые ресурсы, которые могут быть использованы для дальнейших атак.

В системах Linux злоумышленники используют процесс, называемый «перечислением», для выявления слабых мест, которые могут позволить повысить привилегии. Перечисление включает в себя:

- Используйте поиск Google, сканирование портов и прямое взаимодействие с системой, чтобы узнать о ней больше и посмотреть, как она реагирует на входные данные.
- Проверка доступности компиляторов или языков программирования высокого уровня, таких как Perl или Python, которые могут позволить злоумышленнику запустить код эксплойта.
- Идентификация компонентов программного обеспечения, таких как веб-серверы и их версии.
- Получение данных из ключевых системных каталогов, таких как /etc, /proc, ipconfig, lsof, netstat и uname.

Злоумышленники используют автоматизированные инструменты для выполнения перечисления в системах Linux. Вам также следует использовать те же инструменты для предотвращения атаки, сканируя собственную систему, выявляя слабые места и устраняя их.

Ниже приведены два конкретных метода повышения привилегий в Linux и способы их смягчения.

## Эксплойт ядра

**Описание атаки**

**Эксплуатация ядра.** Распространенный метод, при котором злоумышленники используют уязвимости ядра Linux для получения root-прав. Используя эти слабости, они могут выполнять вредоносные полезные нагрузки, которые позволяют им повышать привилегии.

Время от времени в ядре Linux обнаруживаются уязвимости. Злоумышленники могут использовать эти уязвимости для получения root-доступа к системе Linux, и как только система заразится эксплойтом, защититься от него невозможно.

Злоумышленники выполняют следующие действия:

1. Узнайте об уязвимостях
2. Разработайте или приобретите код эксплойта
3. Перенесите эксплойт на цель
4. Выполнить эксплойт на цели

**смягчение последствий**

Следите за отчетами о безопасности и своевременно устанавливайте обновления и исправления Linux. Ограничьте или удалите программы, которые позволяют передавать файлы, такие как FTP, SCP или Curl, или ограничьте их доступ к определенным пользователям или IP-адресам. Это может предотвратить передачу эксплойта на целевое устройство. Удалите или ограничьте доступ к компиляторам, таким как GCC, чтобы предотвратить выполнение эксплойтов. Вам также следует ограничить список папок, доступных для записи и выполнения.

## Использование прав SUDO

**Описание атаки**

**Использование права SUDO.** Злоумышленники часто пользуются плохо настроенными правами sudo. Если привилегированный пользователь небрежно распорядился своими правами доступа к sudo, злоумышленник может использовать эту оплошность в своих целях.

SUDO — это программа Linux, которая позволяет пользователям запускать программы с привилегиями безопасности другого пользователя. Более старые версии по умолчанию будут работать от имени суперпользователя (SU). Злоумышленники могут попытаться скомпрометировать пользователя, у которого есть доступ SUDO к системе, и в случае успеха они получают права root.

Распространенным сценарием является предоставление администраторами доступа некоторым пользователям для выполнения якобы безобидных команд SUDO, таких как «найти». Однако параметры контейнера команд «найти», которые позволяют выполнять команды, и поэтому, если злоумышленники скомпрометируют учетную запись этого пользователя, они смогут выполнять команды с привилегиями root.

**смягчение последствий**

Никогда не давайте права SUDO компилятору, интерпретатору или редакторам языков программирования, включая vi, more, less, nmap, perl, Ruby, Python, GDB. Не давайте права sudo любой программе, которая позволяет запускать оболочку. И строго ограничьте доступ SUDO, используя принцип наименьших привилегий.

В этой статье мы смогли охватить лишь несколько распространенных атак с целью повышения привилегий. Дополнительные сведения об атаках и дополнительные сведения о том, как смягчить и обнаружить каждую атаку, см. в разделе Тактика повышения привилегий [MITRE ATT&CK .](https://attack.mitre.org/tactics/TA0004/)

## Защита от повышения привилегий с помощью Cynet

Cynet 360 — это комплексное решение безопасности, которое может помочь в трех важных аспектах повышения привилегий: сетевой безопасности, безопасности конечных точек и поведенческой аналитике.

1. Сетевая аналитика

Сетевой анализ необходим для обнаружения и предотвращения первоначального проникновения и повышения привилегий в вашей сети.

Задача — изощренные злоумышленники нацелены на слабые места организации. После первоначальной компрометации конечной точки злоумышленник пытается расширить свою зону действия и получить привилегии и доступ к другим ресурсам в вашей среде. Их конечная цель — получить доступ к вашим конфиденциальным данным и передать их в свои помещения. Ключевые части этих векторов атак можно обнаружить только с помощью сгенерированного аномального сетевого трафика.

Решение — [Cynet Network Analytics](https://www.cynet.com/advanced-threat-protection/network-analytics-from-detection-to-active-prevention/) постоянно отслеживает сетевой трафик, чтобы отслеживать и предотвращать вредоносную активность, которая в противном случае остается невидимой, например, кражу учетных данных и утечку данных.

2. Защита конечных точек и EDR

Несанкционированный доступ к конечным точкам является распространенной точкой входа в атаку с целью повышения привилегий.

Проблема в том, что злоумышленники с сильной мотивацией в конечном итоге обойдут меры предотвращения на конечной точке. Они будут использовать несколько инструментов, чтобы работать незаметно, пока не достигнут желаемого результата.

Решение: [Cynet EDR](https://www.cynet.com/endpoint-protection-and-edr/top-6-edr-tools-compared/) постоянно отслеживает конечные точки, поэтому защитники могут обнаружить активное вредоносное присутствие, немедленно понять его влияние и масштабы и отреагировать.

3. Аналитика поведения пользователей и событий

Поведенческий анализ может помочь вам обнаружить аномальную активность в системах организации или учетных записях пользователей, которая может указывать на попытки вторжения или повышение привилегий. Также особенно важно обнаружить повышение привилегий, осуществляемое злоумышленниками-инсайдерами.

Проблема в том, что злоумышленники, преследующие четкие цели или имеющие инсайдерские привилегии, могут обойти обнаружение, преуспеть в компрометации учетных записей пользователей и использовать их для доступа к данным и горизонтального перемещения.

**Решение-**

[Cynet User Behavior Analysis](https://www.cynet.com/platform/user-behaviour-analytics/) постоянно отслеживает и профилирует активность пользователей, чтобы установить допустимый базовый уровень поведения и обнаружить аномальную активность, которая предполагает компрометацию учетных записей пользователей или повышение привилегий.

Обнаружение повышения привилегий требует сложных мер безопасности. Хотя приведенные выше решения по предотвращению и обнаружению являются базовыми, организациям часто требуется дополнительная поддержка для обеспечения полной защиты своих систем.

# К чему мы пришли

Атаки с целью повышения привилегий также могут быть специфичны для операционных систем, в частности Linux и Windows.

Так мы пришли к следующему выводу: **"После получения доступа к системе с ограниченными привилегиями, существует несколько шагов, которые можно предпринять для повышения своих привилегий:"**

- Сбор информации о системе: Используйте команды для получения информации о версии операционной системы, обновлениях, установленных программных пакетах и службах. Это может помочь в выявлении уязвимостей.

- Исследование уязвимостей: Проанализируйте результаты сбора информации, чтобы определить, есть ли какие-либо известные уязвимости в используемых версиях программного обеспечения или операционной системы. Попробуйте найти эксплоиты, соответствующие этим уязвимостям.

- Исследование слабых мест в системе: Посмотрите, существует ли на системе недостаточно защищенные файлы, службы или процессы, которые могли бы быть использованы для повышения привилегий.

- Эксплуатация уязвимостей: Если вы нашли уязвимости, используйте соответствующие эксплоиты для получения дополнительных прав доступа к системе. Это может включать в себя использование уязвимостей в программном обеспечении, службах или конфигурации системы. 

- Использование уязвимостей в программном обеспечении: Поискайте известные уязвимости в установленных приложениях или операционной системе и используйте их для выполнения кода с повышенными привилегиями. 

- Поднятие привилегий через эксплоиты: Используйте известные уязвимости или эксплоиты, которые позволят вам выполнить код на системе с повышенными привилегиями. Это может включать в себя уязвимости в ядре операционной системы, службах или приложениях.

- Использование атак на слабые пароли: Если у вас есть доступ к учетной записи с ограниченными привилегиями, попробуйте подобрать или взломать пароли более привилегированных учетных записей. 

- Использование утилит повышения привилегий: На некоторых системах существуют утилиты, такие как sudo, su или runas, которые могут позволить вам временно или постоянно повысить свои привилегии. Попробуйте использовать эти утилиты, если они доступны.

- Использование слабых паролей или перебора паролей: Если у вас есть доступ к учетной записи с ограниченными привилегиями, попробуйте подобрать или взломать пароли более привилегированных учетных записей.

- Использование ошибок в системе авторизации: Поискайте способы обойти механизмы аутентификации или авторизации, чтобы получить доступ к более привилегированным ресурсам или функциям. 

- Изучение и изменение настроек безопасности: Изучите настройки безопасности системы, чтобы определить, существуют ли какие-либо уязвимости или ошибки в конфигурации, которые можно использовать для повышения привилегий.

- Использование уязвимостей в сетевых службах: Попробуйте найти уязвимости в сетевых службах или протоколах, которые могут позволить вам получить доступ к системе с повышенными привилегиями.

- Использование социальной инженерии: Попытайтесь убедить администратора системы предоставить вам дополнительные привилегии или доступ к конфиденциальной информации.

- Использование вредоносных программ: Запустите вредоносные программы или скрипты, которые могут помочь вам получить доступ к системе с повышенными привилегиями.

- Мониторинг и перехват трафика: Попробуйте перехватить или модифицировать сетевой трафик на системе, чтобы получить доступ к привилегированным ресурсам или функциям.

- Модификация привилегий с помощью эксплоитов: Используйте эксплоиты, которые специально разработаны для изменения привилегий на целевой системе.

- Изучение и эксплуатация служб и сервисов: Просмотрите запущенные службы и сервисы на машине, чтобы определить, есть ли какие-либо уязвимости в них. Это может включать веб-серверы, базы данных, FTP-серверы и т. д.

- Использование социальной инженерии: Попробуйте ввести администратора системы в доверие, чтобы он предоставил вам дополнительные привилегии или доступ к конфиденциальной информации.

- Получение удаленного доступа: Если у вас есть ограниченный доступ к системе, попробуйте получить удаленный доступ, например, с помощью вредоносного ПО или бэкдоров, чтобы облегчить последующие атаки. 

- Маскировка вредоносных действий: После получения дополнительных привилегий убедитесь, что ваши действия на системе не вызовут подозрений и не будут обнаружены.


# Заключение 

**Атака с повышением привилегий** — это кибератака с целью получить незаконный доступ к повышенным правам, разрешениям, полномочиям или привилегиям, выходящим за рамки тех, которые назначены для личности, учетной записи, пользователя или машины. В этой атаке может участвовать внешний субъект угрозы или внутренняя угроза. Повышение привилегий является ключевым этапом цепочки [кибератак](https://www.beyondtrust.com/resources/glossary/cyber-attack-chain) и обычно включает использование уязвимостей повышения привилегий, таких как системная ошибка, неправильная конфигурация или неадекватный контроль доступа.

В этом блоге я объясню, как работает повышение привилегий, ключевые векторы атак, связанные с повышением привилегий, а также критические элементы управления безопасностью привилегированного доступа, которые вы можете реализовать, чтобы предотвратить или смягчить его.