 
Ldd — это утилита командной строки Linux, которая используется в случае, если пользователь хочет узнать зависимости от общей библиотеки исполняемого файла или даже от общей библиотеки. Вы могли заметить множество файлов, начинающихся с lib*, в каталогах /lib и /usr/lib вашего компьютера с Linux. Эти файлы называются библиотеками. Библиотека — это набор ресурсов, таких как подпрограммы/функции, классы, значения или спецификации типов.

Библиотека позволяет программе использовать общие подпрограммы без административных издержек, связанных с поддержкой их исходного кода, или издержек обработки, связанных с их компиляцией каждый раз, когда программа компилируется.

Существует два типа библиотек:

**Статические библиотеки:** статические библиотеки для полных программ, выполнение которых не зависит от внешних библиотек. Особенность статически связанных программ в том, что они работают без установки каких-либо предварительных условий. Статическая библиотека заканчивается `*.a`extension и эти библиотеки включены (отдельным экземпляром) в программы, которым требуются его функции.

**Динамические библиотеки:** динамические библиотеки для крошечных по размеру программ. Эти библиотеки заканчиваются на `.so`расширение, Еще одна особенность использования динамической компоновки, когда запущено много программ. Он может совместно использовать одну копию библиотеки, а не занимать память множеством копий одного и того же кода. Поэтому последние программы используют динамическую компоновку. В этой статье мы рассмотрим команды `ldd` который используется для управления общими библиотеками.

Общие объектные файлы оптимизируют программы, предоставляя приложениям информацию, необходимую для выполнения их работы, но это не обязательно должно быть частью самого приложения. Чтобы узнать, какой из этих файлов вызывает команда Linux, используйте **команду ldd** .

Библиотека представляет собой набор ресурсов, таких как подпрограммы / функции, классы, значения или спецификации типов.



### Общие библиотеки

Файлы общих объектов (обозначенные как .so) — это библиотеки, которые автоматически подключаются к программе при ее запуске, но существуют как отдельные файлы. Они содержат информацию, которая может использоваться одной или несколькими программами для разгрузки ресурсов, поэтому любая программа, вызывающая файл .so, не должна сама предоставлять все необходимые инструменты. Эти файлы могут быть связаны с любой программой и загружены в любое место памяти.

Один файл .so может содержать информацию и функции для быстрого поиска по всему компьютеру или выполнения очень сложных вычислений. Затем несколько программ могут обращаться к этому файлу .so. На самом деле файлы .so можно обновлять/заменять без необходимости внесения этими программами каких-либо изменений в свой собственный код.

Когда мы делаем программу, нам нужно много фрагментов кода, которые кто-то уже написал, чтобы выполнять за нас рутинные или специализированные функции. Эти фрагменты кода хранятся в разделяемых библиотеках. Чтобы использовать их, мы связываем их с нашим кодом либо при сборке программы, либо при ее запуске.

Общие библиотеки могут быть связаны с любой программой во время выполнения. Думайте о них как о фрагментах кода, которые могут использоваться многими различными программами, что позволяет этим программам быть меньше и намного эффективнее, чем гарантировать, что все программы, которые их используют, содержат их и обновляются по мере необходимости, если код изменяется.

## Команда ldd

Команда ldd выводит зависимости общих объектов. Синтаксис команды:

```
ldd [OPTIONS]... FILE...
```

**ПАРАМЕТРЫ**

- -v : вывести всю информацию.
- -d : перемещение данных процесса.
- -r : данные процесса и перемещение функций.
- -u : вывести неиспользуемые прямые зависимости.

Перед выполнением команды запишите следующие моменты:

- Файл ld-linux.so является динамическим компоновщиком или загрузчиком, который проверяет наличие нужной ссылки или кеша библиотеки для запрошенной программы и загружает ее.
- Файл кеша /etc/ld.so.cache содержит список библиотек, найденных в каталогах, указанных в /etc/ld.so.conf. Это помогает обеспечить более быстрое динамическое связывание.
- В файле /etc/ld.so.conf указаны каталоги, в которых нужно искать библиотеки.

## Установить ldd

ldd устанавливается по умолчанию в большинстве дистрибутивов Linux. Если вы получаете сообщение об ошибке ldd command not found, установите его, используя:

**Убунту/Дебиан**

```
apt install libc-bin
```

**RedHat/CentOS поток**

```
yum install glibc-common
```

**Федора**

```
dnf install glibc-common
```

**Арка**

```
pacman -S glibc
```

## Как использовать команду ldd

Давайте рассмотрим некоторые полезные способы использования команды ldd.

### Показать зависимости команды

Мы покажем зависимости команды cp.

```
ldd /bin/cp
```

### Показать зависимости команды с подробностями

Мы будем отображать зависимости `cp`команда с более подробной информацией, используя `-v`вариант.

```
ldd -v /bin/cp
```

### Показать неиспользуемые прямые зависимости команды

Мы можем отобразить неиспользуемые прямые зависимости `cp`команда с использованием `-u`вариант.

```
ldd -u /bin/cp
```


Команда ldd показывает нам общие зависимости объекта двоичного файла:

```
ldd hello
```

![[Pasted image 20230625095317.png]]

В выходных данных есть три записи, и две из них включают путь к каталогу (первая не содержит):

- **linux-vdso.so:** [виртуальный динамический общий объект (VDSO)](https://en.wikipedia.org/wiki/VDSO) — это механизм ядра, который позволяет двоичному файлу пользовательского пространства получить доступ к набору подпрограмм пространства ядра. Это [позволяет избежать накладных расходов на переключение контекста](https://en.wikipedia.org/wiki/Context_switch#User_and_kernel_mode_switching) из пользовательского режима ядра. Общие объекты VDSO придерживаются формата Executable and Linkable Format (ELF), что позволяет динамически связывать их с двоичным файлом во время выполнения. VDSO выделяется динамически и использует преимущества ASMR. Возможности VDSO предоставляются стандартной [библиотекой GNU C,](https://en.wikipedia.org/wiki/GNU_C_Library) если ядро ​​поддерживает схему ASMR.
- **libc.so.6:** общий объект GNU [C Library](https://man7.org/linux/man-pages/man7/libc.7.html) .
- **/lib64/ld-linux-x86-64.so.2:** это динамический компоновщик, который хочет использовать двоичный файл. Динамический компоновщик [опрашивает двоичный файл, чтобы узнать, какие у него есть зависимости](https://man7.org/linux/man-pages/man8/ld.so.8.html) . Он запускает эти общие объекты в память. Он подготавливает двоичный файл к запуску и позволяет находить и получать доступ к зависимостям в памяти. Затем он запускает программу.