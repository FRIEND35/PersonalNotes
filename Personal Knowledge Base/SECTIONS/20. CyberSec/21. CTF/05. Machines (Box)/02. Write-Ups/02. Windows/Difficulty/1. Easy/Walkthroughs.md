
 
 # Devel

**Плошадка:** https://hackthebox.com
**Уровень:** Easy

## Введение

Это был простой Windows-бокс, который включал использование открытого FTP-сервера для загрузки оболочки ASPX и получения удаленного доступа к хосту, а также уязвимость MS10-015 KiTrap0D для повышения привилегий до SYSTEM.

## Разведка

## Сканирование 

Первое, что нужно сделать, это запустить сканирование TCP Nmap для 1000 наиболее распространенных портов и использовать следующие флаги:

  • -sC для запуска сценариев по умолчанию
  • -sV для перечисления версий приложений

![[Pasted image 20230704095850.png]]

На основании этого сканирования FTP и HTTP не открыты на удаленном хосте, поэтому следующими шагами будет их перечисление.


## Доступ к службе FTP (Anonymous access allowed)

Согласно сканированию Nmap, FTP-сервер допускает анонимную аутентификацию. При входе в него открывается индексная страница MicrosoftIIS по умолчанию:

![[Pasted image 20230704100202.png]]

Это означает, что через FTP можно загружать произвольные файлы, которые будут обслуживаться на веб-сервере, это можно использовать, загружая вредоносные исполняемые файлы и переходя к ним, чтобы веб-сервер выполнил их.

## Создание полезной нагрузки

Первый шаг — сгенерировать шелл-код с помощью MSFvenom со следующими флагами:

 • -p, чтобы указать тип полезной нагрузки, в данном случае обратная оболочка Windows TCP.
 • LHOST, чтобы указать IP-адрес локального хоста для подключения
 • LPORT, чтобы указать локальный порт для подключения
 • -f указать формат оболочки, в данном случае ASPX

![[Pasted image 20230704100353.png]]

## Загрузка полезной нагруки (FTP)

Загрузка оболочки ASPX в корневой каталог веб-сервера через FTP:

![[Pasted image 20230704100407.png]]

Запускаем MSFConsole, выбираем модуль мультиобработчика, ставим и запускаем эксплойт:

  • payload, чтобы указать тип полезной нагрузки, в данном случае — обратную оболочку Java.
  • LHOST, чтобы указать IP-адрес локального хоста для подключения
  • LPORT, чтобы указать локальный порт для подключения

![[Pasted image 20230704100441.png]]

## Запуск полезной нагрузки 

Переход к оболочке ASPX, загруженной через FTP:

![[Pasted image 20230704100456.png]]

Получена оболочка Meterpreter:

![[Pasted image 20230704100512.png]]

## Повышение привилегий

Похоже, текущий доступ — это пользователь IIS по умолчанию:

![[Pasted image 20230704100546.png]]

Поиск локального модуля Meterpreter для подсказки эксплойтов (recon/local_exploit_suggester), выбор его и запуск для текущего сеанса:

![[Pasted image 20230704100729.png]]

> Metasploit suggester — это инструмент в рамках фреймворка Metasploit, который используется для идентификации уязвимостей в системах на основе версий программного обеспечения. Он автоматически анализирует информацию о версиях и компонентах системы, чтобы предложить возможные эксплойты и плагины Metasploit, которые могут использоваться для атаки на уязвимые системы. Metasploit suggester помогает исследователям и пентестерам в процессе определения наиболее подходящих эксплойтов для целевых систем. Этот модуль предлагает эксплойты локального интерпретатора, которые могут быть использовал. Эксплойты предлагаются на основе архитектуры и платформа, на которой у пользователя открыта оболочка, а также доступные эксплойты в meterpreter. Важно отметить что не все локальные эксплойты будут запущены. Эксплойты выбирается на основе следующих условий: тип сеанса, платформа, архитектура и необходимые параметры по умолчанию.


Модуль обнаружил несколько потенциальных эксплойтов, одним из которых является модуль MS10-015 KiTrap0D, использующий уязвимость, которая существует из-за того, что определенные версии ядра Windows не проверяют должным образом определенные
вызовы BIOS, что позволяет локальным пользователям получить привилегии, создав структуру данных VDM_TIB в блоке среды потока (TEB), а затем вызвав функцию NtVdmControl для запуска подсистемы Windows Virtual DOS Machine (также известной как NTVDM), что приводит к неправильной обработке исключений, связанных с обработчиком ловушек `#GP` (nt! KiTrap0D), также известная как «Уязвимость обработчика исключений ядра Windows».

Выбор модуля и указание следующих параметров:

  • SESSION, чтобы указать сеанс для запуска эксплойта.
  • LHOST, чтобы указать IP-адрес локального хоста для подключения
  • LPORT, чтобы указать локальный порт для подключения

![[Pasted image 20230704100851.png]]

Эксплойт был успешным и вернул оболочку уровня SYSTEM.

## Вывод

Хотя это окно было довольно простым, оно показывает, насколько опасным может быть использование открытых протоколов передачи файлов с включенным анонимным  входом в систему, особенно когда они позволяют напрямую загружать файлы на веб-сервер.


CTF (https://steflan-security.com/tag/ctf/)
Hack The Box (https://steflan-security.com/tag/hackthebox/)
Hacking (https://steflan-security.com/tag/hacking/)
HTB (https://steflan-security.com/tag/htb/)
Тестирование на проникновение (https://steflan-security.com/tag/penetration-testing/)
Пошаговое (https://steflan-security.com/tag/pentesting/)
руководство (https://steflan-security.com/tag/walkthrough/)
Windows (https://steflan-security.com/tag/windows/)

---

# Blue

**Плошадка:** https://hackthebox.com
**Уровень:** Easy
**Задача:** Найти файлы **user.txt** и **root.txt** на машине жертвы.

Сегодня мы собираемся решить еще одну задачу CTF «Blue», которая представляет собой лабораторию, представленную Hack the Box для
создания практик онлайн-проникновения в соответствии с вашим уровнем опыта. У них есть коллекция уязвимых лабораторий, от новичков до экспертного уровня. HTB имеет два раздела лаборатории, т. е. активную и выведенную из эксплуатации, поскольку мы не можем представить описание какой-либо активной лаборатории, поэтому мы выбрали повторную синюю лабораторию.

## Разведка

## Сканирование

Поскольку эти лаборатории доступны онлайн, поэтому они имеют статический IP-адрес, а IP-адрес синего цвета — 10.10.10.40 , поэтому давайте начнем с перечисления портов nmap.

```bash
nmap -p- -A 10.10.10.40 --open
```

Из приведенного ниже изображения вы можете заметить, что мы нашли так много открытых портов, а порты 137, 139 и 445 означают, что это машина с Windows.

![[Pasted image 20230704103329.png]]

Когда я извлекаю полный результат nmap, я обнаружил следующие детали

• ОС: Windows 7 профессиональная
• Имя компьютера: haris-pc
• Имя компьютера NetBIOS haris-pc
• SMB-версия: 02

**Большой!!**  Из этого результата я могу сделать вывод, что имя пользователя может быть «haris», кроме того, smb 2.02 может быть использован уязвимостью «eternalblue».

Название задачи у нас **Blue**, ОС машины **Windows** и на нем запушен **SMB**. Всё это говорить о **eternalblue**. 

![[Pasted image 20230704103610.png]]

## Поиск уязвимости 

Подтвердим уязвимость eternalblue в системе жертвы скриптом nmap.

```bash
nmap --script vuln -p445 10.10.10.40
```

**Потрясающий!!**  Машина жертвы уязвима для вечного синего эксплойта.

![[Pasted image 20230704103734.png]]

Затем я запускаю команду msfconsole в терминале и загружаю платформу Metasploit для использования вечного синего модуля для эксплуатации целевой машины.

## Эксплуатация 

```bash
use exploit/windows/smb/ms17_010_eternalblue
msf exploit(windows/smb/ms17_010_eternalblue) > set rhost 10.10.10
msf exploit(windows/smb/ms17_010_eternalblue) > run
```

Потрясающий!! У меня есть несанкционированный доступ к командной оболочке жертвы через сеанс 1 , как показано на рисунке ниже.

![[Pasted image 20230704103947.png]]

Внутри `c:\Users\haris\Desktop` я нашел user.txt и использовал команду type «filename» для чтения этого файла.

```
cd Desktop
cat user.txt
```

***Большой!!** Мы успешно получили наш 1 -й флаг

Внутри `c:\Users\Administrator\Desktop` я нашел root.txt и использовал команду type «filename» для чтения этого файла.

```
cd Desktop
cat root.txt
```

**Большой!!**  Мы успешно получили наш второй флаг.

Это была очень простая задача для тех кандидатов, которые практически не разбирались в анализе уязвимостей.

![[Pasted image 20230704104506.png]]

**Источник:** https://www.hackingarticles.in/

---


