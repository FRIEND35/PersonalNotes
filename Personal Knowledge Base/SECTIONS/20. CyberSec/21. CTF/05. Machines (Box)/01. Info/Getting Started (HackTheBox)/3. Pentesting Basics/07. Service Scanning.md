# Service Scanning


Мы готовы пойти дальше и начать исследовать машину! Первое, что нам нужно сделать, это определить операционную систему и все доступные службы, которые могут быть запущены. Служба — это приложение, работающее на компьютере и выполняющее некоторую полезную функцию для других пользователей или компьютеров. Мы называем эти специализированные машины, на которых размещены эти полезные сервисы, «серверами», а не рабочими станциями, что позволяет пользователям взаимодействовать и использовать эти различные сервисы. Нас интересуют сервисы, которые либо неправильно настроены, либо имеют уязвимости. Вместо выполнения действий, ожидаемых как часть службы, нам интересно посмотреть, сможем ли мы заставить службу выполнить какое-то непреднамеренное действие, которое поддерживает наши цели, например выполнение команды по нашему выбору.

Компьютерам присваивается IP-адрес, который позволяет им однозначно идентифицироваться и быть доступными в сети. Службам, работающим на этих компьютерах, может быть назначен номер порта, чтобы сделать службу доступной. Как обсуждалось ранее, номера портов варьируются от 1 до 65 535, при этом диапазон известных портов от 1 до 1 023 зарезервирован для привилегированных служб. Порт 0 является зарезервированным портом в сети TCP/IP и не используется в сообщениях TCP или UDP. Если что-либо попытается привязаться к порту 0 (например, служба), оно будет привязано к следующему доступному порту выше порта 1024, поскольку порт 0 рассматривается как порт с «подстановочным знаком».

Чтобы получить удаленный доступ к службе, нам необходимо подключиться, используя правильный IP-адрес и номер порта, и использовать язык, который понимает служба. Проверка всех 65 535 портов на наличие доступных сервисов вручную была бы трудоемкой, поэтому были созданы инструменты для автоматизации этого процесса и сканирования диапазона портов за нас. Одним из наиболее часто используемых инструментов сканирования является Nmap (Network Mapper).

---
## Nmap

Начнем с самого простого сканирования. Предположим, мы хотим выполнить базовое сканирование цели, расположенной по адресу 10.129.42.253. Для этого нам следует ввести `nmap 10.129.42.253`и нажмите «Возврат». Мы видим, что `Nmap`сканирование завершилось очень быстро. Это связано с тем, что если мы не укажем никаких дополнительных опций, Nmap по умолчанию будет сканировать только 1000 наиболее распространенных портов. Результаты сканирования показывают, что порты 21, 22, 80, 139 и 445 доступны.

Сервисное сканирование

```shell-session
Uliam@htb[/htb]$ nmap 10.129.42.253

Starting Nmap 7.80 ( https://nmap.org ) at 2021-02-25 16:07 EST
Nmap scan report for 10.129.42.253
Host is up (0.11s latency).
Not shown: 995 closed ports
PORT    STATE SERVICE
21/tcp  open  ftp
22/tcp  open  ssh
80/tcp  open  http
139/tcp open  netbios-ssn
445/tcp open  microsoft-ds

Nmap done: 1 IP address (1 host up) scanned in 2.19 seconds
```

Под `PORT`заголовок также сообщает нам, что это TCP-порты. По умолчанию, `Nmap` будет проводить сканирование TCP, если специально не будет предложено выполнить сканирование UDP.  
`STATE`заголовок подтверждает, что эти порты открыты. Иногда мы видим в списке другие порты, имеющие другое состояние, например `filtered`. Это может произойти, если брандмауэр разрешает доступ к портам только с определенных адресов.  
`SERVICE`заголовок сообщает нам, что имя службы обычно сопоставляется с конкретным номером порта. Однако сканирование по умолчанию не сообщит нам, что прослушивает этот порт. Пока мы не проинструктируем `Nmap` чтобы взаимодействовать со службой и попытаться получить идентифицирующую информацию, это может быть вообще другая служба.

По мере знакомства мы заметим, что несколько портов обычно связаны с Windows или Linux. Например, порт 3389 является портом по умолчанию для служб удаленных рабочих столов и является отличным показателем того, что целью является компьютер с Windows. В нашем текущем сценарии доступность порта 22 (SSH) указывает на то, что цель использует Linux/Unix, но эту службу также можно настроить в Windows. Давайте запустим более продвинутый `Nmap` сканировать и собирать дополнительную информацию о целевом устройстве.

Мы можем использовать `-sC` параметр, чтобы указать, что `Nmap`сценарии следует использовать, чтобы попытаться получить более подробную информацию. `-sV` параметр указывает `Nmap`для выполнения сканирования версий. В ходе этого сканирования Nmap определит отпечатки сервисов в целевой системе и определит протокол службы, имя и версию приложения. Сканирование версий опирается на обширную базу данных, содержащую более 1000 сигнатур служб. Окончательно, `-p-` сообщает Nmap, что мы хотим просканировать все 65 535 TCP-портов.

Сервисное сканирование

```shell-session
Uliam@htb[/htb]$ nmap -sV -sC -p- 10.129.42.253

Starting Nmap 7.80 ( https://nmap.org ) at 2021-02-25 16:18 EST
Nmap scan report for 10.129.42.253
Host is up (0.11s latency).
Not shown: 65530 closed ports
PORT    STATE SERVICE     VERSION
21/tcp  open  ftp         vsftpd 3.0.3
| ftp-anon: Anonymous FTP login allowed (FTP code 230)
|_drwxr-xr-x    2 ftp      ftp          4096 Feb 25 19:25 pub
| ftp-syst: 
|   STAT: 
| FTP server status:
|      Connected to ::ffff:10.10.14.2
|      Logged in as ftp
|      TYPE: ASCII
|      No session bandwidth limit
|      Session timeout in seconds is 300
|      Control connection is plain text
|      Data connections will be plain text
|      At session startup, client count was 2
|      vsFTPd 3.0.3 - secure, fast, stable
|_End of status
22/tcp  open  ssh         OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0)
80/tcp  open  http        Apache httpd 2.4.41 ((Ubuntu))
|_http-server-header: Apache/2.4.41 (Ubuntu)
|_http-title: PHP 7.4.3 - phpinfo()
139/tcp open  netbios-ssn Samba smbd 4.6.2
445/tcp open  netbios-ssn Samba smbd 4.6.2
Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel

Host script results:
|_nbstat: NetBIOS name: GS-SVCSCAN, NetBIOS user: <unknown>, NetBIOS MAC: <unknown> (unknown)
| smb2-security-mode: 
|   2.02: 
|_    Message signing enabled but not required
| smb2-time: 
|   date: 2021-02-25T21:21:51
|_  start_date: N/A

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 233.68 seconds
```

Это возвращает гораздо больше информации. Мы видим, что сканирование 65 535 портов заняло гораздо больше времени, чем 1000 портов. `-sC` и `-sV`Опции также увеличивают продолжительность сканирования, поскольку вместо простого TCP-квитирования они выполняют гораздо больше проверок. Мы замечаем, что на этот раз есть заголовок ВЕРСИЯ, в котором сообщается версия службы и операционная система, если ее можно определить.

На данный момент мы знаем, что операционная система — Ubuntu Linux. Версии приложений также могут помочь определить целевую версию ОС. Возьмем, к примеру, OpenSSH. Мы видим, что заявленная версия `OpenSSH 8.2p1 Ubuntu 4ubuntu0.1`. Изучив журналы [изменений](https://launchpad.net/ubuntu/yakkety/+source/openssh/+changelog) других пакетов Ubuntu SSH , мы видим, что версия выпуска имеет формат `1:7.3p1-1ubuntu0.1`. Обновив нашу версию под этот формат, мы получим `1:8.2p1-4ubuntu0.1`. Быстрый поиск этой версии в Интернете показывает, что она включена в Ubuntu Linux Focal Fossa 20.04.

![[Pasted image 20240804070410.png]]

Еще один быстрый поиск показывает, что дата выпуска этой ОС — 23 апреля 2020 года.

![[Pasted image 20240804070425.png]]

Однако стоит отметить, что такой метод перекрестных ссылок не совсем надежен, так как на более старую версию ОС можно установить более свежие пакеты приложений. Сканирование скрипта `-sC` пометить причины `Nmap` сообщить о заголовках сервера `http-server-header` страница и заголовок страницы `http-title`для любой веб-страницы, размещенной на веб-сервере. Название веб-страницы `PHP 7.4.3 - phpinfo()`указывает, что это файл PHPInfo, который часто создается вручную для подтверждения успешной установки PHP. В заголовке (и на странице PHPInfo) также указана версия PHP, на которую стоит обратить внимание, если она уязвима.

![[Pasted image 20240804070509.png]]

---
### Nmap Scripts

Указание `-sC`будет запускать множество полезных сценариев по умолчанию для цели, но бывают случаи, когда требуется запуск определенного сценария. Например, в рамках оценки нас могут попросить провести аудит крупной установки Citrix. Мы могли бы использовать [это](https://raw.githubusercontent.com/cyberstruggle/DeltaGroup/master/CVE-2019-19781/CVE-2019-19781.nse) `Nmap` сценарий для проверки серьезной уязвимости Citrix NetScaler ( [CVE-2019–19781](https://blog.rapid7.com/2020/01/17/active-exploitation-of-citrix-netscaler-cve-2019-19781-what-you-need-to-know/) ), в то время как `Nmap` также есть другие сценарии для аудита установки Citrix.

Сервисное сканирование

```shell-session
Uliam@htb[/htb]$ locate scripts/citrix

/usr/share/nmap/scripts/citrix-brute-xml.nse
/usr/share/nmap/scripts/citrix-enum-apps-xml.nse
/usr/share/nmap/scripts/citrix-enum-apps.nse
/usr/share/nmap/scripts/citrix-enum-servers-xml.nse
/usr/share/nmap/scripts/citrix-enum-servers.nse
```

Синтаксис запуска сценария Nmap: `nmap --script <script name> -p<port> <host>`.

`Nmap`сценарии — отличный способ улучшить функциональность нашего сканирования, и проверка доступных опций принесет дивиденды. Ознакомьтесь с [модулем «Перечисление сети с помощью Nmap»](https://academy.hackthebox.com/module/details/19) для более детального изучения `Nmap` инструмент.

---

## Attacking Network Services

#### Banner Grabbing

Как обсуждалось ранее, захват баннеров — это полезный метод быстрого определения сервисов. Часто служба пытается идентифицировать себя, отображая баннер после установления соединения. Nmap попытается захватить баннеры, если синтаксис `nmap -sV --script=banner <target>`указано. Мы также можем попытаться сделать это вручную, используя `Netcat`. Возьмем другой пример, используя `nc` версия `Netcat`:

Сервисное сканирование

```shell-session
Uliam@htb[/htb]$ nc -nv 10.129.42.253 21

(UNKNOWN) [10.129.42.253] 21 (ftp) open
220 (vsFTPd 3.0.3)
```

Это показывает, что версия `vsFTPd` на сервере есть `3.0.3`. Мы также можем автоматизировать этот процесс, используя `Nmap's` мощный скриптовый движок: `nmap -sV --script=banner -p21 10.10.10.0/24`.

---
#### FTP

Стоит познакомиться с FTP, так как это стандартный протокол, и этот сервис часто может содержать интересные данные. А `Nmap`сканирование порта по умолчанию для FTP (21) обнаруживает установку vsftpd 3.0.3, которую мы определили ранее. Кроме того, он также сообщает, что анонимная аутентификация включена и что `pub` каталог доступен.

Сервисное сканирование

```shell-session
Uliam@htb[/htb]$ nmap -sC -sV -p21 10.129.42.253

Starting Nmap 7.80 ( https://nmap.org ) at 2020-12-20 00:54 GMT
Nmap scan report for 10.129.42.253
Host is up (0.081s latency).

PORT   STATE SERVICE VERSION
21/tcp open  ftp     vsftpd 3.0.3
| ftp-anon: Anonymous FTP login allowed (FTP code 230)
|_drwxr-xr-x    2 ftp      ftp          4096 Dec 19 23:50 pub
| ftp-syst: 
|   STAT: 
| FTP server status:
|      Connected to ::ffff:10.10.14.2
|      Logged in as ftp
|      TYPE: ASCII
|      No session bandwidth limit
|      Session timeout in seconds is 300
|      Control connection is plain text
|      Data connections will be plain text
|      At session startup, client count was 3
|      vsFTPd 3.0.3 - secure, fast, stable
|_End of status
Service Info: OS: Unix

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 1.78 seconds
```

Подключимся к сервису с помощью `ftp` утилита командной строки.

Сервисное сканирование

```shell-session
Uliam@htb[/htb]$ ftp -p 10.129.42.253

Connected to 10.129.42.253.
220 (vsFTPd 3.0.3)
Name (10.129.42.253:user): anonymous
230 Login successful.
Remote system type is UNIX.
Using binary mode to transfer files.

ftp> ls
227 Entering Passive Mode (10,129,42,253,158,60).
150 Here comes the directory listing.
drwxr-xr-x    2 ftp      ftp          4096 Feb 25 19:25 pub
226 Directory send OK.

ftp> cd pub
250 Directory successfully changed.

ftp> ls
227 Entering Passive Mode (10,129,42,253,182,129).
150 Here comes the directory listing.
-rw-r--r--    1 ftp      ftp            18 Feb 25 19:25 login.txt
226 Directory send OK.

ftp> get login.txt
local: login.txt remote: login.txt
227 Entering Passive Mode (10,129,42,253,181,53).
150 Opening BINARY mode data connection for login.txt (18 bytes).
226 Transfer complete.
18 bytes received in 0.00 secs (165.8314 kB/s)

ftp> exit
221 Goodbye.
```

В приведенной выше оболочке мы видим, что FTP поддерживает общие команды, такие как `cd` и `ls` и позволяет нам загружать файлы с помощью `get`команда. Проверка загруженного `login.txt` раскрывает учетные данные, которые мы могли бы использовать для дальнейшего доступа к системе.

Сервисное сканирование

```shell-session
Uliam@htb[/htb]$ cat login.txt 

admin:ftp@dmin123
```

---
#### SMB

SMB (блок сообщений сервера) — это распространенный протокол на компьютерах под управлением Windows, который предоставляет множество векторов для вертикального и бокового перемещения. Конфиденциальные данные, включая учетные данные, могут находиться в общих сетевых папках, а некоторые версии SMB могут быть уязвимы для эксплойтов RCE, таких как [EternalBlue](https://www.avast.com/c-eternalblue) . Крайне важно тщательно оценить эту значительную потенциальную поверхность атаки. `Nmap` имеет множество сценариев для перечисления SMB, таких как [smb-os-discovery.nse](https://nmap.org/nsedoc/scripts/smb-os-discovery.html) , который будет взаимодействовать со службой SMB для извлечения сообщенной версии операционной системы.

Сервисное сканирование

```shell-session
Uliam@htb[/htb]$ nmap --script smb-os-discovery.nse -p445 10.10.10.40

Starting Nmap 7.91 ( https://nmap.org ) at 2020-12-27 00:59 GMT
Nmap scan report for doctors.htb (10.10.10.40)
Host is up (0.022s latency).

PORT    STATE SERVICE
445/tcp open  microsoft-ds

Host script results:
| smb-os-discovery: 
|   OS: Windows 7 Professional 7601 Service Pack 1 (Windows 7 Professional 6.1)
|   OS CPE: cpe:/o:microsoft:windows_7::sp1:professional
|   Computer name: CEO-PC
|   NetBIOS computer name: CEO-PC\x00
|   Workgroup: WORKGROUP\x00
|_  System time: 2020-12-27T00:59:46+00:00

Nmap done: 1 IP address (1 host up) scanned in 2.71 seconds
```

В этом случае на хосте установлена ​​устаревшая ОС Windows 7, и мы могли бы провести дальнейшее перечисление, чтобы подтвердить, уязвим ли он для EternalBlue. Metasploit Framework имеет несколько [модулей](https://www.rapid7.com/db/modules/exploit/windows/smb/ms17_010_eternalblue/) для EternalBlue, которые можно использовать для проверки уязвимости и ее эксплуатации, как мы увидим в следующем разделе. Мы можем запустить сканирование нашей цели для этого раздела модуля, чтобы собрать информацию из службы SMB. Мы можем убедиться, что на хосте установлено ядро ​​Linux Samba версии 4.6.2, а имя хоста — GS-SVCSCAN.

Сервисное сканирование

```shell-session
Uliam@htb[/htb]$ nmap -A -p445 10.129.42.253

Starting Nmap 7.80 ( https://nmap.org ) at 2021-02-25 16:29 EST
Nmap scan report for 10.129.42.253
Host is up (0.11s latency).

PORT    STATE SERVICE     VERSION
445/tcp open  netbios-ssn Samba smbd 4.6.2
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Aggressive OS guesses: Linux 2.6.32 (95%), Linux 3.1 (95%), Linux 3.2 (95%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (94%), ASUS RT-N56U WAP (Linux 3.4) (93%), Linux 3.16 (93%), Adtran 424RG FTTH gateway (92%), Linux 2.6.39 - 3.2 (92%), Linux 3.1 - 3.2 (92%), Linux 3.2 - 4.9 (92%)
No exact OS matches for host (test conditions non-ideal).
Network Distance: 2 hops

Host script results:
|_nbstat: NetBIOS name: GS-SVCSCAN, NetBIOS user: <unknown>, NetBIOS MAC: <unknown> (unknown)
| smb2-security-mode: 
|   2.02: 
|_    Message signing enabled but not required
| smb2-time: 
|   date: 2021-02-25T21:30:06
|_  start_date: N/A

TRACEROUTE (using port 445/tcp)
HOP RTT       ADDRESS
1   111.62 ms 10.10.14.1
2   111.89 ms 10.129.42.253

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 12.72 seconds
```

---
#### Shares

SMB позволяет пользователям и администраторам совместно использовать папки и предоставлять к ним удаленный доступ другим пользователям. Часто в этих общих папках содержатся файлы, содержащие конфиденциальную информацию, например пароли. Инструмент, который может перечислять общие ресурсы SMB и взаимодействовать с ними, — [smbclient](https://www.samba.org/samba/docs/current/man-html/smbclient.1.html) . `-L` Флаг указывает, что мы хотим получить список доступных общих ресурсов на удаленном хосте, а `-N` подавляет запрос пароля.

Сервисное сканирование

```shell-session
Uliam@htb[/htb]$ smbclient -N -L \\\\10.129.42.253

	Sharename       Type      Comment
	---------       ----      -------
	print$          Disk      Printer Drivers
	users           Disk      
	IPC$            IPC       IPC Service (gs-svcscan server (Samba, Ubuntu))
SMB1 disabled -- no workgroup available
```

Это показывает недефолтную долю `users`. Давайте попробуем подключиться в качестве гостя.

Сервисное сканирование

```shell-session
Uliam@htb[/htb]$ smbclient \\\\10.129.42.253\\users

Enter WORKGROUP\users's password: 
Try "help" to get a list of possible commands.

smb: \> ls
NT_STATUS_ACCESS_DENIED listing \*

smb: \> exit
```

 Команда `ls` привела к появлению сообщения об отказе в доступе, указывающего, что гостевой доступ запрещен. Давайте попробуем еще раз, используя учетные данные для пользователя bob ( `bob:Welcome1`).

Сервисное сканирование

```shell-session
Uliam@htb[/htb]$ smbclient -U bob \\\\10.129.42.253\\users

Enter WORKGROUP\bob's password: 
Try "help" to get a list of possible commands.

smb: \> ls
  .                                   D        0  Thu Feb 25 16:42:23 2021
  ..                                  D        0  Thu Feb 25 15:05:31 2021
  bob                                 D        0  Thu Feb 25 16:42:23 2021

		4062912 blocks of size 1024. 1332480 blocks available
		
smb: \> cd bob

smb: \bob\> ls
  .                                   D        0  Thu Feb 25 16:42:23 2021
  ..                                  D        0  Thu Feb 25 16:42:23 2021
  passwords.txt                       N      156  Thu Feb 25 16:42:23 2021

		4062912 blocks of size 1024. 1332480 blocks available
		
smb: \bob\> get passwords.txt 
getting file \bob\passwords.txt of size 156 as passwords.txt (0.3 KiloBytes/sec) (average 0.3 KiloBytes/sec)
```

Мы успешно получили доступ к `users` поделиться, используя учетные данные, и получил доступ к интересующему файлу `passwords.txt`, который можно скачать с помощью `get` команда.

---
#### SNMP

Строки сообщества SNMP предоставляют информацию и статистику о маршрутизаторе или устройстве, помогая нам получить к ним доступ. Строки сообщества по умолчанию производителя `public` и `private`часто остаются неизменными. В версиях SNMP 1 и 2c доступ контролируется с помощью строки сообщества в виде открытого текста, и если мы знаем имя, мы можем получить к нему доступ. Шифрование и аутентификация были добавлены только в SNMP версии 3. Много информации можно получить из SNMP. Проверка параметров процесса может выявить учетные данные, передаваемые в командной строке, которые можно будет повторно использовать для других служб, доступных извне, учитывая распространенность повторного использования паролей в корпоративных средах. Также может быть раскрыта информация о маршрутизации, сервисах, привязанных к дополнительным интерфейсам, и версия установленного программного обеспечения.

Сервисное сканирование

```shell-session
Uliam@htb[/htb]$ snmpwalk -v 2c -c public 10.129.42.253 1.3.6.1.2.1.1.5.0

iso.3.6.1.2.1.1.5.0 = STRING: "gs-svcscan"
```

Сервисное сканирование

```shell-session
Uliam@htb[/htb]$ snmpwalk -v 2c -c private  10.129.42.253 

Timeout: No Response from 10.129.42.253
```

Такой инструмент, как [onesixtyone,](https://github.com/trailofbits/onesixtyone) можно использовать для подбора имен строк сообщества с использованием файла словаря общих строк сообщества, такого как `dict.txt` файл, включенный в репозиторий GitHub для этого инструмента.

Сервисное сканирование

```shell-session
Uliam@htb[/htb]$ onesixtyone -c dict.txt 10.129.42.254

Scanning 1 hosts, 51 communities
10.129.42.254 [public] Linux gs-svcscan 5.4.0-66-generic #74-Ubuntu SMP Wed Jan 27 22:54:38 UTC 2021 x86_64
```

---
# Conclusion

Сканирование и перечисление сервисов — это обширная тема, о которой мы узнаем больше по мере продвижения. Аспекты, которые мы здесь рассмотрели, применимы ко многим сетям, включая машины HTB.

---

# Questions

1. Выполнить сканирование цели Nmap. Что Nmap отображает как версию службы, работающей на порту 8080?
2. Выполните сканирование цели с помощью Nmap и определите порт, отличный от порта по умолчанию, на котором работает служба telnet.
3. Перечислите общие ресурсы SMB, доступные на целевом хосте. Подключитесь к доступному общему ресурсу как пользователь bob. После подключения получите доступ к папке под названием «flag» и отправьте содержимое файла flag.txt.

Делаем сканирование:

```
nmap -sC -sV 10.129.188.116  
Starting Nmap 7.94 ( https://nmap.org ) at 2024-08-04 07:10 MSK  
Nmap scan report for 10.129.188.116  
Host is up (0.20s latency).  
Not shown: 957 closed tcp ports (conn-refused), 36 filtered tcp ports (no-response)  
PORT     STATE SERVICE     VERSION  
21/tcp   open  ftp         vsftpd 3.0.3  
| ftp-anon: Anonymous FTP login allowed (FTP code 230)  
|_drwxr-xr-x    2 ftp      ftp          4096 Feb 25  2021 pub  
| ftp-syst:    
|   STAT:    
| FTP server status:  
|      Connected to ::ffff:10.10.14.12  
|      Logged in as ftp  
|      TYPE: ASCII  
|      No session bandwidth limit  
|      Session timeout in seconds is 300  
|      Control connection is plain text  
|      Data connections will be plain text  
|      At session startup, client count was 2  
|      vsFTPd 3.0.3 - secure, fast, stable  
|_End of status  
22/tcp   open  ssh         OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0)  
| ssh-hostkey:    
|   3072 a0:01:d7:79:e9:d2:09:2a:b8:d9:b4:9a:6c:00:0c:1c (RSA)  
|   256 2b:99:b2:1f:ec:1a:5a:c6:b7:be:b5:50:d1:0e:a9:df (ECDSA)  
|_  256 e4:f8:17:8d:d4:71:d1:4e:d4:0e:bd:f0:29:4f:6d:14 (ED25519)  
80/tcp   open  http        Apache httpd 2.4.41 ((Ubuntu))  
|_http-server-header: Apache/2.4.41 (Ubuntu)  
|_http-title: PHP 7.4.3 - phpinfo()  
139/tcp  open  netbios-ssn Samba smbd 4.6.2  
445/tcp  open  netbios-ssn Samba smbd 4.6.2  
2323/tcp open  telnet      Linux telnetd  
8080/tcp open  http        Apache Tomcat  
|_http-title: Apache Tomcat  
Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel  
  
Host script results:  
|_clock-skew: -4s  
| smb2-time:    
|   date: 2024-08-04T04:11:18  
|_  start_date: N/A  
| smb2-security-mode:    
|   3:1:1:    
|_    Message signing enabled but not required  
|_nbstat: NetBIOS name: GS-SVCSCAN, NetBIOS user: <unknown>, NetBIOS MAC: <unknown> (unknown)  
  
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .  
Nmap done: 1 IP address (1 host up) scanned in 63.24 seconds
```

Перечислите общие ресурсы SMB на целевом хосте. Подключитесь, чтобы поделиться как пользователь bob. После подключения получите доступ к папке под названием «flag» и отправьте содержимое файла flag.txt. Хорошо, я признаю, что это вызвало у меня проблемы, и я до сих пор не совсем понимаю, почему, но поехали…

Мы не можем войти в систему как гость, чтобы просмотреть общие ресурсы на целевом хосте, поэтому нам нужно подключиться как bob::

```
smbclient -L \\\\10.129.188.116\\users -U bob -p 445  
Can't load /etc/samba/smb.conf - run testparm to debug it  
Password for [WORKGROUP\bob]:  
  
       Sharename       Type      Comment  
       ---------       ----      -------  
       print$          Disk      Printer Drivers  
       users           Disk         
       IPC$            IPC       IPC Service (gs-svcscan server (Samba, Ubuntu))  
SMB1 disabled -- no workgroup available
```

Теперь мы официально знаем (хотя уже знали), что существует каталог пользователей. Бобби Бой не использует безопасные пароли. Если вы прочитаете сам урок, он буквально скажет вам, что его пароль — Welcome1.

```
smbclient  \\\\10.129.188.116\\users -U bob -p 445    
Can't load /etc/samba/smb.conf - run testparm to debug it  
Password for [WORKGROUP\bob]:  
Try "help" to get a list of possible commands.  
smb: \> ls  
 .                                   D        0  Fri Feb 26 02:06:52 2021  
 ..                                  D        0  Thu Feb 25 23:05:31 2021  
 flag                                D        0  Fri Feb 26 02:09:26 2021  
 bob                                 D        0  Fri Feb 26 00:42:23 2021  

               4062912 blocks of size 1024. 1350320 blocks available  
```

Теперь мы находимся под именем bob, и есть папка с флагом и bob. Очевидно, нам нужен флаг, но давайте немного взглянем на bob с помощью простого `cd bob`, который дает нам файл passwords.txt,  выполняем команду `get passwords.txt`, и мы вскоре вернемся к вам, Боб.

```
smb: \> cd flag  
smb: \flag\> ls  
 .                                   D        0  Fri Feb 26 02:09:26 2021  
 ..                                  D        0  Fri Feb 26 02:06:52 2021  
 flag.txt                            N       33  Fri Feb 26 02:09:26 2021  
  
               4062912 blocks of size 1024. 1350316 blocks available  
smb: \flag\> get flag.txt  
getting file \flag\flag.txt of size 33 as flag.txt (0.0 KiloBytes/sec) (average 0.0 KiloBytes/sec)
```

Набрав quit, вы закроете это. Затем вы можете вернуться к своей основной оболочке и «ls»: Итак, файла паролей, который я использовал, больше нет (хорошо сыграно HTB), но это не главное… Я попытался немного разобраться.

Теперь, когда flag.txt находится в нашем каталоге, мы его «получили» (ха-ха) и можем посмотреть содержимое файла командой «cat flag.txt»:

```
cat flag.txt    
dceece590f3284c3866305eb2473d099
```

1. **Apache Tomcat**
2. **2323**
3. **dceece590f3284c3866305eb2473d099**

Та да! Наш флаг. Хорошо, некоторые мысли по этому поводу... сначала я столкнулся с ошибкой, когда вас просто просили добавить дополнительный '\\', и это сработало, но потом мне это не понадобилось... не уверен насчет этого, но вот мы здесь. Это было здорово и приятный первый взгляд на smbclient, который, как я вижу, уже ОЧЕНЬ часто используется (поправьте меня, если я ошибаюсь).

---