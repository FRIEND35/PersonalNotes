
Разделение диапазона адресов IPv4 на несколько меньших диапазонов адресов называется `subnetting`.

Подсеть — это логический сегмент сети, в котором используются IP-адреса с одинаковым сетевым адресом. Мы можем думать о подсети как о помеченном входе в большой коридор здания. Например, это может быть стеклянная дверь, разделяющая различные отделы здания компании. С помощью подсети мы можем сами создать конкретную подсеть или узнать следующую схему соответствующей сети:

- `Network address`
- `Broadcast address`
- `First host`
- `Last host`
- `Number of hosts`

В качестве примера возьмем следующий IPv4-адрес и маску подсети:

- IPv4-адрес: `192.168.12.160`
- Маска подсети: `255.255.255.192`
- CIDR: `192.168.12.160/26`

---

Мы уже знаем, что IP-адрес делится на `network part` и `host part`.

#### Network Part

| **Подробности** | **1-й октет** | **2-й октет** | **3-й октет** | **4-й октет** | **десятичный**       |
| --------------- | ------------- | ------------- | ------------- | ------------- | -------------------- |
| IPv4            | `1100 0000`   | `1010 1000`   | `0000 1100`   | `10`10 0000   | 192.168.12.160 `/26` |
| Маска подсети   | `1111 1111`   | `1111 1111`   | `1111 1111`   | `11`00 0000   | `255.255.255.192`    |
| Биты            | /8            | /16           | /24           | /32           |                      |

При создании подсетей мы используем маску подсети в качестве шаблона для адреса IPv4. Из `1`-биты в маске подсети, мы знаем какие биты в IPv4-адресе `cannot` быть изменено. Это `fixed` и, следовательно, определить «основную сеть», в которой находится подсеть.

#### Host Part

|**Подробности**|**1-й октет**|**2-й октет**|**3-й октет**|**4-й октет**|**десятичный**|
|---|---|---|---|---|---|
|IPv4|1100 0000|1010 1000|0000 1100|10 `10 0000`|192.168.12.160/26|
|Маска подсети|1111 1111|1111 1111|1111 1111|11 `00 0000`|255.255.255.192|
|Биты|/8|/16|/24|/32||

Биты в `host part` можно изменить на `first` и `last` адрес. Первый адрес - это `network address`, а последний адрес — это `broadcast address` для соответствующей подсети.

The `network address` жизненно важен для доставки пакета данных. Если `network address` одинаков для адреса источника и назначения, пакет данных доставляется в одной и той же подсети. Если сетевые адреса различаются, пакет данных необходимо направить в другую подсеть через `default gateway`.

The `subnet mask` определяет, где происходит это разделение.

#### Separation Of Network & Host Parts

|**Подробности**|**1-й октет**|**2-й октет**|**3-й октет**|**4-й октет**|**десятичный**|
|---|---|---|---|---|---|
|IPv4|1100 0000|1010 1000|0000 1100|10 `\|`10 0000|192.168.12.160/26|
|Маска подсети|`1111 1111`|`1111 1111`|`1111 1111`|`11\|`00 0000|255.255.255.192|
|Биты|/8|/16|/24|/32||

---

#### Network Address

Итак, если мы теперь установим все биты в `0` в `host part` адреса IPv4, мы получаем соответствующую подсеть `network address`.

|**Подробности**|**1-й октет**|**2-й октет**|**3-й октет**|**4-й октет**|**десятичный**|
|---|---|---|---|---|---|
|IPv4|1100 0000|1010 1000|0000 1100|10 `\|00 0000`|`192.168.12.128`/26|
|Маска подсети|`1111 1111`|`1111 1111`|`1111 1111`|`11\|`00 0000|255.255.255.192|
|Биты|/8|/16|/24|/32||

---

#### Broadcast Address

Если мы установим все биты в `host part` IPv4-адреса на `1`, мы получаем `broadcast address`.

|**Подробности**|**1-й октет**|**2-й октет**|**3-й октет**|**4-й октет**|**десятичный**|
|---|---|---|---|---|---|
|IPv4|1100 0000|1010 1000|0000 1100|10 `\|11 1111`|`192.168.12.191`/26|
|Маска подсети|`1111 1111`|`1111 1111`|`1111 1111`|`11\|`00 0000|255.255.255.192|
|Биты|/8|/16|/24|/32||

Поскольку теперь мы знаем, что адреса IPv4 `192.168.12.128` и `192.168.12.191` назначены, все остальные IPv4-адреса соответственно находятся между `192.168.12.129-190`. Теперь мы знаем, что эта подсеть предлагает нам в общей сложности `64 - 2` (сетевой адрес и широковещательный адрес) или `62` Адреса IPv4, которые мы можем назначить нашим хостам.

|**Хозяева**|**IPv4**|
|---|---|
|Сетевой адрес|`192.168.12.128`|
|Первый хост|`192.168.12.129`|
|Другие хосты|`...`|
|Последний хост|`192.168.12.190`|
|Широковещательный адрес|`192.168.12.191`|

---

## Subnetting Into Smaller Networks

Предположим теперь, что нам как администраторам поставлена ​​задача разделить закрепленную за нами подсеть на 4 дополнительные подсети. Таким образом, важно знать, что мы можем разделить подсети только на основе двоичной системы.

|**Экспонента**|**Ценить**|
|---|---|
|2 `^0`|= 1|
|2 `^1`|= 2|
|2 `^2`|= 4|
|2 `^3`|= 8|
|2 `^4`|= 16|
|2 `^5`|= 32|
|2 `^6`|= 64|
|2 `^7`|= 128|
|2 `^8`|= 256|

---

Поэтому мы можем разделить `64 hosts` мы знаем по `4`. `4` равен показателю 2 `^2` в двоичной системе, таким образом мы узнаем количество бит маски подсети, на которую нам предстоит ее расширить. Итак, нам известны следующие параметры:

- Подсеть: `192.168.12.128/26`
- Необходимые подсети: `4`

Теперь мы увеличиваем/расширяем маску подсети на `2 bits` от `/26` к `/28`, и это выглядит так:

|**Подробности**|**1-й октет**|**2-й октет**|**3-й октет**|**4-й октет**|**десятичный**|
|---|---|---|---|---|---|
|IPv4|1100 0000|1010 1000|0000 1100|1000 `\|` 0000|192.168.12.128 `/28`|
|Маска подсети|`1111 1111`|`1111 1111`|`1111 1111`|`1111\|` 0000|`255.255.255.240`|
|Биты|/8|/16|/24|/32||

Далее мы можем разделить `64` IPv4-адреса, которые доступны нам в `4 parts`:

|**Хозяева**|**Математика**|**Подсети**|**Диапазон хостов для каждой подсети**|
|---|---|---|---|
|64|/|4|= `16`|

Итак, мы знаем, насколько большой будет каждая подсеть. С этого момента мы начинаем с данного нам сетевого адреса (192.168.12.128) и добавляем `16` хозяева `4` раз:

| **Номер подсети.** | **Сетевой адрес** | **Первый хост** | **Последний хост** | **Широковещательный адрес** | **ЦИДР**          |
| ------------------ | ----------------- | --------------- | ------------------ | --------------------------- | ----------------- |
| 1                  | `192.168.12.128`  | 192.168.12.129  | 192.168.12.142     | `192.168.12.143`            | 192.168.12.128/28 |
| 2                  | `192.168.12.144`  | 192.168.12.145  | 192.168.12.158     | `192.168.12.159`            | 192.168.12.144/28 |
| 3                  | `192.168.12.160`  | 192.168.12.161  | 192.168.12.174     | `192.168.12.175`            | 192.168.12.160/28 |
| 4                  | `192.168.12.176`  | 192.168.12.177  | 192.168.12.190     | `192.168.12.191`            | 192.168.12.176/28 |

---

## Mental Subnetting

Может показаться, что при разбиении на подсети требуется много математических вычислений, но каждый октет повторяется, и все представляет собой степень двойки, поэтому не нужно много запоминать. Первое, что нужно сделать, это определить, какой октет изменяется.

|**1-й октет**|**2-й октет**|**3-й октет**|**4-й октет**|
|---|---|---|---|
|/8|/16|/24|/32|

Запомнив эти четыре цифры, можно определить, какой октет IP-адреса может измениться. Учитывая сетевой адрес: `192.168.1.1/25`, сразу становится ясно, что 192.168.2.4 не будет находиться в той же сети, потому что `/25` подсеть означает, что может измениться только четвертый октет.

В следующей части определяется, насколько большой может быть каждая подсеть, если разделить восемь на сеть и посмотреть `remainder`. Это также называется `Modulo Operation (%)` и широко используется в криптологии. Учитывая наш предыдущий пример `/25`, `(25 % 8)` будет 1. Это потому, что восемь входит в число 25 трижды (8 * 3 = 24). Остаток равен 1, то есть сетевой бит, зарезервированный для сетевой маски. Всего в каждом октете IP-адреса содержится восемь бит. Если для маски сети используется один, уравнение принимает вид 2^(8-1) или 2^7, 128. В таблице ниже содержатся все числа.

|**Остаток**|**Число**|**Экспоненциальная форма**|**Форма дивизиона**|
|---|---|---|---|
|0|256|2^8|256|
|1|128|2^7|256/2|
|2|64|2^6|256/2/2|
|3|32|2^5|256/2/2/2|
|4|16|2^4|256/2/2/2/2|
|5|8|2^3|256/2/2/2/2/2|
|6|4|2^2|256/2/2/2/2/2/2|
|7|2|2^1|256/2/2/2/2/2/2/2|

Запомнив степени от двойки до восьми, можно мгновенно выполнить расчет. Однако, если вы забудете, возможно, быстрее будет вспомнить, как разделить 256 на половину количества раз остатка.

Сложная часть этого — получить фактический диапазон IP-адресов, поскольку 0 — это число, а не ноль в сети. Так что в нашем `/25` со 128 IP-адресами, первый диапазон `192.168.1.0-127`. Первый адрес — это сеть, а последний — широковещательный адрес, что означает, что используемое IP-пространство станет `192.168.1.1-126`. Если наш IP-адрес упал выше 128, то `usable ip space` будет 192.168.1.129-254 (128 — сеть, 255 — широковещательная передача).

---

# Questions


1. Отправьте десятичное представление маски подсети из следующего CIDR: 10.200.20.0/27.
2. Отправьте широковещательный адрес следующего CIDR: 10.200.20.0/27.
3. Разделить сеть 10.200.20.0/27 на 4 подсети и в качестве ответа отправить сетевой адрес 3-й подсети.
4. Разделить сеть 10.200.20.0/27 на 4 подсети и в качестве ответа отправить широковещательный адрес 2-й подсети.


1. Чтобы получить десятичное представление маски подсети из CIDR-нотации 10.200.20.0/27, нужно преобразовать число 27 в двоичное представление.

Маска подсети с префиксом /27 означает, что первые 27 бит адреса используются для сети, а оставшиеся 5 бит — для хостов. В двоичном виде маска будет выглядеть следующим образом:

```
11111111.11111111.11111111.11100000
```


Теперь нужно заполнить нулями оставшиеся 5 бит. Поскольку каждая группа из 8 бит (октет) в десятичной системе соответствует значениям:

```
- 11111111 = 255
- 11111110 = 254
- 11111101 = 253
- 11111100 = 252
- 11111000 = 248
- 11110000 = 240
- 11100000 = 224
- 11000000 = 192
- 10000000 = 128
- 00000000 = 0
```

Таким образом, построим маску подсети в десятичном виде:

- Первый октет: 11111111 = 255
- Второй октет: 11111111 = 255
- Третий октет: 11111111 = 255
- Четвертый октет: 11100000 = 224

Следовательно, маска подсети в десятичном виде будет:

```
255.255.255.224
```

2. Для подсети 10.200.20.0/27 широкой адрес определяется следующим образом:

    1. Определим число адресов в подсети:
        - Маска /27 означает, что первые 27 бит используются для сетевой части.
        - Это оставляет 5 бит для узлов (32 - 27 = 5).
         - Число возможных адресов: 2^5 = 32 адреса.

    2. Выделим сетевой адрес и адреса узлов:
         - Сетевой адрес: 10.200.20.0
         - Адреса узлов: от 10.200.20.1 до 10.200.20.30.

    3. Широковещательный адрес:
        - Он будет последним адресом в этой подсети.
        - Для данного CIDR широковещательный адрес: 10.200.20.31.

Таким образом, широковещательный адрес для 10.200.20.0/27: 10.200.20.31.


3. Для разделения сети 10.200.20.0/27 на 4 подсети:

    1. Исходная маска подсети: /27
    2. Количество подсетей: 4
    3. Для получения 4 подсетей необходимо увеличить маску на 2 бита (2^2 = 4).
        - Новая маска будет: /29.

    4. Определим количество адресов в каждой новой подсети:
        - Маска /29 оставляет 3 бита для узлов (32 - 29 = 3).
        - Число адресов в каждой подсети: 2^3 = 8 адресов. 

    5. Подсети:
        - 1-я подсеть: 10.200.20.0/29
        - 2-я подсеть: 10.200.20.8/29
        - 3-я подсеть: 10.200.20.16/29
        - 4-я подсеть: 10.200.20.24/29

Следовательно, сетевой адрес 3-й подсети: 10.200.20.16.


4. Для разделения сети 10.200.20.0/27 на 4 подсети:

    1. Исходная маска подсети: /27
    2. Количество подсетей: 4
    3. Для получения 4 подсетей необходимо увеличить маску на 2 бита (2^2 = 4).
        - Новая маска будет: /29.

    4. Определим количество адресов в каждой новой подсети:
        - Маска /29 оставляет 3 бита для узлов (32 - 29 = 3).
        - Число адресов в каждой подсети: 2^3 = 8 адресов. 

    5. Подсети:
        - 1-я подсеть: 10.200.20.0/29 (широковещательный адрес: 10.200.20.7)
        - 2-я подсеть: 10.200.20.8/29 (широковещательный адрес: 10.200.20.15)
        - 3-я подсеть: 10.200.20.16/29 (широковещательный адрес: 10.200.20.23)
        - 4-я подсеть: 10.200.20.24/29 (широковещательный адрес: 10.200.20.31)

Следовательно, широковещательный адрес 2-й подсети: 10.200.20.15.