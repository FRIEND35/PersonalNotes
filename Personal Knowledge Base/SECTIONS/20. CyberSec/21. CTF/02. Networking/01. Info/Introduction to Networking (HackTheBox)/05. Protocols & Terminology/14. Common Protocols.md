# Common Protocols

---

Интернет-протоколы — это стандартизированные правила и рекомендации, определенные в RFC, которые определяют, как устройства в сети должны взаимодействовать друг с другом. Они гарантируют, что устройства в сети смогут последовательно и надежно обмениваться информацией независимо от используемого оборудования и программного обеспечения. Чтобы устройства могли обмениваться данными в сети, они должны быть подключены через канал связи, например проводное или беспроводное соединение. Затем устройства обмениваются информацией, используя набор стандартизированных протоколов, которые определяют формат и структуру передаваемых данных. Двумя основными типами соединений, используемых в сетях, являются [протокол управления передачей](https://en.wikipedia.org/wiki/Transmission_Control_Protocol) ( `TCP`) и [протокол пользовательских датаграмм](https://en.wikipedia.org/wiki/User_Datagram_Protocol) ( `UDP`).

Нам необходимо иметь дело с различными и наиболее используемыми протоколами и знать их. Как мы уже узнали, эти протоколы являются основой всего общения между нашими устройствами и компьютерами в сетях. Ниже мы собрали многие из этих протоколов, с которыми мы будем иметь дело в модулях. Чем лучше мы их понимаем, тем эффективнее мы сможем с ними работать.

---

## Transmission Control Protocol

`TCP` это `connection-oriented` протокол, который устанавливает виртуальное соединение между двумя устройствами перед передачей данных с помощью [трехстороннего рукопожатия](https://en.wikipedia.org/wiki/Transmission_Control_Protocol#Connection_establishment) . Это соединение поддерживается до тех пор, пока передача данных не завершится, и устройства могут продолжать отправлять данные туда и обратно, пока соединение активно.

Например, когда мы вводим URL-адрес в наш веб-браузер, браузер отправляет HTTP-запрос на сервер, на котором размещен веб-сайт, используя `TCP`. Сервер отвечает, отправляя HTML-код веб-сайта обратно в браузер, используя `TCP`. Затем браузер использует этот код для отображения веб-сайта на нашем экране. Этот процесс опирается на `TCP` соединение устанавливается между браузером и веб-сервером и поддерживается до завершения передачи данных. Как результат, `TCP` надежен, но медленнее, чем UDP, поскольку требует дополнительных затрат для установления и поддержания соединения.

|**Protocol**|**Acronym**|**Port**|**Description**|
|---|---|---|---|
|Телнет|`Telnet`|`23`|Служба удаленного входа в систему|
|Безопасная оболочка|`SSH`|`22`|Безопасный сервис удаленного входа в систему|
|Простой протокол управления сетью|`SNMP`|`161-162`|Управление сетевыми устройствами|
|Протокол передачи гипертекста|`HTTP`|`80`|Используется для переноса веб-страниц|
|Безопасный протокол передачи гипертекста|`HTTPS`|`443`|Используется для передачи защищенных веб-страниц.|
|Система доменных имен|`DNS`|`53`|Поиск доменных имен|
|Протокол передачи файлов|`FTP`|`20-21`|Используется для передачи файлов|
|Тривиальный протокол передачи файлов|`TFTP`|`69`|Используется для передачи файлов|
|Протокол сетевого времени|`NTP`|`123`|Синхронизировать компьютерные часы|
|Простой протокол передачи почты|`SMTP`|`25`|Используется для передачи электронной почты|
|Протокол почтового отделения|`POP3`|`110`|Используется для получения электронной почты|
|Протокол доступа к сообщениям Интернета|`IMAP`|`143`|Используется для доступа к электронной почте|
|Блок сообщений сервера|`SMB`|`445`|Используется для передачи файлов|
|Сетевая файловая система|`NFS`|`111`, `2049`|Используется для монтирования удаленных систем|
|Протокол начальной загрузки|`BOOTP`|`67`, `68`|Используется для загрузки компьютеров|
|Керберос|`Kerberos`|`88`|Используется для аутентификации и авторизации|
|Облегченный протокол доступа к каталогу|`LDAP`|`389`|Используется для служб каталогов|
|Служба удаленной аутентификации пользователей с телефонным подключением|`RADIUS`|`1812`, `1813`|Используется для аутентификации и авторизации|
|Протокол динамической конфигурации хоста|`DHCP`|`67`, `68`|Используется для настройки IP-адресов|
|Протокол удаленного рабочего стола|`RDP`|`3389`|Используется для удаленного доступа к рабочему столу.|
|Протокол передачи сетевых новостей|`NNTP`|`119`|Используется для доступа к группам новостей|
|Удаленный вызов процедур|`RPC`|`135`, `137-139`|Используется для вызова удаленных процедур|
|Протокол идентификации|`Ident`|`113`|Используется для идентификации пользовательских процессов|
|Протокол управляющих сообщений Интернета|`ICMP`|`0-255`|Используется для устранения проблем с сетью.|
|Протокол управления интернет-группами|`IGMP`|`0-255`|Используется для многоадресной рассылки|
|Прослушиватель Oracle DB (по умолчанию/альтернативный)|`oracle-tns`|`1521`/ `1526`|Стандартный/альтернативный прослушиватель базы данных Oracle — это служба, которая работает на хосте базы данных и получает запросы от клиентов Oracle.|
|Замок Энгра|`ingreslock`|`1524`|База данных Ingres обычно используется для крупных коммерческих приложений и в качестве бэкдора, позволяющего удаленно выполнять команды через RPC.|
|Веб-прокси Squid|`http-proxy`|`3128`|Веб-прокси Squid — это веб-прокси HTTP с кэшированием и пересылкой, используемый для ускорения веб-сервера за счет кэширования повторяющихся запросов.|
|Протокол безопасного копирования|`SCP`|`22`|Безопасное копирование файлов между системами|
|Протокол инициации сеанса|`SIP`|`5060`|Используется для сеансов VoIP|
|Простой протокол доступа к объектам|`SOAP`|`80`, `443`|Используется для веб-сервисов|
|Уровень защищенных сокетов|`SSL`|`443`|Безопасная передача файлов|
|TCP-обертки|`TCPW`|`113`|Используется для контроля доступа|
|Ассоциация интернет-безопасности и протокол управления ключами|`ISAKMP`|`500`|Используется для VPN-подключений|
|Microsoft SQL-сервер|`ms-sql-s`|`1433`|Используется для клиентских подключений к Microsoft SQL Server.|
|Керберизованное интернет-согласование ключей|`KINK`|`892`|Используется для аутентификации и авторизации|
|Сначала откройте кратчайший путь|`OSPF`|`89`|Используется для маршрутизации|
|Протокол туннелирования «точка-точка»|`PPTP`|`1723`|Используется для создания VPN|
|Удаленное выполнение|`REXEC`|`512`|Этот протокол используется для выполнения команд на удаленных компьютерах и отправки вывода команд обратно на локальный компьютер.|
|Удаленный вход|`RLOGIN`|`513`|Этот протокол запускает интерактивный сеанс оболочки на удаленном компьютере.|
|X оконная система|`X11`|`6000`|Это система компьютерного программного обеспечения и сетевой протокол, обеспечивающий графический интерфейс пользователя (GUI) для сетевых компьютеров.|
|Система управления реляционными базами данных|`DB2`|`50000`|СУБД предназначена для хранения, извлечения и управления данными в структурированном формате для корпоративных приложений, таких как финансовые системы, системы управления взаимоотношениями с клиентами (CRM).|

---

## User Datagram Protocol

С другой стороны, `UDP` это `connectionless` протокол, что означает, что он не устанавливает виртуальное соединение перед передачей данных. Вместо этого он отправляет пакеты данных по назначению, не проверяя, были ли они получены.

Например, когда мы транслируем или смотрим видео на такой платформе, как YouTube, видеоданные передаются на наше устройство с помощью `UDP`. Это связано с тем, что видео может допускать некоторую потерю данных, а скорость передачи важнее надежности. Если несколько пакетов видеоданных будут потеряны по пути, это не окажет существенного влияния на общее качество видео. Это делает `UDP` быстрее, чем TCP, но менее надежен, поскольку нет гарантии, что пакеты достигнут пункта назначения.

|**Протокол**|**Акроним**|**Порт**|**Описание**|
|---|---|---|---|
|Система доменных имен|`DNS`|`53`|Это протокол преобразования доменных имен в IP-адреса.|
|Тривиальный протокол передачи файлов|`TFTP`|`69`|Он используется для передачи файлов между системами.|
|Протокол сетевого времени|`NTP`|`123`|Он синхронизирует компьютерные часы в сети.|
|Простой протокол управления сетью|`SNMP`|`161`|Он контролирует и управляет сетевыми устройствами удаленно.|
|Протокол информации о маршрутизации|`RIP`|`520`|Он используется для обмена информацией о маршрутизации между маршрутизаторами.|
|Интернет-обмен ключами|`IKE`|`500`|Интернет-обмен ключами|
|Протокол начальной загрузки|`BOOTP`|`68`|Он используется для загрузки хостов в сети.|
|Протокол динамической конфигурации хоста|`DHCP`|`67`|Он используется для динамического назначения IP-адресов устройствам в сети.|
|Телнет|`TELNET`|`23`|Это текстовый протокол связи удаленного доступа.|
|MySQL|`MySQL`|`3306`|Это система управления базами данных с открытым исходным кодом.|
|Терминальный сервер|`TS`|`3389`|Это протокол удаленного доступа, используемый по умолчанию службами терминалов Microsoft Windows.|
|NetBIOS-имя|`netbios-ns`|`137`|Он используется в операционных системах Windows для преобразования имен NetBIOS в IP-адреса в локальной сети.|
|Microsoft SQL-сервер|`ms-sql-m`|`1434`|Используется для службы браузера Microsoft SQL Server.|
|Универсальная подключи и работай|`UPnP`|`1900`|Это протокол, позволяющий устройствам обнаруживать друг друга в сети и обмениваться данными.|
|PostgreSQL|`PGSQL`|`5432`|Это объектно-реляционная система управления базами данных.|
|Виртуальные сетевые вычисления|`VNC`|`5900`|Это графическая система совместного использования рабочего стола.|
|X оконная система|`X11`|`6000-6063`|Это система компьютерного программного обеспечения и сетевой протокол, обеспечивающий графический интерфейс пользователя в Unix-подобных системах.|
|Системный журнал|`SYSLOG`|`514`|Это стандартный протокол для сбора и хранения сообщений журнала в компьютерной системе.|
|Интернет-релейный чат|`IRC`|`194`|Это протокол обмена текстовыми сообщениями (чат) в Интернете в режиме реального времени или протокол синхронной связи.|
|OpenPGP|`OpenPGP`|`11371`|Это протокол для шифрования и подписи данных и сообщений.|
|Безопасность интернет-протокола|`IPsec`|`500`|IPsec также является протоколом, обеспечивающим безопасную зашифрованную связь. Он обычно используется в VPN для создания безопасного туннеля между двумя устройствами.|
|Интернет-обмен ключами|`IKE`|`11371`|Это протокол для шифрования и подписи данных и сообщений.|
|Протокол управления X Display Manager|`XDMCP`|`177`|XDMCP — это сетевой протокол, который позволяет пользователю удаленно входить в систему на компьютере, на котором работает X11.|

---

## ICMP

[Протокол управляющих сообщений Интернета](https://en.wikipedia.org/wiki/Internet_Control_Message_Protocol) ( `ICMP`) — это протокол, используемый устройствами для связи друг с другом в Интернете для различных целей, включая отчеты об ошибках и информацию о состоянии. Он отправляет запросы и сообщения между устройствами, которые можно использовать для сообщения об ошибках или предоставления информации о состоянии.

#### ICMP Requests

Запрос — это сообщение, отправляемое одним устройством другому для запроса информации или выполнения определенного действия. Примером запроса в ICMP является `ping` запрос, который проверяет соединение между двумя устройствами. Когда одно устройство отправляет запрос ping другому, второе устройство отвечает сообщением `ping reply` сообщение.

#### ICMP Messages

Сообщение в ICMP может быть как запросом, так и ответом. Помимо ping-запросов и ответов, ICMP поддерживает другие типы сообщений, например сообщения об ошибках. `destination unreachable`, и `time exceeded` сообщения. Эти сообщения используются для передачи различных типов информации и ошибок между устройствами в сети.

Например, если устройство пытается отправить пакет другому устройству, но пакет не может быть доставлен, устройство может использовать ICMP для отправки сообщения об ошибке обратно отправителю. ICMP имеет две разные версии:

- `ICMPv4`: только для IPv4
- `ICMPv6`: только для IPv6.

ICMPv4 — это оригинальная версия `ICMP`, разработанный для использования с IPv4. Он до сих пор широко используется и является наиболее распространенной версией ICMP. С другой стороны, ICMPv6 был разработан для IPv6. Он включает в себя дополнительные функции и предназначен для устранения некоторых ограничений ICMPv4.

|**Тип запроса**|**Описание**|
|---|---|
|`Echo Request`|Это сообщение проверяет, доступно ли устройство в сети. Когда устройство отправляет эхо-запрос, оно ожидает получения эхо-ответного сообщения. Например, инструменты `tracert` (Окна) или `traceroute` (Linux) всегда отправляет эхо-запросы ICMP.|
|`Timestamp Request`|Это сообщение определяет время на удаленном устройстве.|
|`Address Mask Request`|Это сообщение используется для запроса маски подсети устройства.|

|**Тип сообщения**|**Описание**|
|---|---|
|`Echo reply`|Это сообщение отправляется в ответ на сообщение эхо-запроса.|
|`Destination unreachable`|Это сообщение отправляется, когда устройство не может доставить пакет по назначению.|
|`Redirect`|Маршрутизатор отправляет это сообщение, чтобы сообщить устройству, что оно должно отправить свои пакеты на другой маршрутизатор.|
|`time exceeded`|Это сообщение отправляется, когда пакету потребовалось слишком много времени, чтобы достичь пункта назначения.|
|`Parameter problem`|Это сообщение отправляется, когда возникает проблема с заголовком пакета.|
|`Source quench`|Это сообщение отправляется, когда устройство получает пакеты слишком быстро и не успевает. Он используется для замедления потока пакетов.|

Еще одна важная для нас часть ICMP — это [Time-To-Live](https://en.wikipedia.org/wiki/Time_to_live) ( `TTL`) поле в заголовке пакета ICMP, которое ограничивает время жизни пакета при его прохождении по сети. Это предотвращает бесконечное циркулирование пакетов по сети в случае возникновения петель маршрутизации. Каждый раз, когда пакет проходит через маршрутизатор, маршрутизатор уменьшает `TTL value by 1`. Когда значение TTL достигнет `0`маршрутизатор отбрасывает пакет и отправляет ICMP `Time Exceeded` сообщение обратно отправителю.

Мы также можем использовать `TTL` для определения количества переходов, пройденных пакетом, и приблизительного расстояния до места назначения. Например, если пакет имеет `TTL` из 10 и для достижения пункта назначения требуется 5 прыжков, можно сделать вывод, что пункт назначения находится примерно в 5 прыжках. Например, если мы видим пинг с `TTL` ценность `122`, это может означать, что мы имеем дело с системой Windows ( `TTL 128` по умолчанию), то есть на расстоянии 6 переходов.

Однако также можно угадать операционную систему на основе настроек по умолчанию. `TTL` значение, используемое устройством. Каждая операционная система обычно имеет настройки по умолчанию. `TTL` значение при отправке пакетов. Это значение устанавливается в заголовке пакета и уменьшается на 1 каждый раз, когда пакет проходит через маршрутизатор. Поэтому изучение настроек устройства по умолчанию `TTL` Значение позволяет определить, какую операционную систему использует устройство. Например: системы Windows ( `2000/XP/2003/Vista/10`) обычно имеют значение по умолчанию `TTL` значение 128, тогда как в системах macOS и Linux обычно используется значение по умолчанию. `TTL` значение 64 и значение по умолчанию Solaris `TTL` значение 255. Однако важно отметить, что пользователь может изменить эти значения, поэтому они не должны зависеть от окончательного способа определения операционной системы устройства.

---

## VoIP

[Голосовая связь по интернет-протоколу](https://www.fcc.gov/general/voice-over-internet-protocol-voip) ( `VoIP`) — метод передачи голосовой и мультимедийной связи. Например, он позволяет нам совершать телефонные звонки, используя широкополосное подключение к Интернету вместо традиционной телефонной линии, как Skype, Whatsapp, Google Hangouts, Slack, Zoom и другие.

Наиболее распространенными портами VoIP являются `TCP/5060` и `TCP/5061`, которые используются для [протокола инициации сеанса](https://en.wikipedia.org/wiki/Session_Initiation_Protocol) (SIP). Однако порт `TCP/1720` также может использоваться некоторыми системами VoIP для [протокола H.323](https://en.wikipedia.org/wiki/H.323) — набора стандартов мультимедийной связи по пакетным сетям. Тем не менее, SIP более широко используется, чем H.323, в системах VoIP.

Тем не менее, SIP — это протокол сигнализации для инициирования, поддержания, изменения и завершения сеансов в реальном времени, включающих видео, голос, обмен сообщениями и другие коммуникационные приложения и услуги между двумя или более конечными точками в Интернете. Поэтому он использует запросы и методы между конечными точками. Наиболее распространенные запросы и методы SIP:

|**Метод**|**Описание**|
|---|---|
|`INVITE`|Инициирует сеанс или приглашает к участию другую конечную точку.|
|`ACK`|Подтверждает получение запроса INVITE.|
|`BYE`|Завершить сеанс.|
|`CANCEL`|Отменяет ожидающий запрос INVITE.|
|`REGISTER`|Регистрирует пользовательский агент SIP (UA) на SIP-сервере.|
|`OPTIONS`|Запрашивает информацию о возможностях SIP-сервера или пользовательского агента, например о типах поддерживаемых носителей.|

#### Information Disclosure

Однако SIP позволяет нам идентифицировать существующих пользователей на предмет потенциальных атак. Это может быть сделано для различных целей, таких как определение доступности пользователя, выяснение информации о возможностях или услугах пользователя или последующее проведение брутфорс-атак на учетные записи пользователей.

Одним из возможных способов подсчета пользователей является SIP. `OPTIONS` запрос. Это метод, используемый для запроса информации о возможностях SIP-сервера или пользовательских агентов, таких как типы поддерживаемых носителей, кодеки, которые он может декодировать, и другие подробности. `OPTIONS` запрос может проверить SIP-сервер или пользовательский агент на наличие информации или проверить его подключение и доступность.

В ходе нашего анализа можно обнаружить `SEPxxxx.cnf` файл, где `xxxx` уникальный идентификатор. Это файл конфигурации, используемый Cisco Unified Communications Manager, ранее известный как Cisco CallManager, для определения настроек и параметров Cisco Unified IP Phone. В файле указана модель телефона, версия прошивки, настройки сети и другие сведения.