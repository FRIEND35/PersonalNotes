# Virtual Private Networks

---

А `Virtual Private Network` ( `VPN`) — это технология, обеспечивающая безопасное и зашифрованное соединение между частной сетью и удаленным устройством. Это позволяет удаленному компьютеру напрямую обращаться к частной сети, обеспечивая безопасный и конфиденциальный доступ к сетевым ресурсам и службам. Например, администратор из другого места должен управлять внутренними серверами, чтобы сотрудники могли продолжать использовать внутренние службы. Многие компании ограничивают доступ к серверам, поэтому клиенты могут получить доступ к этим серверам только из локальной сети. Здесь в игру вступает VPN: администратор подключается к VPN-серверу через Интернет, аутентифицирует себя и, таким образом, создает зашифрованный туннель, чтобы другие не могли прочитать передаваемые данные. Кроме того, компьютеру администратора также назначается локальный (внутренний) IP-адрес, через который он может получать доступ к внутренним серверам и управлять ими. Администраторы обычно используют VPN для обеспечения безопасного и экономичного удаленного доступа к сети компании. VPN обычно использует порты `TCP/1723` для [протокола туннелирования «точка-точка»](https://www.lifewire.com/pptp-point-to-point-tunneling-protocol-818182) `PPTP` VPN-подключения и `UDP/500` для [VPN-соединений IKEv1](https://www.cisco.com/c/en/us/support/docs/security-vpn/ipsec-negotiation-ike-protocols/217432-understand-ipsec-ikev1-protocol.html) и [IKEv2](https://nordvpn.com/blog/ikev2ipsec/) .

Это позволяет сотрудникам получать доступ к сети и ее ресурсам, таким как электронная почта и файловые серверы, из удаленных мест, например, из дома или во время путешествия. Существует несколько причин, по которым администраторы используют VPN. VPN шифруют соединение между удаленным устройством и частной сетью, что значительно усложняет перехват и кражу конфиденциальной информации злоумышленникам. Благодаря этому вся связь становится более безопасной.

Другая причина заключается в том, что VPN позволяют сотрудникам получать удаленный доступ к частной сети и ее ресурсам из любого места, если у них есть подключение к Интернету. Это особенно полезно для сотрудников, которым необходимо работать удаленно, например, для тех, кто путешествует или работает из дома. Кроме того, VPN могут быть более экономичными, чем другие решения удаленного доступа, такие как выделенные линии или выделенные соединения, поскольку они используют общедоступный Интернет для подключения удаленных пользователей к частной сети.

Более того, мы можем использовать VPN для подключения нескольких удаленных мест, например филиалов, в единую частную сеть, что упрощает управление сетевыми ресурсами и доступ к ним. Однако для работы VPN необходимо несколько компонентов и требований:

|**Требование**|**Описание**|
|---|---|
|`VPN Client`|Он устанавливается на удаленном устройстве и используется для установления и поддержания VPN-соединения с VPN-сервером. Например, это может быть клиент OpenVPN.|
|`VPN Server`|Это компьютер или сетевое устройство, отвечающее за прием VPN-подключений от VPN-клиентов и маршрутизацию трафика между VPN-клиентами и частной сетью.|
|`Encryption`|VPN-соединения шифруются с использованием различных алгоритмов и протоколов шифрования, таких как AES и IPsec, для обеспечения безопасности соединения и защиты передаваемых данных.|
|`Authentication`|VPN-сервер и клиент должны аутентифицировать друг друга, используя общий секрет, сертификат или другой метод аутентификации, чтобы установить безопасное соединение.|

VPN-клиент и сервер используют эти порты для установки и поддержания VPN-соединения. На уровне TCP/IP VPN-соединение обычно использует [полезную нагрузку инкапсуляции безопасности](https://www.ibm.com/docs/en/i/7.4?topic=protocols-encapsulating-security-payload) ( `ESP`) протокол для шифрования и аутентификации VPN-трафика. Это позволяет VPN-клиенту и серверу безопасно обмениваться данными через общедоступный Интернет.

---

## IPsec

[Безопасность интернет-протокола](https://www.cloudflare.com/learning/network-layer/what-is-ipsec/) ( `IPsec`) — это протокол сетевой безопасности, обеспечивающий шифрование и аутентификацию для интернет-коммуникаций. Это мощный и широко используемый протокол безопасности, который обеспечивает шифрование и аутентификацию для интернет-коммуникаций и работает путем шифрования полезных данных каждого IP-пакета и добавления `authentication header` ( `AH`), который используется для проверки целостности и подлинности пакета. IPsec использует комбинацию двух протоколов для шифрования и аутентификации:

1. [Authentication Header](https://www.ibm.com/docs/en/i/7.1?topic=protocols-authentication-header) (`AH`): Этот протокол обеспечивает целостность и подлинность IP-пакетов, но не обеспечивает шифрование. Он добавляет заголовок аутентификации к каждому IP-пакету, который содержит криптографическую контрольную сумму, которую можно использовать для проверки того, что пакет не был подделан.
    
2. [Инкапсуляция полезных данных безопасности](https://www.ibm.com/docs/en/i/7.4?topic=protocols-encapsulating-security-payload) ( `ESP`): Этот протокол обеспечивает шифрование и дополнительную аутентификацию IP-пакетов. Он шифрует полезные данные каждого IP-пакета и дополнительно добавляет заголовок аутентификации, аналогичный AH.
    

IPsec можно использовать в двух режимах.

|**Режим**|**Описание**|
|---|---|
|`Transport Mode`|В этом режиме IPsec шифрует и аутентифицирует полезные данные каждого IP-пакета, но не шифрует IP-заголовок. Обычно это используется для обеспечения сквозной связи между двумя хостами.|
|`Tunnel Mode`|В этом режиме IPsec шифрует и аутентифицирует весь IP-пакет, включая IP-заголовок. Обычно это используется для создания VPN-туннеля между двумя сетями.|

Например, администратор может установить межсетевой экран. Чтобы обеспечить передачу IPsec VPN-трафика от VPN-клиента за пределами брандмауэра к VPN-серверу внутри, брандмауэр должен разрешить следующие протоколы:

|**Протокол**|**Порт**|**Описание**|
|---|---|---|
|`Internet Protocol` ( `IP`)|`UDP/50-51`|Это основной протокол, который обеспечивает основу для всех интернет-коммуникаций. Он используется для маршрутизации пакетов данных между VPN-клиентом и VPN-сервером.|
|`Internet Key Exchange` ( `IKE`)|`UDP/500`|IKE — это протокол, который используется для установления и поддержания безопасной связи между VPN-клиентом и VPN-сервером. Он основан на алгоритме обмена ключами Диффи-Хеллмана и используется для согласования и установления общих секретных ключей, которые можно использовать для шифрования и дешифрования VPN-трафика.|
|`Encapsulating Security Payload` ( `ESP`)|`UDP/4500`|ESP также является протоколом, обеспечивающим шифрование и аутентификацию IP-дейтаграмм. Он используется для шифрования VPN-трафика между VPN-клиентом и VPN-сервером с использованием ключей, согласованных с IKE.|

Эти протоколы необходимы для облегчения трафика IPsec VPN, поскольку они обеспечивают безопасность и шифрование, необходимые для безопасной связи через общедоступный Интернет. Без этих протоколов VPN-трафик был бы уязвим для перехвата и взлома.

---

## PPTP

[Протокол туннелирования «точка-точка»](https://www.vpnranks.com/blog/pptp-vs-l2tp/) ( `PPTP`) — это сетевой протокол, который позволяет создавать VPN путем установления безопасного туннеля между VPN-клиентом и сервером, инкапсулируя данные, передаваемые внутри этого туннеля. Первоначально являясь расширением протокола «точка-точка» (PPP), PPTP поддерживается многими операционными системами.

Однако из-за известных уязвимостей PPTP больше не считается безопасным. Он может туннелировать такие протоколы, как IP, IPX или NetBEUI, через IP, но в значительной степени заменен более безопасными протоколами VPN, такими как L2TP/IPsec, IPsec/IKEv2 и OpenVPN. С 2012 года использование PPTP сократилось, поскольку его метод аутентификации MSCHAPv2 использует устаревшее шифрование DES, которое можно легко взломать с помощью специального оборудования.