
![[Pasted image 20240731022457.png]]

SQL-инъекция — это тип кибератаки, при которой злоумышленники используют уязвимости в веб-приложениях для внедрения вредоносного SQL-кода в внутренние базы данных. Это может привести к раскрытию конфиденциальных данных, несанкционированному доступу к системам и даже к полной компрометации системы.

SQLmap — это мощный инструмент с открытым исходным кодом, используемый для автоматизации процесса обнаружения и эксплуатации уязвимостей SQL-инъекций в веб-приложениях. Это инструмент командной строки, который можно использовать для перечисления баз данных, извлечения данных и даже выполнения команд операционной системы на базовой системе.

# Установка SQLmap

SQLmap — кроссплатформенный инструмент, который можно установить на Windows, Linux и macOS. Вот шаги по установке SQLmap на каждой из этих платформ:

## **В Windows:**

1. Загрузите последнюю версию SQLmap с официального сайта.
2. Извлеките загруженный файл в желаемое место.
3. Откройте командную строку и перейдите в извлеченный каталог SQLmap.
4. Выполните команду «python sqlmap.py», чтобы запустить SQLmap.

## **В Linux:**

1. Откройте окно терминала и введите «sudo apt-get update», чтобы обновить список системных пакетов.
2. Введите «sudo apt-get install sqlmap», чтобы установить SQLmap из официального репозитория.
3. Проверьте установку, выполнив команду «sqlmap» в терминале.

## **В macOS:**

1. Установите менеджер пакетов Homebrew, выполнив следующую команду в терминале: «/usr/bin/ruby -e «$(curl -fsSL [https://raw.githubusercontent.com/Homebrew/install/master/install](https://raw.githubusercontent.com/Homebrew/install/master/install) )»»
2. Введите «brew install sqlmap», чтобы установить SQLmap.
3. Проверьте установку, выполнив команду «sqlmap» в терминале.

Чтобы проверить успешность установки, просто запустите команду «sqlmap» в терминале или командной строке. Если SQLmap установлен правильно, вы должны увидеть логотип SQLmap и информацию о версии, отображаемую в терминале.

# Базовое использование

- Использование команды **«sqlmap -u <целевой URL>»** для сканирования на наличие уязвимостей
- Использование команды `«sqlmap -u <target URL> — dbs»` для перечисления списка баз данных
- Использование команды **«sqlmap -u <целевой URL> -D <имя базы данных> — таблицы»** для перечисления списка таблиц в базе данных
- Использование команды **«sqlmap -u <целевой URL> -D <имя базы данных> -T <имя таблицы> — dump»** для извлечения данных из таблицы

# Расширенное использование

## Изменение HTTP-заголовков и файлов cookie

Чтобы изменить заголовки HTTP и файлы cookie во время сканирования SQLmap, вы можете использовать параметры `--headers`и `--cookie`соответственно. Вот обзор того, как их использовать:

`--headers`: Эта опция позволяет добавлять или изменять заголовки HTTP для запросов, отправляемых во время сканирования. Вы можете использовать ее для изменения заголовков, таких как `User-Agent`, `Referer`, `Cookie`, и т. д.

Например, чтобы изменить `User-Agent`заголовок на **«Mozilla/5.0»** во время сканирования SQLmap, используйте следующую команду:

```
sqlmap -u <целевой URL> --headers= "User-Agent: Mozilla/5.0"
```

`--cookie`: Эта опция позволяет вам устанавливать или изменять файлы cookie для запросов, отправляемых во время сканирования. Вы можете использовать ее для изменения файлов cookie, таких как `PHPSESSID`, `JSESSIONID`и т. д.

Например, чтобы изменить `PHPSESSID`cookie-файл на **«12345»** во время сканирования SQLmap, используйте следующую команду:

```
sqlmap -u <целевой URL> --cookie= "PHPSESSID=12345"
```

Обратите внимание, что вы также можете использовать `--cookie-file`опцию загрузки файлов cookie из файла. Это может быть полезно, если вы хотите повторно использовать файлы cookie из предыдущего сеанса.

Изменяя заголовки HTTP и файлы cookie, вы можете обойти определенные меры безопасности, которые могут быть приняты, например, брандмауэры веб-приложений или системы аутентификации.

## Изменение параметров запроса

Чтобы изменить параметры запроса во время сканирования SQLmap, вы можете использовать параметры `--data`и `--tamper`. Вот обзор того, как их использовать:

`--data`: Эта опция позволяет вам устанавливать или изменять данные, отправляемые в теле запроса во время сканирования. Вы можете использовать ее для изменения таких параметров, как `username`, `password`, `id`, и т. д.

Например, чтобы изменить `id`параметр на «1' OR 1=1#» во время сканирования SQLmap, используйте следующую команду:

sqlmap -u <целевой URL> -- data = "id=1' OR 1=1#"

`--tamper`: Эта опция позволяет использовать пользовательские скрипты подделки для изменения данных, отправленных в теле запроса. Скрипты подделки могут использоваться для кодирования или шифрования данных таким образом, чтобы обойти определенные меры безопасности, или для изменения данных таким образом, чтобы вызвать определенные уязвимости SQL-инъекции.

Например, чтобы использовать `apostrophemask.py`скрипт подделки для кодирования апострофов в теле запроса, вам следует использовать следующую команду:

```
sqlmap -u <целевой URL> -- data = "id=1' OR 1=1#" --tamper=apostrophemask.py
```

Вы также можете использовать несколько сценариев взлома, разделив их запятой.

Изменяя параметры запроса, вы можете обойти определенные меры безопасности, которые могут применяться, например, проверку или очистку входных данных.

## Обход фильтров и брандмауэров

Обход фильтров и брандмауэров во время сканирования SQLmap может быть выполнен с использованием различных методов. Вот несколько примеров того, как использовать SQLmap для обхода различных типов мер безопасности:

**Обход входных фильтров:** Если веб-приложение фильтрует или блокирует определенные символы или ключевые слова во входных параметрах, вы можете попытаться обойти фильтр, кодируя или запутывая входные данные. Например, вы можете попробовать кодирование URL, кодирование HTML или использовать альтернативные наборы символов.

Для URL-кодирования `id`параметра во время сканирования SQLmap используйте следующую команду:

```
sqlmap -u <целевой URL> --data="id=%27+OR+1%3D1--"
```

**Обход брандмауэров веб-приложений (WAF):** Если в веб-приложении установлен WAF, который блокирует атаки SQL-инъекций, вы можете попытаться обойти WAF, используя технику, называемую «обход скрипта подделки». Это подразумевает изменение полезной нагрузки SQL-инъекции таким образом, чтобы обойти обнаружение сигнатуры WAF.

Чтобы использовать `tamper/space2hash.py`скрипт для обхода WAF во время сканирования SQLmap, используйте следующую команду:

```
sqlmap -u <целевой URL> --data="id=1' OR 1=1#" --tamper=tamper/space2hash.py
```

**Обход брандмауэров базы данных:** Если в базе данных установлен брандмауэр, который блокирует определенные команды или запросы SQL, вы можете попытаться обойти брандмауэр, используя технику, называемую «слепая инъекция SQL на основе времени». Она включает отправку полезных нагрузок инъекции SQL, которые заставляют базу данных задерживаться или спать в течение определенного времени, что может быть использовано для получения информации о базе данных.

Чтобы использовать слепую инъекцию SQL-кода на основе времени во время сканирования SQLmap, используйте следующую команду:

```
sqlmap -u <целевой URL> --data="id=1' AND SLEEP(5)--"
```
## Использование API SQLmap

API SQLmap можно использовать для интеграции SQLmap в пользовательские скрипты или программы или для автоматизации тестирования SQL-инъекций. Вот обзор того, как использовать API SQLmap:

**Запустите сервер SQLmap:** Перед тем, как использовать API SQLmap, вам необходимо запустить сервер SQLmap. Чтобы запустить сервер, используйте следующую команду:

sqlmapapi.py -s​

Это запустит сервер SQLmap на порту по умолчанию (8775).

**Отправка запросов в API:** После запуска сервера SQLmap вы можете отправлять запросы к нему с помощью API. Запросы могут отправляться с помощью методов HTTP GET или POST и могут включать различные параметры, такие как целевой URL, метод внедрения и скрипты подделки.

Например, чтобы просканировать целевой URL-адрес с использованием метода слепого внедрения на основе логических значений и `apostrophemask.py`скрипта подделки, вам нужно отправить HTTP-запрос POST `http://localhost:8775/task/new`со следующей полезной нагрузкой JSON:

```json
{  
"url": "<target URL>",  
"technique": "B",  
"tamper": "apostrophemask.py"  
}
```

**Получить статус задачи и результаты:** После отправки запроса в API SQLmap вы можете проверить статус задачи и получить результаты. Статус задачи можно проверить с помощью запроса HTTP GET к `http://localhost:8775/task/<task ID>/status`, а результаты задачи можно получить с помощью запроса HTTP GET к `http://localhost:8775/task/<task ID>/data`.

Например, чтобы проверить статус и получить результаты задачи с идентификатором `1`, вы должны отправить следующие HTTP-запросы GET:

```
http://localhost:8775/task/1/status   
http://localhost:8775/task/1/data
```

Использование API SQLmap может быть полезно для автоматизации тестирования SQL-инъекций и интеграции SQLmap в пользовательские скрипты или программы.

# Распространенные атаки и меры противодействия

## SQL-инъекция на основе ошибок

Error-based SQL Injection — это тип SQL Injection, который полагается на запуск ошибок в целевом приложении для извлечения информации из базы данных. Вот обзор того, как выполнить Error-based SQL Injection с помощью SQLmap:

1. **Определите цель:** как и при любом тестировании на SQL-инъекции, первым шагом является определение целевого приложения, которое может быть уязвимо для SQL-инъекций на основе ошибок.
2. **Определите точку инъекции:** После того, как вы определили целевое приложение, вам нужно определить, где в полях ввода или параметрах приложения вы можете внедрить код SQL. Вы можете использовать встроенные функции сканирования SQLmap, чтобы помочь определить точки инъекции.
3. **Укажите технику инъекции:** После определения точки инъекции необходимо указать технику Error-based SQL Injection с помощью опции `--technique`. Техника Error-based SQL Injection обозначается буквой `E`.
4. **Запустите инъекцию:** После того, как вы указали метод инъекции, вы можете запустить инъекцию, используя `--dump`опцию извлечения данных из базы данных.

Вот пример команды для выполнения SQL-инъекции на основе ошибок с использованием SQLmap:

```
sqlmap -u "http://example.com/vulnerable.php?id=1"  --technique E --dump
```

Эта команда указывает целевой URL-адрес и точку внедрения с помощью `-u`параметра , технику внедрения SQL-кода на основе ошибок с помощью `--technique`параметра , а также `--dump`параметр для извлечения данных из базы данных.

## Слепая SQL-инъекция

Слепая инъекция SQL — это тип инъекции SQL, который не отображает ошибки или информацию, которая может помочь идентифицировать уязвимость, что затрудняет ее обнаружение. Вот обзор того, как выполнить слепую инъекцию SQL с помощью SQLmap:

1. **Определите цель:** как и при любом тестировании на SQL-инъекцию, первым шагом является определение целевого приложения, которое может быть уязвимо для слепой SQL-инъекции.
2. **Определите точку инъекции:** После того, как вы определили целевое приложение, вам нужно определить, где в полях ввода или параметрах приложения вы можете внедрить код SQL. Вы можете использовать встроенные функции сканирования SQLmap, чтобы помочь определить точки инъекции.
3. **Укажите технику инъекции:** После определения точки инъекции необходимо указать технику слепой инъекции SQL с помощью опции `--technique`. Техника слепой инъекции SQL обозначается буквой `B`.
4. **Используйте** `**--data**`**опцию:** Слепая инъекция SQL обычно подразумевает отправку пользовательских данных в HTTP-запросе на сервер. Вы можете использовать опцию, `--data`чтобы указать данные, которые SQLmap должен отправить.
5. **Используйте параметры** `**--string**`**и** `**--not-string**`**:** Слепая инъекция SQL основана на определении того, являются ли определенные условия истинными или ложными, на основе ответа сервера. Вы можете использовать параметры `--string`и `--not-string`для указания строк, которые SQLmap должен искать в ответе сервера, чтобы определить, является ли условие истинным или ложным.

Вот пример команды для выполнения слепой SQL-инъекции с использованием SQLmap:

```
sqlmap -u "http://example.com/vulnerable.php" --data= "username=admin&password=password" --technique B -- string = "Добро Welcome, admin!" -- not - string = "Invalid login"
```

Эта команда указывает целевой URL-адрес и точку внедрения с помощью `-u`параметра , пользовательские данные для отправки с помощью `--data`параметра , технику слепого внедрения SQL с помощью `--technique`параметра , а также параметры `--string`и `--not-string`для указания строк, которые следует искать в ответе сервера.

## Защитные механизмы и контрмеры

Существует несколько защитных механизмов и контрмер, которые можно использовать для предотвращения или смягчения атак SQL-инъекций, подобных тем, которые выполняются с помощью SQLmap. Вот некоторые из них:

1. **Параметризованные запросы:** Один из самых эффективных способов предотвращения SQL-инъекций — использование параметризованных запросов. Это подразумевает использование заполнителей для пользовательского ввода в SQL-выражениях и привязку их к типизированным параметрам во время выполнения, что помогает предотвратить выполнение вредоносного SQL-кода.
2. **Проверка и очистка ввода:** Проверка ввода включает проверку пользовательского ввода на соответствие предопределенным правилам, таким как длина ввода, типы символов и формат, в то время как очистка ввода включает фильтрацию потенциально опасных символов или команд из пользовательского ввода. Это может помочь предотвратить выполнение вредоносного ввода в виде кода SQL.
3. **Принцип наименьших привилегий:** Принцип наименьших привилегий подразумевает ограничение привилегий пользователя и доступ только к тому, что необходимо для его рабочих функций. Это может помочь предотвратить атаки SQL Injection, ограничив ущерб, который может быть нанесен с помощью украденных или скомпрометированных учетных данных.
4. **Сегментация сети и брандмауэры:** Сегментация сети подразумевает разделение сети на более мелкие сегменты или подсети, каждая из которых имеет собственные средства управления безопасностью, в то время как брандмауэры могут использоваться для фильтрации и блокировки трафика на основе предопределенных правил. Эти меры могут помочь предотвратить доступ злоумышленников к конфиденциальным данным или системам.
5. **Брандмауэры веб-приложений (WAF):** WAF предназначены для мониторинга и фильтрации входящего трафика веб-приложений, обнаружения и блокировки вредоносного трафика, такого как атаки SQL Injection. Они работают, анализируя шаблоны трафика и используя предопределенные правила для фильтрации вредоносного трафика.

Внедрение этих защитных механизмов и контрмер может помочь предотвратить или смягчить атаки SQL-инъекции, подобные тем, которые можно выполнить с помощью SQLmap. Важно помнить, что безопасность — это непрерывный процесс, требующий постоянного мониторинга и обновления, чтобы оставаться эффективной против развивающихся угроз.

# Заключение

SQLmap — мощный инструмент для обнаружения и эксплуатации уязвимостей SQL-инъекции в веб-приложениях. Он обладает широким спектром функций и возможностей, включая сканирование на наличие уязвимостей, извлечение данных из таблиц и использование передовых методов, таких как основанная на ошибках и слепая SQL-инъекция.

SQLmap также можно использовать в сочетании с другими инструментами для расширения его возможностей и эффективности, такими как Burp Suite, Metasploit Framework, Nmap, OpenVAS и Metagoofil.